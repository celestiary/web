import{AdditiveBlending,AmbientLight,Asterisms,AxesHelper,BufferGeometry,FAVES,Float32BufferAttribute,HelpButton,INITIAL_FOV,Keys,LENGTH_SCALE,LineBasicMaterial,Loader,Measure,Mesh,Object3D,Planet,PointLight,Points,Raycaster,ShaderMaterial,SpriteSheet,Star,Stars,StarsCatalog,ThreeUi,Time,Vector2,Vector3,angle,arrow,collapse,createTree,cube,elt,getSunProps,grid,line,makeCollapsable,marker,named,newElt,pathTexture,queryPoints,reifyMeasures,setTitleFromLocation,sphere,toRad,twoPi,visitFilterProperty}from"./chunk-OLOS2PEK.js";import{Link,Outlet,Route,Routes,__commonJS,__toESM,require_react,useLocation}from"./chunk-4CNGUTRA.js";var require_tweakpane=__commonJS({"node_modules/tweakpane/dist/tweakpane.js"(exports,module){(function(global,factory){typeof exports=="object"&&typeof module!="undefined"?factory(exports):typeof define=="function"&&define.amd?define(["exports"],factory):(global=typeof globalThis!="undefined"?globalThis:global||self,factory(global.Tweakpane={}))})(exports,function(exports2){"use strict";class Semver{constructor(text){let[core,prerelease]=text.split("-"),coreComps=core.split(".");this.major=parseInt(coreComps[0],10),this.minor=parseInt(coreComps[1],10),this.patch=parseInt(coreComps[2],10),this.prerelease=prerelease!=null?prerelease:null}toString(){let core=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[core,this.prerelease].join("-"):core}}class BladeApi{constructor(controller){this.controller_=controller}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(disabled){this.controller_.viewProps.set("disabled",disabled)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(hidden){this.controller_.viewProps.set("hidden",hidden)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class TpEvent{constructor(target){this.target=target}}class TpChangeEvent extends TpEvent{constructor(target,value,presetKey,last){super(target);this.value=value,this.presetKey=presetKey,this.last=last!=null?last:!0}}class TpUpdateEvent extends TpEvent{constructor(target,value,presetKey){super(target);this.value=value,this.presetKey=presetKey}}class TpFoldEvent extends TpEvent{constructor(target,expanded){super(target);this.expanded=expanded}}function forceCast(v){return v}function isEmpty(value){return value==null}function deepEqualsArray(a1,a2){if(a1.length!==a2.length)return!1;for(let i=0;i<a1.length;i++)if(a1[i]!==a2[i])return!1;return!0}let CREATE_MESSAGE_MAP={alreadydisposed:()=>"View has been already disposed",invalidparams:context=>`Invalid parameters for '${context.name}'`,nomatchingcontroller:context=>`No matching controller for '${context.key}'`,nomatchingview:context=>`No matching view for '${JSON.stringify(context.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:context=>`Property '${context.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class TpError{constructor(config){var _a;this.message=(_a=CREATE_MESSAGE_MAP[config.type](forceCast(config.context)))!==null&&_a!==void 0?_a:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=config.type}static alreadyDisposed(){return new TpError({type:"alreadydisposed"})}static notBindable(){return new TpError({type:"notbindable"})}static propertyNotFound(name){return new TpError({type:"propertynotfound",context:{name}})}static shouldNeverHappen(){return new TpError({type:"shouldneverhappen"})}}class BindingTarget{constructor(obj,key,opt_id){this.obj_=obj,this.key_=key,this.presetKey_=opt_id!=null?opt_id:key}static isBindable(obj){return!(obj===null||typeof obj!="object")}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(value){this.obj_[this.key_]=value}writeProperty(name,value){let valueObj=this.read();if(!BindingTarget.isBindable(valueObj))throw TpError.notBindable();if(!(name in valueObj))throw TpError.propertyNotFound(name);valueObj[name]=value}}class ButtonApi extends BladeApi{get label(){return this.controller_.props.get("label")}set label(label){this.controller_.props.set("label",label)}get title(){var _a;return(_a=this.controller_.valueController.props.get("title"))!==null&&_a!==void 0?_a:""}set title(title){this.controller_.valueController.props.set("title",title)}on(eventName,handler){let bh=handler.bind(this);return this.controller_.valueController.emitter.on(eventName,()=>{bh(new TpEvent(this))}),this}}class Emitter{constructor(){this.observers_={}}on(eventName,handler){let observers=this.observers_[eventName];return observers||(observers=this.observers_[eventName]=[]),observers.push({handler}),this}off(eventName,handler){let observers=this.observers_[eventName];return observers&&(this.observers_[eventName]=observers.filter(observer=>observer.handler!==handler)),this}emit(eventName,event){let observers=this.observers_[eventName];!observers||observers.forEach(observer=>{observer.handler(event)})}}let PREFIX="tp";function ClassName(viewName){return(opt_elementName,opt_modifier)=>[PREFIX,"-",viewName,"v",opt_elementName?`_${opt_elementName}`:"",opt_modifier?`-${opt_modifier}`:""].join("")}function compose(h1,h2){return input=>h2(h1(input))}function extractValue(ev){return ev.rawValue}function bindValue(value,applyValue){value.emitter.on("change",compose(extractValue,applyValue)),applyValue(value.rawValue)}function bindValueMap(valueMap,key,applyValue){bindValue(valueMap.value(key),applyValue)}function applyClass(elem,className2,active){active?elem.classList.add(className2):elem.classList.remove(className2)}function valueToClassName(elem,className2){return value=>{applyClass(elem,className2,value)}}function bindValueToTextContent(value,elem){bindValue(value,text=>{elem.textContent=text!=null?text:""})}let className$q=ClassName("btn");class ButtonView{constructor(doc,config){this.element=doc.createElement("div"),this.element.classList.add(className$q()),config.viewProps.bindClassModifiers(this.element);let buttonElem=doc.createElement("button");buttonElem.classList.add(className$q("b")),config.viewProps.bindDisabled(buttonElem),this.element.appendChild(buttonElem),this.buttonElement=buttonElem;let titleElem=doc.createElement("div");titleElem.classList.add(className$q("t")),bindValueToTextContent(config.props.value("title"),titleElem),this.buttonElement.appendChild(titleElem)}}class ButtonController{constructor(doc,config){this.emitter=new Emitter,this.onClick_=this.onClick_.bind(this),this.props=config.props,this.viewProps=config.viewProps,this.view=new ButtonView(doc,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class BoundValue{constructor(initialValue,config){var _a;this.constraint_=config==null?void 0:config.constraint,this.equals_=(_a=config==null?void 0:config.equals)!==null&&_a!==void 0?_a:(v1,v2)=>v1===v2,this.emitter=new Emitter,this.rawValue_=initialValue}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(rawValue){this.setRawValue(rawValue,{forceEmit:!1,last:!0})}setRawValue(rawValue,options){let opts=options!=null?options:{forceEmit:!1,last:!0},constrainedValue=this.constraint_?this.constraint_.constrain(rawValue):rawValue;!!this.equals_(this.rawValue_,constrainedValue)&&!opts.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=constrainedValue,this.emitter.emit("change",{options:opts,rawValue:constrainedValue,sender:this}))}}class PrimitiveValue{constructor(initialValue){this.emitter=new Emitter,this.value_=initialValue}get rawValue(){return this.value_}set rawValue(value){this.setRawValue(value,{forceEmit:!1,last:!0})}setRawValue(value,options){let opts=options!=null?options:{forceEmit:!1,last:!0};this.value_===value&&!opts.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=value,this.emitter.emit("change",{options:opts,rawValue:this.value_,sender:this}))}}function createValue(initialValue,config){let constraint=config==null?void 0:config.constraint,equals=config==null?void 0:config.equals;return!constraint&&!equals?new PrimitiveValue(initialValue):new BoundValue(initialValue,config)}class ValueMap{constructor(valueMap){this.emitter=new Emitter,this.valMap_=valueMap;for(let key in this.valMap_)this.valMap_[key].emitter.on("change",()=>{this.emitter.emit("change",{key,sender:this})})}static createCore(initialValue){return Object.keys(initialValue).reduce((o,key)=>Object.assign(o,{[key]:createValue(initialValue[key])}),{})}static fromObject(initialValue){let core=this.createCore(initialValue);return new ValueMap(core)}get(key){return this.valMap_[key].rawValue}set(key,value){this.valMap_[key].rawValue=value}value(key){return this.valMap_[key]}}function parseObject(value,keyToParserMap){let result=Object.keys(keyToParserMap).reduce((tmp,key)=>{if(tmp===void 0)return;let result2=keyToParserMap[key](value[key]);return result2.succeeded?Object.assign(Object.assign({},tmp),{[key]:result2.value}):void 0},{});return forceCast(result)}function parseArray(value,parseItem){return value.reduce((tmp,item)=>{if(tmp===void 0)return;let result=parseItem(item);if(!(!result.succeeded||result.value===void 0))return[...tmp,result.value]},[])}function isObject(value){return value===null?!1:typeof value=="object"}function createParamsParserBuilder(parse){return optional=>v=>{if(!optional&&v===void 0)return{succeeded:!1,value:void 0};if(optional&&v===void 0)return{succeeded:!0,value:void 0};let result=parse(v);return result!==void 0?{succeeded:!0,value:result}:{succeeded:!1,value:void 0}}}function createParamsParserBuilders(optional){return{custom:parse=>createParamsParserBuilder(parse)(optional),boolean:createParamsParserBuilder(v=>typeof v=="boolean"?v:void 0)(optional),number:createParamsParserBuilder(v=>typeof v=="number"?v:void 0)(optional),string:createParamsParserBuilder(v=>typeof v=="string"?v:void 0)(optional),function:createParamsParserBuilder(v=>typeof v=="function"?v:void 0)(optional),constant:value=>createParamsParserBuilder(v=>v===value?value:void 0)(optional),raw:createParamsParserBuilder(v=>v)(optional),object:keyToParserMap=>createParamsParserBuilder(v=>{if(!!isObject(v))return parseObject(v,keyToParserMap)})(optional),array:itemParser=>createParamsParserBuilder(v=>{if(!!Array.isArray(v))return parseArray(v,itemParser)})(optional)}}let ParamsParsers={optional:createParamsParserBuilders(!0),required:createParamsParserBuilders(!1)};function parseParams(value,keyToParserMap){let result=ParamsParsers.required.object(keyToParserMap)(value);return result.succeeded?result.value:void 0}function disposeElement(elem){return elem&&elem.parentElement&&elem.parentElement.removeChild(elem),null}function getAllBladePositions(){return["veryfirst","first","last","verylast"]}let className$p=ClassName(""),POS_TO_CLASS_NAME_MAP={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class BladeController{constructor(config){this.parent_=null,this.blade=config.blade,this.view=config.view,this.viewProps=config.viewProps;let elem=this.view.element;this.blade.value("positions").emitter.on("change",()=>{getAllBladePositions().forEach(pos=>{elem.classList.remove(className$p(void 0,POS_TO_CLASS_NAME_MAP[pos]))}),this.blade.get("positions").forEach(pos=>{elem.classList.add(className$p(void 0,POS_TO_CLASS_NAME_MAP[pos]))})}),this.viewProps.handleDispose(()=>{disposeElement(elem)})}get parent(){return this.parent_}}let SVG_NS="http://www.w3.org/2000/svg";function forceReflow(element){element.offsetHeight}function disableTransitionTemporarily(element,callback){let t=element.style.transition;element.style.transition="none",callback(),element.style.transition=t}function supportsTouch(doc){return doc.ontouchstart!==void 0}function getGlobalObject(){return new Function("return this")()}function getWindowDocument(){return forceCast(getGlobalObject()).document}function getCanvasContext(canvasElement){let win=canvasElement.ownerDocument.defaultView;return win&&"document"in win?canvasElement.getContext("2d"):null}let ICON_ID_TO_INNER_HTML_MAP={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function createSvgIconElement(document2,iconId){let elem=document2.createElementNS(SVG_NS,"svg");return elem.innerHTML=ICON_ID_TO_INNER_HTML_MAP[iconId],elem}function insertElementAt(parentElement,element,index){parentElement.insertBefore(element,parentElement.children[index])}function removeElement(element){element.parentElement&&element.parentElement.removeChild(element)}function removeChildElements(element){for(;element.children.length>0;)element.removeChild(element.children[0])}function removeChildNodes(element){for(;element.childNodes.length>0;)element.removeChild(element.childNodes[0])}function findNextTarget(ev){return ev.relatedTarget?forceCast(ev.relatedTarget):"explicitOriginalTarget"in ev?ev.explicitOriginalTarget:null}let className$o=ClassName("lbl");function createLabelNode(doc,label){let frag=doc.createDocumentFragment();return label.split(`
`).map(line2=>doc.createTextNode(line2)).forEach((lineNode,index)=>{index>0&&frag.appendChild(doc.createElement("br")),frag.appendChild(lineNode)}),frag}class LabelView{constructor(doc,config){this.element=doc.createElement("div"),this.element.classList.add(className$o()),config.viewProps.bindClassModifiers(this.element);let labelElem=doc.createElement("div");labelElem.classList.add(className$o("l")),bindValueMap(config.props,"label",value=>{isEmpty(value)?this.element.classList.add(className$o(void 0,"nol")):(this.element.classList.remove(className$o(void 0,"nol")),removeChildNodes(labelElem),labelElem.appendChild(createLabelNode(doc,value)))}),this.element.appendChild(labelElem),this.labelElement=labelElem;let valueElem=doc.createElement("div");valueElem.classList.add(className$o("v")),this.element.appendChild(valueElem),this.valueElement=valueElem}}class LabelController extends BladeController{constructor(doc,config){let viewProps=config.valueController.viewProps;super(Object.assign(Object.assign({},config),{view:new LabelView(doc,{props:config.props,viewProps}),viewProps}));this.props=config.props,this.valueController=config.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}let ButtonBladePlugin={id:"button",type:"blade",accept(params){let p=ParamsParsers,result=parseParams(params,{title:p.required.string,view:p.required.constant("button"),label:p.optional.string});return result?{params:result}:null},controller(args){return new LabelController(args.document,{blade:args.blade,props:ValueMap.fromObject({label:args.params.label}),valueController:new ButtonController(args.document,{props:ValueMap.fromObject({title:args.params.title}),viewProps:args.viewProps})})},api(args){return!(args.controller instanceof LabelController)||!(args.controller.valueController instanceof ButtonController)?null:new ButtonApi(args.controller)}};class ValueBladeController extends BladeController{constructor(config){super(config);this.value=config.value}}function createBlade(){return new ValueMap({positions:createValue([],{equals:deepEqualsArray})})}class Foldable extends ValueMap{constructor(valueMap){super(valueMap)}static create(expanded){let coreObj={completed:!0,expanded,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},core=ValueMap.createCore(coreObj);return new Foldable(core)}get styleExpanded(){var _a;return(_a=this.get("temporaryExpanded"))!==null&&_a!==void 0?_a:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";let exHeight=this.get("expandedHeight");return this.get("shouldFixHeight")&&!isEmpty(exHeight)?`${exHeight}px`:"auto"}bindExpandedClass(elem,expandedClassName){bindValueMap(this,"expanded",()=>{this.styleExpanded?elem.classList.add(expandedClassName):elem.classList.remove(expandedClassName)})}}function computeExpandedFolderHeight(folder,containerElement){let height=0;return disableTransitionTemporarily(containerElement,()=>{folder.set("expandedHeight",null),folder.set("temporaryExpanded",!0),forceReflow(containerElement),height=containerElement.clientHeight,folder.set("temporaryExpanded",null),forceReflow(containerElement)}),height}function applyHeight(foldable,elem){elem.style.height=foldable.styleHeight}function bindFoldable(foldable,elem){foldable.value("expanded").emitter.on("beforechange",()=>{foldable.set("completed",!1),isEmpty(foldable.get("expandedHeight"))&&foldable.set("expandedHeight",computeExpandedFolderHeight(foldable,elem)),foldable.set("shouldFixHeight",!0),forceReflow(elem)}),foldable.emitter.on("change",()=>{applyHeight(foldable,elem)}),applyHeight(foldable,elem),elem.addEventListener("transitionend",ev=>{ev.propertyName==="height"&&(foldable.set("shouldFixHeight",!1),foldable.set("expandedHeight",null),foldable.set("completed",!0))})}class RackLikeApi extends BladeApi{constructor(controller,rackApi){super(controller);this.rackApi_=rackApi}}function addButtonAsBlade(api,params){return api.addBlade(Object.assign(Object.assign({},params),{view:"button"}))}function addFolderAsBlade(api,params){return api.addBlade(Object.assign(Object.assign({},params),{view:"folder"}))}function addSeparatorAsBlade(api,opt_params){let params=opt_params||{};return api.addBlade(Object.assign(Object.assign({},params),{view:"separator"}))}function addTabAsBlade(api,params){return api.addBlade(Object.assign(Object.assign({},params),{view:"tab"}))}class NestedOrderedSet{constructor(extract){this.emitter=new Emitter,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=extract}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(callback){for(let item of this.allItems())if(callback(item))return item;return null}includes(item){return this.cache_.has(item)}add(item,opt_index){if(this.includes(item))throw TpError.shouldNeverHappen();let index=opt_index!==void 0?opt_index:this.items_.length;this.items_.splice(index,0,item),this.cache_.add(item);let subList=this.extract_(item);subList&&(subList.emitter.on("add",this.onSubListAdd_),subList.emitter.on("remove",this.onSubListRemove_),subList.allItems().forEach(item2=>{this.cache_.add(item2)})),this.emitter.emit("add",{index,item,root:this,target:this})}remove(item){let index=this.items_.indexOf(item);if(index<0)return;this.items_.splice(index,1),this.cache_.delete(item);let subList=this.extract_(item);subList&&(subList.emitter.off("add",this.onSubListAdd_),subList.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index,item,root:this,target:this})}onSubListAdd_(ev){this.cache_.add(ev.item),this.emitter.emit("add",{index:ev.index,item:ev.item,root:this,target:ev.target})}onSubListRemove_(ev){this.cache_.delete(ev.item),this.emitter.emit("remove",{index:ev.index,item:ev.item,root:this,target:ev.target})}}class InputBindingApi extends BladeApi{constructor(controller){super(controller);this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new Emitter,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(label){this.controller_.props.set("label",label)}on(eventName,handler){let bh=handler.bind(this);return this.emitter_.on(eventName,ev=>{bh(ev.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(ev){let value=ev.sender.target.read();this.emitter_.emit("change",{event:new TpChangeEvent(this,forceCast(value),this.controller_.binding.target.presetKey,ev.options.last)})}}class InputBindingController extends LabelController{constructor(doc,config){super(doc,config);this.binding=config.binding}}class MonitorBindingApi extends BladeApi{constructor(controller){super(controller);this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new Emitter,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(label){this.controller_.props.set("label",label)}on(eventName,handler){let bh=handler.bind(this);return this.emitter_.on(eventName,ev=>{bh(ev.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(ev){let value=ev.sender.target.read();this.emitter_.emit("update",{event:new TpUpdateEvent(this,forceCast(value),this.controller_.binding.target.presetKey)})}}class MonitorBindingController extends LabelController{constructor(doc,config){super(doc,config);this.binding=config.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function findSubBladeApiSet(api){return api instanceof RackApi?api.apiSet_:api instanceof RackLikeApi?api.rackApi_.apiSet_:null}function getApiByController(apiSet,controller){let api=apiSet.find(api2=>api2.controller_===controller);if(!api)throw TpError.shouldNeverHappen();return api}function createBindingTarget(obj,key,opt_id){if(!BindingTarget.isBindable(obj))throw TpError.notBindable();return new BindingTarget(obj,key,opt_id)}class RackApi extends BladeApi{constructor(controller,pool){super(controller);this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new Emitter,this.apiSet_=new NestedOrderedSet(findSubBladeApiSet),this.pool_=pool;let rack=this.controller_.rack;rack.emitter.on("add",this.onRackAdd_),rack.emitter.on("remove",this.onRackRemove_),rack.emitter.on("inputchange",this.onRackInputChange_),rack.emitter.on("monitorupdate",this.onRackMonitorUpdate_),rack.children.forEach(bc=>{this.setUpApi_(bc)})}get children(){return this.controller_.rack.children.map(bc=>getApiByController(this.apiSet_,bc))}addInput(object,key,opt_params){let params=opt_params||{},doc=this.controller_.view.element.ownerDocument,bc=this.pool_.createInput(doc,createBindingTarget(object,key,params.presetKey),params),api=new InputBindingApi(bc);return this.add(api,params.index)}addMonitor(object,key,opt_params){let params=opt_params||{},doc=this.controller_.view.element.ownerDocument,bc=this.pool_.createMonitor(doc,createBindingTarget(object,key),params),api=new MonitorBindingApi(bc);return forceCast(this.add(api,params.index))}addFolder(params){return addFolderAsBlade(this,params)}addButton(params){return addButtonAsBlade(this,params)}addSeparator(opt_params){return addSeparatorAsBlade(this,opt_params)}addTab(params){return addTabAsBlade(this,params)}add(api,opt_index){this.controller_.rack.add(api.controller_,opt_index);let gapi=this.apiSet_.find(a=>a.controller_===api.controller_);return gapi&&this.apiSet_.remove(gapi),this.apiSet_.add(api),api}remove(api){this.controller_.rack.remove(api.controller_)}addBlade(params){let doc=this.controller_.view.element.ownerDocument,bc=this.pool_.createBlade(doc,params),api=this.pool_.createBladeApi(bc);return this.add(api,params.index)}on(eventName,handler){let bh=handler.bind(this);return this.emitter_.on(eventName,ev=>{bh(ev.event)}),this}setUpApi_(bc){this.apiSet_.find(api2=>api2.controller_===bc)||this.apiSet_.add(this.pool_.createBladeApi(bc))}onRackAdd_(ev){this.setUpApi_(ev.bladeController)}onRackRemove_(ev){if(ev.isRoot){let api=getApiByController(this.apiSet_,ev.bladeController);this.apiSet_.remove(api)}}onRackInputChange_(ev){let bc=ev.bladeController;if(bc instanceof InputBindingController){let api=getApiByController(this.apiSet_,bc),binding=bc.binding;this.emitter_.emit("change",{event:new TpChangeEvent(api,forceCast(binding.target.read()),binding.target.presetKey,ev.options.last)})}else if(bc instanceof ValueBladeController){let api=getApiByController(this.apiSet_,bc);this.emitter_.emit("change",{event:new TpChangeEvent(api,bc.value.rawValue,void 0,ev.options.last)})}}onRackMonitorUpdate_(ev){if(!(ev.bladeController instanceof MonitorBindingController))throw TpError.shouldNeverHappen();let api=getApiByController(this.apiSet_,ev.bladeController),binding=ev.bladeController.binding;this.emitter_.emit("update",{event:new TpUpdateEvent(api,forceCast(binding.target.read()),binding.target.presetKey)})}}class FolderApi extends RackLikeApi{constructor(controller,pool){super(controller,new RackApi(controller.rackController,pool));this.emitter_=new Emitter,this.controller_.foldable.value("expanded").emitter.on("change",ev=>{this.emitter_.emit("fold",{event:new TpFoldEvent(this,ev.sender.rawValue)})}),this.rackApi_.on("change",ev=>{this.emitter_.emit("change",{event:ev})}),this.rackApi_.on("update",ev=>{this.emitter_.emit("update",{event:ev})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(expanded){this.controller_.foldable.set("expanded",expanded)}get title(){return this.controller_.props.get("title")}set title(title){this.controller_.props.set("title",title)}get children(){return this.rackApi_.children}addInput(object,key,opt_params){return this.rackApi_.addInput(object,key,opt_params)}addMonitor(object,key,opt_params){return this.rackApi_.addMonitor(object,key,opt_params)}addFolder(params){return this.rackApi_.addFolder(params)}addButton(params){return this.rackApi_.addButton(params)}addSeparator(opt_params){return this.rackApi_.addSeparator(opt_params)}addTab(params){return this.rackApi_.addTab(params)}add(api,opt_index){return this.rackApi_.add(api,opt_index)}remove(api){this.rackApi_.remove(api)}addBlade(params){return this.rackApi_.addBlade(params)}on(eventName,handler){let bh=handler.bind(this);return this.emitter_.on(eventName,ev=>{bh(ev.event)}),this}}class RackLikeController extends BladeController{constructor(config){super({blade:config.blade,view:config.view,viewProps:config.rackController.viewProps});this.rackController=config.rackController}}class PlainView{constructor(doc,config){let className2=ClassName(config.viewName);this.element=doc.createElement("div"),this.element.classList.add(className2()),config.viewProps.bindClassModifiers(this.element)}}function findInputBindingController(bcs,b){for(let i=0;i<bcs.length;i++){let bc=bcs[i];if(bc instanceof InputBindingController&&bc.binding===b)return bc}return null}function findMonitorBindingController(bcs,b){for(let i=0;i<bcs.length;i++){let bc=bcs[i];if(bc instanceof MonitorBindingController&&bc.binding===b)return bc}return null}function findValueBladeController(bcs,v){for(let i=0;i<bcs.length;i++){let bc=bcs[i];if(bc instanceof ValueBladeController&&bc.value===v)return bc}return null}function findSubRack(bc){return bc instanceof RackController?bc.rack:bc instanceof RackLikeController?bc.rackController.rack:null}function findSubBladeControllerSet(bc){let rack=findSubRack(bc);return rack?rack.bcSet_:null}class BladeRack{constructor(blade){var _a;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new Emitter,this.blade_=blade!=null?blade:null,(_a=this.blade_)===null||_a===void 0||_a.value("positions").emitter.on("change",this.onBladePositionsChange_),this.bcSet_=new NestedOrderedSet(findSubBladeControllerSet),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(bc,opt_index){bc.parent&&bc.parent.remove(bc),bc.parent_=this,this.bcSet_.add(bc,opt_index)}remove(bc){bc.parent_=null,this.bcSet_.remove(bc)}find(controllerClass){return forceCast(this.bcSet_.allItems().filter(bc=>bc instanceof controllerClass))}onSetAdd_(ev){this.updatePositions_();let isRoot=ev.target===ev.root;if(this.emitter.emit("add",{bladeController:ev.item,index:ev.index,isRoot,sender:this}),!isRoot)return;let bc=ev.item;if(bc.viewProps.emitter.on("change",this.onChildViewPropsChange_),bc.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),bc.viewProps.handleDispose(this.onChildDispose_),bc instanceof InputBindingController)bc.binding.emitter.on("change",this.onChildInputChange_);else if(bc instanceof MonitorBindingController)bc.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(bc instanceof ValueBladeController)bc.value.emitter.on("change",this.onChildValueChange_);else{let rack=findSubRack(bc);if(rack){let emitter=rack.emitter;emitter.on("layout",this.onDescendantLayout_),emitter.on("inputchange",this.onDescendantInputChange_),emitter.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(ev){this.updatePositions_();let isRoot=ev.target===ev.root;if(this.emitter.emit("remove",{bladeController:ev.item,isRoot,sender:this}),!isRoot)return;let bc=ev.item;if(bc instanceof InputBindingController)bc.binding.emitter.off("change",this.onChildInputChange_);else if(bc instanceof MonitorBindingController)bc.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(bc instanceof ValueBladeController)bc.value.emitter.off("change",this.onChildValueChange_);else{let rack=findSubRack(bc);if(rack){let emitter=rack.emitter;emitter.off("layout",this.onDescendantLayout_),emitter.off("inputchange",this.onDescendantInputChange_),emitter.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){let visibleItems=this.bcSet_.items.filter(bc=>!bc.viewProps.get("hidden")),firstVisibleItem=visibleItems[0],lastVisibleItem=visibleItems[visibleItems.length-1];this.bcSet_.items.forEach(bc=>{let ps=[];bc===firstVisibleItem&&(ps.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&ps.push("veryfirst")),bc===lastVisibleItem&&(ps.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&ps.push("verylast")),bc.blade.set("positions",ps)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(_ev){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(bc=>bc.viewProps.get("disposed")).forEach(bc=>{this.bcSet_.remove(bc)})}onChildInputChange_(ev){let bc=findInputBindingController(this.find(InputBindingController),ev.sender);if(!bc)throw TpError.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:bc,options:ev.options,sender:this})}onChildMonitorUpdate_(ev){let bc=findMonitorBindingController(this.find(MonitorBindingController),ev.sender);if(!bc)throw TpError.shouldNeverHappen();this.emitter.emit("monitorupdate",{bladeController:bc,sender:this})}onChildValueChange_(ev){let bc=findValueBladeController(this.find(ValueBladeController),ev.sender);if(!bc)throw TpError.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:bc,options:ev.options,sender:this})}onDescendantLayout_(_){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(ev){this.emitter.emit("inputchange",{bladeController:ev.bladeController,options:ev.options,sender:this})}onDescendantMonitorUpdate_(ev){this.emitter.emit("monitorupdate",{bladeController:ev.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class RackController extends BladeController{constructor(doc,config){super(Object.assign(Object.assign({},config),{view:new PlainView(doc,{viewName:"brk",viewProps:config.viewProps})}));this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);let rack=new BladeRack(config.root?void 0:config.blade);rack.emitter.on("add",this.onRackAdd_),rack.emitter.on("remove",this.onRackRemove_),this.rack=rack,this.viewProps.handleDispose(()=>{for(let i=this.rack.children.length-1;i>=0;i--)this.rack.children[i].viewProps.set("disposed",!0)})}onRackAdd_(ev){!ev.isRoot||insertElementAt(this.view.element,ev.bladeController.view.element,ev.index)}onRackRemove_(ev){!ev.isRoot||removeElement(ev.bladeController.view.element)}}let bladeContainerClassName=ClassName("cnt");class FolderView{constructor(doc,config){this.className_=ClassName(config.viewName||"fld"),this.element=doc.createElement("div"),this.element.classList.add(this.className_(),bladeContainerClassName()),config.viewProps.bindClassModifiers(this.element),this.foldable_=config.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),bindValueMap(this.foldable_,"completed",valueToClassName(this.element,this.className_(void 0,"cpl")));let buttonElem=doc.createElement("button");buttonElem.classList.add(this.className_("b")),bindValueMap(config.props,"title",title=>{isEmpty(title)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),config.viewProps.bindDisabled(buttonElem),this.element.appendChild(buttonElem),this.buttonElement=buttonElem;let titleElem=doc.createElement("div");titleElem.classList.add(this.className_("t")),bindValueToTextContent(config.props.value("title"),titleElem),this.buttonElement.appendChild(titleElem),this.titleElement=titleElem;let markElem=doc.createElement("div");markElem.classList.add(this.className_("m")),this.buttonElement.appendChild(markElem);let containerElem=config.containerElement;containerElem.classList.add(this.className_("c")),this.element.appendChild(containerElem),this.containerElement=containerElem}}class FolderController extends RackLikeController{constructor(doc,config){var _a;let foldable=Foldable.create((_a=config.expanded)!==null&&_a!==void 0?_a:!0),rc=new RackController(doc,{blade:config.blade,root:config.root,viewProps:config.viewProps});super(Object.assign(Object.assign({},config),{rackController:rc,view:new FolderView(doc,{containerElement:rc.view.element,foldable,props:config.props,viewName:config.root?"rot":void 0,viewProps:config.viewProps})}));this.onTitleClick_=this.onTitleClick_.bind(this),this.props=config.props,this.foldable=foldable,bindFoldable(this.foldable,this.view.containerElement),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}let FolderBladePlugin={id:"folder",type:"blade",accept(params){let p=ParamsParsers,result=parseParams(params,{title:p.required.string,view:p.required.constant("folder"),expanded:p.optional.boolean});return result?{params:result}:null},controller(args){return new FolderController(args.document,{blade:args.blade,expanded:args.params.expanded,props:ValueMap.fromObject({title:args.params.title}),viewProps:args.viewProps})},api(args){return args.controller instanceof FolderController?new FolderApi(args.controller,args.pool):null}};class LabeledValueController extends ValueBladeController{constructor(doc,config){let viewProps=config.valueController.viewProps;super(Object.assign(Object.assign({},config),{value:config.valueController.value,view:new LabelView(doc,{props:config.props,viewProps}),viewProps}));this.props=config.props,this.valueController=config.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class SeparatorApi extends BladeApi{}let className$n=ClassName("spr");class SeparatorView{constructor(doc,config){this.element=doc.createElement("div"),this.element.classList.add(className$n()),config.viewProps.bindClassModifiers(this.element);let hrElem=doc.createElement("hr");hrElem.classList.add(className$n("r")),this.element.appendChild(hrElem)}}class SeparatorController extends BladeController{constructor(doc,config){super(Object.assign(Object.assign({},config),{view:new SeparatorView(doc,{viewProps:config.viewProps})}))}}let SeparatorBladePlugin={id:"separator",type:"blade",accept(params){let result=parseParams(params,{view:ParamsParsers.required.constant("separator")});return result?{params:result}:null},controller(args){return new SeparatorController(args.document,{blade:args.blade,viewProps:args.viewProps})},api(args){return args.controller instanceof SeparatorController?new SeparatorApi(args.controller):null}},className$m=ClassName("");function valueToModifier(elem,modifier){return valueToClassName(elem,className$m(void 0,modifier))}class ViewProps extends ValueMap{constructor(valueMap){super(valueMap)}static create(opt_initialValue){var _a,_b;let initialValue=opt_initialValue!=null?opt_initialValue:{},coreObj={disabled:(_a=initialValue.disabled)!==null&&_a!==void 0?_a:!1,disposed:!1,hidden:(_b=initialValue.hidden)!==null&&_b!==void 0?_b:!1},core=ValueMap.createCore(coreObj);return new ViewProps(core)}bindClassModifiers(elem){bindValueMap(this,"disabled",valueToModifier(elem,"disabled")),bindValueMap(this,"hidden",valueToModifier(elem,"hidden"))}bindDisabled(target){bindValueMap(this,"disabled",disabled=>{target.disabled=disabled})}bindTabIndex(elem){bindValueMap(this,"disabled",disabled=>{elem.tabIndex=disabled?-1:0})}handleDispose(callback){this.value("disposed").emitter.on("change",disposed=>{disposed&&callback()})}}let className$l=ClassName("tbi");class TabItemView{constructor(doc,config){this.element=doc.createElement("div"),this.element.classList.add(className$l()),config.viewProps.bindClassModifiers(this.element),bindValueMap(config.props,"selected",selected=>{selected?this.element.classList.add(className$l(void 0,"sel")):this.element.classList.remove(className$l(void 0,"sel"))});let buttonElem=doc.createElement("button");buttonElem.classList.add(className$l("b")),config.viewProps.bindDisabled(buttonElem),this.element.appendChild(buttonElem),this.buttonElement=buttonElem;let titleElem=doc.createElement("div");titleElem.classList.add(className$l("t")),bindValueToTextContent(config.props.value("title"),titleElem),this.buttonElement.appendChild(titleElem),this.titleElement=titleElem}}class TabItemController{constructor(doc,config){this.emitter=new Emitter,this.onClick_=this.onClick_.bind(this),this.props=config.props,this.viewProps=config.viewProps,this.view=new TabItemView(doc,{props:config.props,viewProps:config.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class TabPageController{constructor(doc,config){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new TabItemController(doc,{props:config.itemProps,viewProps:ViewProps.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new RackController(doc,{blade:createBlade(),viewProps:ViewProps.create()}),this.props=config.props,bindValueMap(this.props,"selected",selected=>{this.itemController.props.set("selected",selected),this.contentController.viewProps.set("hidden",!selected)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class TabPageApi{constructor(controller,contentRackApi){this.controller_=controller,this.rackApi_=contentRackApi}get title(){var _a;return(_a=this.controller_.itemController.props.get("title"))!==null&&_a!==void 0?_a:""}set title(title){this.controller_.itemController.props.set("title",title)}get selected(){return this.controller_.props.get("selected")}set selected(selected){this.controller_.props.set("selected",selected)}get children(){return this.rackApi_.children}addButton(params){return this.rackApi_.addButton(params)}addFolder(params){return this.rackApi_.addFolder(params)}addSeparator(opt_params){return this.rackApi_.addSeparator(opt_params)}addTab(params){return this.rackApi_.addTab(params)}add(api,opt_index){this.rackApi_.add(api,opt_index)}remove(api){this.rackApi_.remove(api)}addInput(object,key,opt_params){return this.rackApi_.addInput(object,key,opt_params)}addMonitor(object,key,opt_params){return this.rackApi_.addMonitor(object,key,opt_params)}addBlade(params){return this.rackApi_.addBlade(params)}}class TabApi extends RackLikeApi{constructor(controller,pool){super(controller,new RackApi(controller.rackController,pool));this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.emitter_=new Emitter,this.pageApiMap_=new Map,this.rackApi_.on("change",ev=>{this.emitter_.emit("change",{event:ev})}),this.rackApi_.on("update",ev=>{this.emitter_.emit("update",{event:ev})}),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(pc=>{this.setUpPageApi_(pc)})}get pages(){return this.controller_.pageSet.items.map(pc=>{let api=this.pageApiMap_.get(pc);if(!api)throw TpError.shouldNeverHappen();return api})}addPage(params){let doc=this.controller_.view.element.ownerDocument,pc=new TabPageController(doc,{itemProps:ValueMap.fromObject({selected:!1,title:params.title}),props:ValueMap.fromObject({selected:!1})});this.controller_.add(pc,params.index);let api=this.pageApiMap_.get(pc);if(!api)throw TpError.shouldNeverHappen();return api}removePage(index){this.controller_.remove(index)}on(eventName,handler){let bh=handler.bind(this);return this.emitter_.on(eventName,ev=>{bh(ev.event)}),this}setUpPageApi_(pc){let rackApi=this.rackApi_.apiSet_.find(api2=>api2.controller_===pc.contentController);if(!rackApi)throw TpError.shouldNeverHappen();let api=new TabPageApi(pc,rackApi);this.pageApiMap_.set(pc,api)}onPageAdd_(ev){this.setUpPageApi_(ev.item)}onPageRemove_(ev){if(!this.pageApiMap_.get(ev.item))throw TpError.shouldNeverHappen();this.pageApiMap_.delete(ev.item)}}let className$k=ClassName("tab");class TabView{constructor(doc,config){this.element=doc.createElement("div"),this.element.classList.add(className$k(),bladeContainerClassName()),config.viewProps.bindClassModifiers(this.element),bindValue(config.empty,valueToClassName(this.element,className$k(void 0,"nop")));let itemsElem=doc.createElement("div");itemsElem.classList.add(className$k("i")),this.element.appendChild(itemsElem),this.itemsElement=itemsElem;let contentsElem=config.contentsElement;contentsElem.classList.add(className$k("c")),this.element.appendChild(contentsElem),this.contentsElement=contentsElem}}class TabController extends RackLikeController{constructor(doc,config){let cr=new RackController(doc,{blade:config.blade,viewProps:config.viewProps}),empty=createValue(!0);super({blade:config.blade,rackController:cr,view:new TabView(doc,{contentsElement:cr.view.element,empty,viewProps:config.viewProps})});this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onPageSelectedChange_=this.onPageSelectedChange_.bind(this),this.pageSet_=new NestedOrderedSet(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.empty_=empty,this.applyPages_()}get pageSet(){return this.pageSet_}add(pc,opt_index){this.pageSet_.add(pc,opt_index!=null?opt_index:this.pageSet_.items.length)}remove(index){this.pageSet_.remove(this.pageSet_.items[index])}applyPages_(){this.keepSelection_(),this.empty_.rawValue=this.pageSet_.items.length===0}onPageAdd_(ev){let pc=ev.item;insertElementAt(this.view.itemsElement,pc.itemController.view.element,ev.index),this.rackController.rack.add(pc.contentController,ev.index),pc.props.value("selected").emitter.on("change",this.onPageSelectedChange_),this.applyPages_()}onPageRemove_(ev){let pc=ev.item;removeElement(pc.itemController.view.element),this.rackController.rack.remove(pc.contentController),pc.props.value("selected").emitter.off("change",this.onPageSelectedChange_),this.applyPages_()}keepSelection_(){if(this.pageSet_.items.length===0)return;let firstSelIndex=this.pageSet_.items.findIndex(pc=>pc.props.get("selected"));firstSelIndex<0?this.pageSet_.items.forEach((pc,i)=>{pc.props.set("selected",i===0)}):this.pageSet_.items.forEach((pc,i)=>{pc.props.set("selected",i===firstSelIndex)})}onPageSelectedChange_(ev){if(ev.rawValue){let index=this.pageSet_.items.findIndex(pc=>pc.props.value("selected")===ev.sender);this.pageSet_.items.forEach((pc,i)=>{pc.props.set("selected",i===index)})}else this.keepSelection_()}}let TabBladePlugin={id:"tab",type:"blade",accept(params){let p=ParamsParsers,result=parseParams(params,{pages:p.required.array(p.required.object({title:p.required.string})),view:p.required.constant("tab")});return!result||result.pages.length===0?null:{params:result}},controller(args){let c=new TabController(args.document,{blade:args.blade,viewProps:args.viewProps});return args.params.pages.forEach(p=>{let pc=new TabPageController(args.document,{itemProps:ValueMap.fromObject({selected:!1,title:p.title}),props:ValueMap.fromObject({selected:!1})});c.add(pc)}),c},api(args){return args.controller instanceof TabController?new TabApi(args.controller,args.pool):null}};function createBladeController(plugin,args){let ac=plugin.accept(args.params);if(!ac)return null;let disabled=ParamsParsers.optional.boolean(args.params.disabled).value,hidden=ParamsParsers.optional.boolean(args.params.hidden).value;return plugin.controller({blade:createBlade(),document:args.document,params:forceCast(Object.assign(Object.assign({},ac.params),{disabled,hidden})),viewProps:ViewProps.create({disabled,hidden})})}class ManualTicker{constructor(){this.disabled=!1,this.emitter=new Emitter}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class IntervalTicker{constructor(doc,interval){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=doc,this.emitter=new Emitter,this.interval_=interval,this.setTimer_()}get disabled(){return this.disabled_}set disabled(inactive){this.disabled_=inactive,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;let win=this.doc_.defaultView;win&&win.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;let win=this.doc_.defaultView;win&&(this.timerId_=win.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class CompositeConstraint{constructor(constraints){this.constraints=constraints}constrain(value){return this.constraints.reduce((result,c)=>c.constrain(result),value)}}function findConstraint(c,constraintClass){if(c instanceof constraintClass)return c;if(c instanceof CompositeConstraint){let result=c.constraints.reduce((tmpResult,sc)=>tmpResult||(sc instanceof constraintClass?sc:null),null);if(result)return result}return null}class ListConstraint{constructor(options){this.options=options}constrain(value){let opts=this.options;return opts.length===0||opts.filter(item=>item.value===value).length>0?value:opts[0].value}}class RangeConstraint{constructor(config){this.maxValue=config.max,this.minValue=config.min}constrain(value){let result=value;return isEmpty(this.minValue)||(result=Math.max(result,this.minValue)),isEmpty(this.maxValue)||(result=Math.min(result,this.maxValue)),result}}class StepConstraint{constructor(step2){this.step=step2}constrain(value){return(value<0?-Math.round(-value/this.step):Math.round(value/this.step))*this.step}}let className$j=ClassName("lst");class ListView{constructor(doc,config){this.onValueChange_=this.onValueChange_.bind(this),this.props_=config.props,this.element=doc.createElement("div"),this.element.classList.add(className$j()),config.viewProps.bindClassModifiers(this.element);let selectElem=doc.createElement("select");selectElem.classList.add(className$j("s")),bindValueMap(this.props_,"options",opts=>{removeChildElements(selectElem),opts.forEach((item,index)=>{let optionElem=doc.createElement("option");optionElem.dataset.index=String(index),optionElem.textContent=item.text,optionElem.value=String(item.value),selectElem.appendChild(optionElem)})}),config.viewProps.bindDisabled(selectElem),this.element.appendChild(selectElem),this.selectElement=selectElem;let markElem=doc.createElement("div");markElem.classList.add(className$j("m")),markElem.appendChild(createSvgIconElement(doc,"dropdown")),this.element.appendChild(markElem),config.value.emitter.on("change",this.onValueChange_),this.value_=config.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class ListController{constructor(doc,config){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=config.props,this.value=config.value,this.viewProps=config.viewProps,this.view=new ListView(doc,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){let optElem=forceCast(e.currentTarget).selectedOptions.item(0);if(!optElem)return;let itemIndex=Number(optElem.dataset.index);this.value.rawValue=this.props.get("options")[itemIndex].value}}let className$i=ClassName("pop");class PopupView{constructor(doc,config){this.element=doc.createElement("div"),this.element.classList.add(className$i()),config.viewProps.bindClassModifiers(this.element),bindValue(config.shows,valueToClassName(this.element,className$i(void 0,"v")))}}class PopupController{constructor(doc,config){this.shows=createValue(!1),this.viewProps=config.viewProps,this.view=new PopupView(doc,{shows:this.shows,viewProps:this.viewProps})}}let className$h=ClassName("txt");class TextView{constructor(doc,config){this.onChange_=this.onChange_.bind(this),this.element=doc.createElement("div"),this.element.classList.add(className$h()),config.viewProps.bindClassModifiers(this.element),this.props_=config.props,this.props_.emitter.on("change",this.onChange_);let inputElem=doc.createElement("input");inputElem.classList.add(className$h("i")),inputElem.type="text",config.viewProps.bindDisabled(inputElem),this.element.appendChild(inputElem),this.inputElement=inputElem,config.value.emitter.on("change",this.onChange_),this.value_=config.value,this.refresh()}refresh(){let formatter=this.props_.get("formatter");this.inputElement.value=formatter(this.value_.rawValue)}onChange_(){this.refresh()}}class TextController{constructor(doc,config){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=config.parser,this.props=config.props,this.value=config.value,this.viewProps=config.viewProps,this.view=new TextView(doc,{props:config.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){let value=forceCast(e.currentTarget).value,parsedValue=this.parser_(value);isEmpty(parsedValue)||(this.value.rawValue=parsedValue),this.view.refresh()}}function boolToString(value){return String(value)}function boolFromUnknown(value){return value==="false"?!1:!!value}function BooleanFormatter(value){return boolToString(value)}class NumberLiteralNode{constructor(text){this.text=text}evaluate(){return Number(this.text)}toString(){return this.text}}let BINARY_OPERATION_MAP={"**":(v1,v2)=>Math.pow(v1,v2),"*":(v1,v2)=>v1*v2,"/":(v1,v2)=>v1/v2,"%":(v1,v2)=>v1%v2,"+":(v1,v2)=>v1+v2,"-":(v1,v2)=>v1-v2,"<<":(v1,v2)=>v1<<v2,">>":(v1,v2)=>v1>>v2,">>>":(v1,v2)=>v1>>>v2,"&":(v1,v2)=>v1&v2,"^":(v1,v2)=>v1^v2,"|":(v1,v2)=>v1|v2};class BinaryOperationNode{constructor(operator,left,right){this.left=left,this.operator=operator,this.right=right}evaluate(){let op=BINARY_OPERATION_MAP[this.operator];if(!op)throw new Error(`unexpected binary operator: '${this.operator}`);return op(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}let UNARY_OPERATION_MAP={"+":v=>v,"-":v=>-v,"~":v=>~v};class UnaryOperationNode{constructor(operator,expr){this.operator=operator,this.expression=expr}evaluate(){let op=UNARY_OPERATION_MAP[this.operator];if(!op)throw new Error(`unexpected unary operator: '${this.operator}`);return op(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function combineReader(parsers){return(text,cursor)=>{for(let i=0;i<parsers.length;i++){let result=parsers[i](text,cursor);if(result!=="")return result}return""}}function readWhitespace(text,cursor){var _a;let m=text.substr(cursor).match(/^\s+/);return(_a=m&&m[0])!==null&&_a!==void 0?_a:""}function readNonZeroDigit(text,cursor){let ch=text.substr(cursor,1);return ch.match(/^[1-9]$/)?ch:""}function readDecimalDigits(text,cursor){var _a;let m=text.substr(cursor).match(/^[0-9]+/);return(_a=m&&m[0])!==null&&_a!==void 0?_a:""}function readSignedInteger(text,cursor){let ds=readDecimalDigits(text,cursor);if(ds!=="")return ds;let sign=text.substr(cursor,1);if(cursor+=1,sign!=="-"&&sign!=="+")return"";let sds=readDecimalDigits(text,cursor);return sds===""?"":sign+sds}function readExponentPart(text,cursor){let e=text.substr(cursor,1);if(cursor+=1,e.toLowerCase()!=="e")return"";let si=readSignedInteger(text,cursor);return si===""?"":e+si}function readDecimalIntegerLiteral(text,cursor){let ch=text.substr(cursor,1);if(ch==="0")return ch;let nzd=readNonZeroDigit(text,cursor);return cursor+=nzd.length,nzd===""?"":nzd+readDecimalDigits(text,cursor)}function readDecimalLiteral1(text,cursor){let dil=readDecimalIntegerLiteral(text,cursor);if(cursor+=dil.length,dil==="")return"";let dot=text.substr(cursor,1);if(cursor+=dot.length,dot!==".")return"";let dds=readDecimalDigits(text,cursor);return cursor+=dds.length,dil+dot+dds+readExponentPart(text,cursor)}function readDecimalLiteral2(text,cursor){let dot=text.substr(cursor,1);if(cursor+=dot.length,dot!==".")return"";let dds=readDecimalDigits(text,cursor);return cursor+=dds.length,dds===""?"":dot+dds+readExponentPart(text,cursor)}function readDecimalLiteral3(text,cursor){let dil=readDecimalIntegerLiteral(text,cursor);return cursor+=dil.length,dil===""?"":dil+readExponentPart(text,cursor)}let readDecimalLiteral=combineReader([readDecimalLiteral1,readDecimalLiteral2,readDecimalLiteral3]);function parseBinaryDigits(text,cursor){var _a;let m=text.substr(cursor).match(/^[01]+/);return(_a=m&&m[0])!==null&&_a!==void 0?_a:""}function readBinaryIntegerLiteral(text,cursor){let prefix=text.substr(cursor,2);if(cursor+=prefix.length,prefix.toLowerCase()!=="0b")return"";let bds=parseBinaryDigits(text,cursor);return bds===""?"":prefix+bds}function readOctalDigits(text,cursor){var _a;let m=text.substr(cursor).match(/^[0-7]+/);return(_a=m&&m[0])!==null&&_a!==void 0?_a:""}function readOctalIntegerLiteral(text,cursor){let prefix=text.substr(cursor,2);if(cursor+=prefix.length,prefix.toLowerCase()!=="0o")return"";let ods=readOctalDigits(text,cursor);return ods===""?"":prefix+ods}function readHexDigits(text,cursor){var _a;let m=text.substr(cursor).match(/^[0-9a-f]+/i);return(_a=m&&m[0])!==null&&_a!==void 0?_a:""}function readHexIntegerLiteral(text,cursor){let prefix=text.substr(cursor,2);if(cursor+=prefix.length,prefix.toLowerCase()!=="0x")return"";let hds=readHexDigits(text,cursor);return hds===""?"":prefix+hds}let readNonDecimalIntegerLiteral=combineReader([readBinaryIntegerLiteral,readOctalIntegerLiteral,readHexIntegerLiteral]),readNumericLiteral=combineReader([readNonDecimalIntegerLiteral,readDecimalLiteral]);function parseLiteral(text,cursor){let num=readNumericLiteral(text,cursor);return cursor+=num.length,num===""?null:{evaluable:new NumberLiteralNode(num),cursor}}function parseParenthesizedExpression(text,cursor){let op=text.substr(cursor,1);if(cursor+=op.length,op!=="(")return null;let expr=parseExpression(text,cursor);if(!expr)return null;cursor=expr.cursor,cursor+=readWhitespace(text,cursor).length;let cl=text.substr(cursor,1);return cursor+=cl.length,cl!==")"?null:{evaluable:expr.evaluable,cursor}}function parsePrimaryExpression(text,cursor){return parseLiteral(text,cursor)||parseParenthesizedExpression(text,cursor)}function parseUnaryExpression(text,cursor){let expr=parsePrimaryExpression(text,cursor);if(expr)return expr;let op=text.substr(cursor,1);if(cursor+=op.length,op!=="+"&&op!=="-"&&op!=="~")return null;let num=parseUnaryExpression(text,cursor);return num?(cursor=num.cursor,{cursor,evaluable:new UnaryOperationNode(op,num.evaluable)}):null}function readBinaryOperator(ops,text,cursor){cursor+=readWhitespace(text,cursor).length;let op=ops.filter(op2=>text.startsWith(op2,cursor))[0];return op?(cursor+=op.length,cursor+=readWhitespace(text,cursor).length,{cursor,operator:op}):null}function createBinaryOperationExpressionParser(exprParser,ops){return(text,cursor)=>{let firstExpr=exprParser(text,cursor);if(!firstExpr)return null;cursor=firstExpr.cursor;let expr=firstExpr.evaluable;for(;;){let op=readBinaryOperator(ops,text,cursor);if(!op)break;cursor=op.cursor;let nextExpr=exprParser(text,cursor);if(!nextExpr)return null;cursor=nextExpr.cursor,expr=new BinaryOperationNode(op.operator,expr,nextExpr.evaluable)}return expr?{cursor,evaluable:expr}:null}}let parseBinaryOperationExpression=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((parser,ops)=>createBinaryOperationExpressionParser(parser,ops),parseUnaryExpression);function parseExpression(text,cursor){return cursor+=readWhitespace(text,cursor).length,parseBinaryOperationExpression(text,cursor)}function parseEcmaNumberExpression(text){let expr=parseExpression(text,0);return!expr||expr.cursor+readWhitespace(text,expr.cursor).length!==text.length?null:expr.evaluable}function parseNumber(text){var _a;let r=parseEcmaNumberExpression(text);return(_a=r==null?void 0:r.evaluate())!==null&&_a!==void 0?_a:null}function numberFromUnknown(value){if(typeof value=="number")return value;if(typeof value=="string"){let pv=parseNumber(value);if(!isEmpty(pv))return pv}return 0}function numberToString(value){return String(value)}function createNumberFormatter(digits){return value=>value.toFixed(Math.max(Math.min(digits,20),0))}let innerFormatter=createNumberFormatter(0);function formatPercentage(value){return innerFormatter(value)+"%"}function stringFromUnknown(value){return String(value)}function formatString(value){return value}function fillBuffer(buffer,bufferSize){for(;buffer.length<bufferSize;)buffer.push(void 0)}function initializeBuffer(bufferSize){let buffer=[];return fillBuffer(buffer,bufferSize),createValue(buffer)}function createTrimmedBuffer(buffer){let index=buffer.indexOf(void 0);return forceCast(index<0?buffer:buffer.slice(0,index))}function createPushedBuffer(buffer,newValue){let newBuffer=[...createTrimmedBuffer(buffer),newValue];return newBuffer.length>buffer.length?newBuffer.splice(0,newBuffer.length-buffer.length):fillBuffer(newBuffer,buffer.length),newBuffer}function connectValues({primary,secondary,forward,backward}){let changing=!1;function preventFeedback(callback){changing||(changing=!0,callback(),changing=!1)}primary.emitter.on("change",ev=>{preventFeedback(()=>{secondary.setRawValue(forward(primary,secondary),ev.options)})}),secondary.emitter.on("change",ev=>{preventFeedback(()=>{primary.setRawValue(backward(primary,secondary),ev.options)}),preventFeedback(()=>{secondary.setRawValue(forward(primary,secondary),ev.options)})}),preventFeedback(()=>{secondary.setRawValue(forward(primary,secondary),{forceEmit:!1,last:!0})})}function getStepForKey(baseStep,keys){let step2=baseStep*(keys.altKey?.1:1)*(keys.shiftKey?10:1);return keys.upKey?+step2:keys.downKey?-step2:0}function getVerticalStepKeys(ev){return{altKey:ev.altKey,downKey:ev.key==="ArrowDown",shiftKey:ev.shiftKey,upKey:ev.key==="ArrowUp"}}function getHorizontalStepKeys(ev){return{altKey:ev.altKey,downKey:ev.key==="ArrowLeft",shiftKey:ev.shiftKey,upKey:ev.key==="ArrowRight"}}function isVerticalArrowKey(key){return key==="ArrowUp"||key==="ArrowDown"}function isArrowKey(key){return isVerticalArrowKey(key)||key==="ArrowLeft"||key==="ArrowRight"}function computeOffset$1(ev,elem){let win=elem.ownerDocument.defaultView,rect=elem.getBoundingClientRect();return{x:ev.pageX-((win&&win.scrollX||0)+rect.left),y:ev.pageY-((win&&win.scrollY||0)+rect.top)}}class PointerHandler{constructor(element){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=element,this.emitter=new Emitter,element.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),element.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),element.addEventListener("touchend",this.onTouchEnd_),element.addEventListener("mousedown",this.onMouseDown_)}computePosition_(offset){let rect=this.elem_.getBoundingClientRect();return{bounds:{width:rect.width,height:rect.height},point:offset?{x:offset.x,y:offset.y}:null}}onMouseDown_(ev){var _a;ev.preventDefault(),(_a=ev.currentTarget)===null||_a===void 0||_a.focus();let doc=this.elem_.ownerDocument;doc.addEventListener("mousemove",this.onDocumentMouseMove_),doc.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:ev.altKey,data:this.computePosition_(computeOffset$1(ev,this.elem_)),sender:this,shiftKey:ev.shiftKey})}onDocumentMouseMove_(ev){this.emitter.emit("move",{altKey:ev.altKey,data:this.computePosition_(computeOffset$1(ev,this.elem_)),sender:this,shiftKey:ev.shiftKey})}onDocumentMouseUp_(ev){let doc=this.elem_.ownerDocument;doc.removeEventListener("mousemove",this.onDocumentMouseMove_),doc.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:ev.altKey,data:this.computePosition_(computeOffset$1(ev,this.elem_)),sender:this,shiftKey:ev.shiftKey})}onTouchStart_(ev){ev.preventDefault();let touch=ev.targetTouches.item(0),rect=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:ev.altKey,data:this.computePosition_(touch?{x:touch.clientX-rect.left,y:touch.clientY-rect.top}:void 0),sender:this,shiftKey:ev.shiftKey}),this.lastTouch_=touch}onTouchMove_(ev){let touch=ev.targetTouches.item(0),rect=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:ev.altKey,data:this.computePosition_(touch?{x:touch.clientX-rect.left,y:touch.clientY-rect.top}:void 0),sender:this,shiftKey:ev.shiftKey}),this.lastTouch_=touch}onTouchEnd_(ev){var _a;let touch=(_a=ev.targetTouches.item(0))!==null&&_a!==void 0?_a:this.lastTouch_,rect=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:ev.altKey,data:this.computePosition_(touch?{x:touch.clientX-rect.left,y:touch.clientY-rect.top}:void 0),sender:this,shiftKey:ev.shiftKey})}}function mapRange(value,start1,end1,start2,end2){let p=(value-start1)/(end1-start1);return start2+p*(end2-start2)}function getDecimalDigits(value){return String(value.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function constrainRange(value,min,max){return Math.min(Math.max(value,min),max)}function loopRange(value,max){return(value%max+max)%max}let className$g=ClassName("txt");class NumberTextView{constructor(doc,config){this.onChange_=this.onChange_.bind(this),this.props_=config.props,this.props_.emitter.on("change",this.onChange_),this.element=doc.createElement("div"),this.element.classList.add(className$g(),className$g(void 0,"num")),config.arrayPosition&&this.element.classList.add(className$g(void 0,config.arrayPosition)),config.viewProps.bindClassModifiers(this.element);let inputElem=doc.createElement("input");inputElem.classList.add(className$g("i")),inputElem.type="text",config.viewProps.bindDisabled(inputElem),this.element.appendChild(inputElem),this.inputElement=inputElem,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=config.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(className$g()),this.inputElement.classList.add(className$g("i"));let knobElem=doc.createElement("div");knobElem.classList.add(className$g("k")),this.element.appendChild(knobElem),this.knobElement=knobElem;let guideElem=doc.createElementNS(SVG_NS,"svg");guideElem.classList.add(className$g("g")),this.knobElement.appendChild(guideElem);let bodyElem=doc.createElementNS(SVG_NS,"path");bodyElem.classList.add(className$g("gb")),guideElem.appendChild(bodyElem),this.guideBodyElem_=bodyElem;let headElem=doc.createElementNS(SVG_NS,"path");headElem.classList.add(className$g("gh")),guideElem.appendChild(headElem),this.guideHeadElem_=headElem;let tooltipElem=doc.createElement("div");tooltipElem.classList.add(ClassName("tt")()),this.knobElement.appendChild(tooltipElem),this.tooltipElem_=tooltipElem,config.value.emitter.on("change",this.onChange_),this.value=config.value,this.refresh()}onDraggingChange_(ev){if(ev.rawValue===null){this.element.classList.remove(className$g(void 0,"drg"));return}this.element.classList.add(className$g(void 0,"drg"));let x=ev.rawValue/this.props_.get("draggingScale"),aox=x+(x>0?-1:x<0?1:0),adx=constrainRange(-aox,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${aox+adx},0 L${aox},4 L${aox+adx},8`,`M ${x},-1 L${x},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${x},4`);let formatter=this.props_.get("formatter");this.tooltipElem_.textContent=formatter(this.value.rawValue),this.tooltipElem_.style.left=`${x}px`}refresh(){let formatter=this.props_.get("formatter");this.inputElement.value=formatter(this.value.rawValue)}onChange_(){this.refresh()}}class NumberTextController{constructor(doc,config){this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=config.baseStep,this.parser_=config.parser,this.props=config.props,this.value=config.value,this.viewProps=config.viewProps,this.dragging_=createValue(null),this.view=new NumberTextView(doc,{arrayPosition:config.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);let ph=new PointerHandler(this.view.knobElement);ph.emitter.on("down",this.onPointerDown_),ph.emitter.on("move",this.onPointerMove_),ph.emitter.on("up",this.onPointerUp_)}onInputChange_(e){let value=forceCast(e.currentTarget).value,parsedValue=this.parser_(value);isEmpty(parsedValue)||(this.value.rawValue=parsedValue),this.view.refresh()}onInputKeyDown_(ev){let step2=getStepForKey(this.baseStep_,getVerticalStepKeys(ev));step2!==0&&this.value.setRawValue(this.value.rawValue+step2,{forceEmit:!1,last:!1})}onInputKeyUp_(ev){getStepForKey(this.baseStep_,getVerticalStepKeys(ev))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(data){if(!data.point)return null;let dx=data.point.x-data.bounds.width/2;return this.originRawValue_+dx*this.props.get("draggingScale")}onPointerMove_(ev){let v=this.computeDraggingValue_(ev.data);v!==null&&(this.value.setRawValue(v,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(ev){let v=this.computeDraggingValue_(ev.data);v!==null&&(this.value.setRawValue(v,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}let className$f=ClassName("sld");class SliderView{constructor(doc,config){this.onChange_=this.onChange_.bind(this),this.props_=config.props,this.props_.emitter.on("change",this.onChange_),this.element=doc.createElement("div"),this.element.classList.add(className$f()),config.viewProps.bindClassModifiers(this.element);let trackElem=doc.createElement("div");trackElem.classList.add(className$f("t")),config.viewProps.bindTabIndex(trackElem),this.element.appendChild(trackElem),this.trackElement=trackElem;let knobElem=doc.createElement("div");knobElem.classList.add(className$f("k")),this.trackElement.appendChild(knobElem),this.knobElement=knobElem,config.value.emitter.on("change",this.onChange_),this.value=config.value,this.update_()}update_(){let p=constrainRange(mapRange(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${p}%`}onChange_(){this.update_()}}class SliderController{constructor(doc,config){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=config.baseStep,this.value=config.value,this.viewProps=config.viewProps,this.props=config.props,this.view=new SliderView(doc,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new PointerHandler(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(d,opts){!d.point||this.value.setRawValue(mapRange(constrainRange(d.point.x,0,d.bounds.width),0,d.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),opts)}onPointerDownOrMove_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!1,last:!1})}onPointerUp_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!0,last:!0})}onKeyDown_(ev){let step2=getStepForKey(this.baseStep_,getHorizontalStepKeys(ev));step2!==0&&this.value.setRawValue(this.value.rawValue+step2,{forceEmit:!1,last:!1})}onKeyUp_(ev){getStepForKey(this.baseStep_,getHorizontalStepKeys(ev))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}let className$e=ClassName("sldtxt");class SliderTextView{constructor(doc,config){this.element=doc.createElement("div"),this.element.classList.add(className$e());let sliderElem=doc.createElement("div");sliderElem.classList.add(className$e("s")),this.sliderView_=config.sliderView,sliderElem.appendChild(this.sliderView_.element),this.element.appendChild(sliderElem);let textElem=doc.createElement("div");textElem.classList.add(className$e("t")),this.textView_=config.textView,textElem.appendChild(this.textView_.element),this.element.appendChild(textElem)}}class SliderTextController{constructor(doc,config){this.value=config.value,this.viewProps=config.viewProps,this.sliderC_=new SliderController(doc,{baseStep:config.baseStep,props:config.sliderProps,value:config.value,viewProps:this.viewProps}),this.textC_=new NumberTextController(doc,{baseStep:config.baseStep,parser:config.parser,props:config.textProps,value:config.value,viewProps:config.viewProps}),this.view=new SliderTextView(doc,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function writePrimitive(target,value){target.write(value)}function parseListOptions(value){let p=ParamsParsers;if(Array.isArray(value))return p.required.array(p.required.object({text:p.required.string,value:p.required.raw}))(value).value;if(typeof value=="object")return p.required.raw(value).value}function parsePickerLayout(value){if(value==="inline"||value==="popup")return value}function parsePointDimensionParams(value){let p=ParamsParsers;return p.required.object({max:p.optional.number,min:p.optional.number,step:p.optional.number})(value).value}function normalizeListOptions(options){if(Array.isArray(options))return options;let items=[];return Object.keys(options).forEach(text=>{items.push({text,value:options[text]})}),items}function createListConstraint(options){return isEmpty(options)?null:new ListConstraint(normalizeListOptions(forceCast(options)))}function findListItems(constraint){let c=constraint?findConstraint(constraint,ListConstraint):null;return c?c.options:null}function findStep(constraint){let c=constraint?findConstraint(constraint,StepConstraint):null;return c?c.step:null}function getSuitableDecimalDigits(constraint,rawValue){let sc=constraint&&findConstraint(constraint,StepConstraint);return sc?getDecimalDigits(sc.step):Math.max(getDecimalDigits(rawValue),2)}function getBaseStep(constraint){let step2=findStep(constraint);return step2!=null?step2:1}function getSuitableDraggingScale(constraint,rawValue){var _a;let sc=constraint&&findConstraint(constraint,StepConstraint),base=Math.abs((_a=sc==null?void 0:sc.step)!==null&&_a!==void 0?_a:rawValue);return base===0?.1:Math.pow(10,Math.floor(Math.log10(base))-1)}let className$d=ClassName("ckb");class CheckboxView{constructor(doc,config){this.onValueChange_=this.onValueChange_.bind(this),this.element=doc.createElement("div"),this.element.classList.add(className$d()),config.viewProps.bindClassModifiers(this.element);let labelElem=doc.createElement("label");labelElem.classList.add(className$d("l")),this.element.appendChild(labelElem);let inputElem=doc.createElement("input");inputElem.classList.add(className$d("i")),inputElem.type="checkbox",labelElem.appendChild(inputElem),this.inputElement=inputElem,config.viewProps.bindDisabled(this.inputElement);let wrapperElem=doc.createElement("div");wrapperElem.classList.add(className$d("w")),labelElem.appendChild(wrapperElem);let markElem=createSvgIconElement(doc,"check");wrapperElem.appendChild(markElem),config.value.emitter.on("change",this.onValueChange_),this.value=config.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class CheckboxController{constructor(doc,config){this.onInputChange_=this.onInputChange_.bind(this),this.value=config.value,this.viewProps=config.viewProps,this.view=new CheckboxView(doc,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){let inputElem=forceCast(e.currentTarget);this.value.rawValue=inputElem.checked}}function createConstraint$5(params){let constraints=[],lc=createListConstraint(params.options);return lc&&constraints.push(lc),new CompositeConstraint(constraints)}let BooleanInputPlugin={id:"input-bool",type:"input",accept:(value,params)=>{if(typeof value!="boolean")return null;let result=parseParams(params,{options:ParamsParsers.optional.custom(parseListOptions)});return result?{initialValue:value,params:result}:null},binding:{reader:_args=>boolFromUnknown,constraint:args=>createConstraint$5(args.params),writer:_args=>writePrimitive},controller:args=>{var _a;let doc=args.document,value=args.value,c=args.constraint;return c&&findConstraint(c,ListConstraint)?new ListController(doc,{props:ValueMap.fromObject({options:(_a=findListItems(c))!==null&&_a!==void 0?_a:[]}),value,viewProps:args.viewProps}):new CheckboxController(doc,{value,viewProps:args.viewProps})}},className$c=ClassName("col");class ColorView{constructor(doc,config){this.element=doc.createElement("div"),this.element.classList.add(className$c()),config.foldable.bindExpandedClass(this.element,className$c(void 0,"expanded")),bindValueMap(config.foldable,"completed",valueToClassName(this.element,className$c(void 0,"cpl")));let headElem=doc.createElement("div");headElem.classList.add(className$c("h")),this.element.appendChild(headElem);let swatchElem=doc.createElement("div");swatchElem.classList.add(className$c("s")),headElem.appendChild(swatchElem),this.swatchElement=swatchElem;let textElem=doc.createElement("div");if(textElem.classList.add(className$c("t")),headElem.appendChild(textElem),this.textElement=textElem,config.pickerLayout==="inline"){let pickerElem=doc.createElement("div");pickerElem.classList.add(className$c("p")),this.element.appendChild(pickerElem),this.pickerElement=pickerElem}else this.pickerElement=null}}function rgbToHsl(r,g,b){let rp=constrainRange(r/255,0,1),gp=constrainRange(g/255,0,1),bp=constrainRange(b/255,0,1),cmax=Math.max(rp,gp,bp),cmin=Math.min(rp,gp,bp),c=cmax-cmin,h=0,s=0,l=(cmin+cmax)/2;return c!==0&&(s=c/(1-Math.abs(cmax+cmin-1)),rp===cmax?h=(gp-bp)/c:gp===cmax?h=2+(bp-rp)/c:h=4+(rp-gp)/c,h=h/6+(h<0?1:0)),[h*360,s*100,l*100]}function hslToRgb(h,s,l){let hp=(h%360+360)%360,sp=constrainRange(s/100,0,1),lp=constrainRange(l/100,0,1),c=(1-Math.abs(2*lp-1))*sp,x=c*(1-Math.abs(hp/60%2-1)),m=lp-c/2,rp,gp,bp;return hp>=0&&hp<60?[rp,gp,bp]=[c,x,0]:hp>=60&&hp<120?[rp,gp,bp]=[x,c,0]:hp>=120&&hp<180?[rp,gp,bp]=[0,c,x]:hp>=180&&hp<240?[rp,gp,bp]=[0,x,c]:hp>=240&&hp<300?[rp,gp,bp]=[x,0,c]:[rp,gp,bp]=[c,0,x],[(rp+m)*255,(gp+m)*255,(bp+m)*255]}function rgbToHsv(r,g,b){let rp=constrainRange(r/255,0,1),gp=constrainRange(g/255,0,1),bp=constrainRange(b/255,0,1),cmax=Math.max(rp,gp,bp),cmin=Math.min(rp,gp,bp),d=cmax-cmin,h;d===0?h=0:cmax===rp?h=60*(((gp-bp)/d%6+6)%6):cmax===gp?h=60*((bp-rp)/d+2):h=60*((rp-gp)/d+4);let s=cmax===0?0:d/cmax,v=cmax;return[h,s*100,v*100]}function hsvToRgb(h,s,v){let hp=loopRange(h,360),sp=constrainRange(s/100,0,1),vp=constrainRange(v/100,0,1),c=vp*sp,x=c*(1-Math.abs(hp/60%2-1)),m=vp-c,rp,gp,bp;return hp>=0&&hp<60?[rp,gp,bp]=[c,x,0]:hp>=60&&hp<120?[rp,gp,bp]=[x,c,0]:hp>=120&&hp<180?[rp,gp,bp]=[0,c,x]:hp>=180&&hp<240?[rp,gp,bp]=[0,x,c]:hp>=240&&hp<300?[rp,gp,bp]=[x,0,c]:[rp,gp,bp]=[c,0,x],[(rp+m)*255,(gp+m)*255,(bp+m)*255]}function hslToHsv(h,s,l){let sd=l+s*(100-Math.abs(2*l-100))/(2*100);return[h,sd!==0?s*(100-Math.abs(2*l-100))/sd:0,l+s*(100-Math.abs(2*l-100))/(2*100)]}function hsvToHsl(h,s,v){let sd=100-Math.abs(v*(200-s)/100-100);return[h,sd!==0?s*v/sd:0,v*(200-s)/(2*100)]}function removeAlphaComponent(comps){return[comps[0],comps[1],comps[2]]}function appendAlphaComponent(comps,alpha){return[comps[0],comps[1],comps[2],alpha]}let MODE_CONVERTER_MAP={hsl:{hsl:(h,s,l)=>[h,s,l],hsv:hslToHsv,rgb:hslToRgb},hsv:{hsl:hsvToHsl,hsv:(h,s,v)=>[h,s,v],rgb:hsvToRgb},rgb:{hsl:rgbToHsl,hsv:rgbToHsv,rgb:(r,g,b)=>[r,g,b]}};function convertColorMode(components,fromMode,toMode){return MODE_CONVERTER_MAP[fromMode][toMode](...components)}let CONSTRAINT_MAP={hsl:comps=>{var _a;return[loopRange(comps[0],360),constrainRange(comps[1],0,100),constrainRange(comps[2],0,100),constrainRange((_a=comps[3])!==null&&_a!==void 0?_a:1,0,1)]},hsv:comps=>{var _a;return[loopRange(comps[0],360),constrainRange(comps[1],0,100),constrainRange(comps[2],0,100),constrainRange((_a=comps[3])!==null&&_a!==void 0?_a:1,0,1)]},rgb:comps=>{var _a;return[constrainRange(comps[0],0,255),constrainRange(comps[1],0,255),constrainRange(comps[2],0,255),constrainRange((_a=comps[3])!==null&&_a!==void 0?_a:1,0,1)]}};function isRgbColorComponent(obj,key){return typeof obj!="object"||isEmpty(obj)?!1:key in obj&&typeof obj[key]=="number"}class Color{constructor(comps,mode){this.mode_=mode,this.comps_=CONSTRAINT_MAP[mode](comps)}static black(){return new Color([0,0,0],"rgb")}static fromObject(obj){let comps="a"in obj?[obj.r,obj.g,obj.b,obj.a]:[obj.r,obj.g,obj.b];return new Color(comps,"rgb")}static toRgbaObject(color){return color.toRgbaObject()}static isRgbColorObject(obj){return isRgbColorComponent(obj,"r")&&isRgbColorComponent(obj,"g")&&isRgbColorComponent(obj,"b")}static isRgbaColorObject(obj){return this.isRgbColorObject(obj)&&isRgbColorComponent(obj,"a")}static isColorObject(obj){return this.isRgbColorObject(obj)}static equals(v1,v2){if(v1.mode_!==v2.mode_)return!1;let comps1=v1.comps_,comps2=v2.comps_;for(let i=0;i<comps1.length;i++)if(comps1[i]!==comps2[i])return!1;return!0}get mode(){return this.mode_}getComponents(opt_mode){return appendAlphaComponent(convertColorMode(removeAlphaComponent(this.comps_),this.mode_,opt_mode||this.mode_),this.comps_[3])}toRgbaObject(){let rgbComps=this.getComponents("rgb");return{r:rgbComps[0],g:rgbComps[1],b:rgbComps[2],a:rgbComps[3]}}}let className$b=ClassName("colp");class ColorPickerView{constructor(doc,config){this.alphaViews_=null,this.element=doc.createElement("div"),this.element.classList.add(className$b());let hsvElem=doc.createElement("div");hsvElem.classList.add(className$b("hsv"));let svElem=doc.createElement("div");svElem.classList.add(className$b("sv")),this.svPaletteView_=config.svPaletteView,svElem.appendChild(this.svPaletteView_.element),hsvElem.appendChild(svElem);let hElem=doc.createElement("div");hElem.classList.add(className$b("h")),this.hPaletteView_=config.hPaletteView,hElem.appendChild(this.hPaletteView_.element),hsvElem.appendChild(hElem),this.element.appendChild(hsvElem);let rgbElem=doc.createElement("div");if(rgbElem.classList.add(className$b("rgb")),this.textView_=config.textView,rgbElem.appendChild(this.textView_.element),this.element.appendChild(rgbElem),config.alphaViews){this.alphaViews_={palette:config.alphaViews.palette,text:config.alphaViews.text};let aElem=doc.createElement("div");aElem.classList.add(className$b("a"));let apElem=doc.createElement("div");apElem.classList.add(className$b("ap")),apElem.appendChild(this.alphaViews_.palette.element),aElem.appendChild(apElem);let atElem=doc.createElement("div");atElem.classList.add(className$b("at")),atElem.appendChild(this.alphaViews_.text.element),aElem.appendChild(atElem),this.element.appendChild(aElem)}}get allFocusableElements(){let elems=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(v=>v.inputElement)];return this.alphaViews_&&elems.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),elems}}function parseColorInputParams(params){let p=ParamsParsers;return parseParams(params,{alpha:p.optional.boolean,expanded:p.optional.boolean,picker:p.optional.custom(parsePickerLayout)})}function getBaseStepForColor(forAlpha){return forAlpha?.1:1}function parseCssNumberOrPercentage(text,maxValue){let m=text.match(/^(.+)%$/);return Math.min(m?parseFloat(m[1])*.01*maxValue:parseFloat(text),maxValue)}let ANGLE_TO_DEG_MAP={deg:angle2=>angle2,grad:angle2=>angle2*360/400,rad:angle2=>angle2*360/(2*Math.PI),turn:angle2=>angle2*360};function parseCssNumberOrAngle(text){let m=text.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!m)return parseFloat(text);let angle2=parseFloat(m[1]),unit=m[2];return ANGLE_TO_DEG_MAP[unit](angle2)}let NOTATION_TO_PARSER_MAP={"func.rgb":text=>{let m=text.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!m)return null;let comps=[parseCssNumberOrPercentage(m[1],255),parseCssNumberOrPercentage(m[2],255),parseCssNumberOrPercentage(m[3],255)];return isNaN(comps[0])||isNaN(comps[1])||isNaN(comps[2])?null:new Color(comps,"rgb")},"func.rgba":text=>{let m=text.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!m)return null;let comps=[parseCssNumberOrPercentage(m[1],255),parseCssNumberOrPercentage(m[2],255),parseCssNumberOrPercentage(m[3],255),parseCssNumberOrPercentage(m[4],1)];return isNaN(comps[0])||isNaN(comps[1])||isNaN(comps[2])||isNaN(comps[3])?null:new Color(comps,"rgb")},"func.hsl":text=>{let m=text.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!m)return null;let comps=[parseCssNumberOrAngle(m[1]),parseCssNumberOrPercentage(m[2],100),parseCssNumberOrPercentage(m[3],100)];return isNaN(comps[0])||isNaN(comps[1])||isNaN(comps[2])?null:new Color(comps,"hsl")},"func.hsla":text=>{let m=text.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!m)return null;let comps=[parseCssNumberOrAngle(m[1]),parseCssNumberOrPercentage(m[2],100),parseCssNumberOrPercentage(m[3],100),parseCssNumberOrPercentage(m[4],1)];return isNaN(comps[0])||isNaN(comps[1])||isNaN(comps[2])||isNaN(comps[3])?null:new Color(comps,"hsl")},"hex.rgb":text=>{let mRgb=text.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(mRgb)return new Color([parseInt(mRgb[1]+mRgb[1],16),parseInt(mRgb[2]+mRgb[2],16),parseInt(mRgb[3]+mRgb[3],16)],"rgb");let mRrggbb=text.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return mRrggbb?new Color([parseInt(mRrggbb[1],16),parseInt(mRrggbb[2],16),parseInt(mRrggbb[3],16)],"rgb"):null},"hex.rgba":text=>{let mRgb=text.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(mRgb)return new Color([parseInt(mRgb[1]+mRgb[1],16),parseInt(mRgb[2]+mRgb[2],16),parseInt(mRgb[3]+mRgb[3],16),mapRange(parseInt(mRgb[4]+mRgb[4],16),0,255,0,1)],"rgb");let mRrggbb=text.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return mRrggbb?new Color([parseInt(mRrggbb[1],16),parseInt(mRrggbb[2],16),parseInt(mRrggbb[3],16),mapRange(parseInt(mRrggbb[4],16),0,255,0,1)],"rgb"):null}};function getColorNotation(text){return Object.keys(NOTATION_TO_PARSER_MAP).reduce((result,notation)=>result||(NOTATION_TO_PARSER_MAP[notation](text)?notation:null),null)}let CompositeColorParser=text=>{let notation=getColorNotation(text);return notation?NOTATION_TO_PARSER_MAP[notation](text):null};function hasAlphaComponent(notation){return notation==="func.hsla"||notation==="func.rgba"||notation==="hex.rgba"}function colorFromString(value){if(typeof value=="string"){let cv=CompositeColorParser(value);if(cv)return cv}return Color.black()}function zerofill(comp){let hex=constrainRange(Math.floor(comp),0,255).toString(16);return hex.length===1?`0${hex}`:hex}function colorToHexRgbString(value,prefix="#"){let hexes=removeAlphaComponent(value.getComponents("rgb")).map(zerofill).join("");return`${prefix}${hexes}`}function colorToHexRgbaString(value,prefix="#"){let rgbaComps=value.getComponents("rgb"),hexes=[rgbaComps[0],rgbaComps[1],rgbaComps[2],rgbaComps[3]*255].map(zerofill).join("");return`${prefix}${hexes}`}function colorToFunctionalRgbString(value){let formatter=createNumberFormatter(0);return`rgb(${removeAlphaComponent(value.getComponents("rgb")).map(comp=>formatter(comp)).join(", ")})`}function colorToFunctionalRgbaString(value){let aFormatter=createNumberFormatter(2),rgbFormatter=createNumberFormatter(0);return`rgba(${value.getComponents("rgb").map((comp,index)=>(index===3?aFormatter:rgbFormatter)(comp)).join(", ")})`}function colorToFunctionalHslString(value){let formatters=[createNumberFormatter(0),formatPercentage,formatPercentage];return`hsl(${removeAlphaComponent(value.getComponents("hsl")).map((comp,index)=>formatters[index](comp)).join(", ")})`}function colorToFunctionalHslaString(value){let formatters=[createNumberFormatter(0),formatPercentage,formatPercentage,createNumberFormatter(2)];return`hsla(${value.getComponents("hsl").map((comp,index)=>formatters[index](comp)).join(", ")})`}let NOTATION_TO_STRINGIFIER_MAP={"func.hsl":colorToFunctionalHslString,"func.hsla":colorToFunctionalHslaString,"func.rgb":colorToFunctionalRgbString,"func.rgba":colorToFunctionalRgbaString,"hex.rgb":colorToHexRgbString,"hex.rgba":colorToHexRgbaString};function getColorStringifier(notation){return NOTATION_TO_STRINGIFIER_MAP[notation]}let className$a=ClassName("apl");class APaletteView{constructor(doc,config){this.onValueChange_=this.onValueChange_.bind(this),this.value=config.value,this.value.emitter.on("change",this.onValueChange_),this.element=doc.createElement("div"),this.element.classList.add(className$a()),config.viewProps.bindTabIndex(this.element);let barElem=doc.createElement("div");barElem.classList.add(className$a("b")),this.element.appendChild(barElem);let colorElem=doc.createElement("div");colorElem.classList.add(className$a("c")),barElem.appendChild(colorElem),this.colorElem_=colorElem;let markerElem=doc.createElement("div");markerElem.classList.add(className$a("m")),this.element.appendChild(markerElem),this.markerElem_=markerElem;let previewElem=doc.createElement("div");previewElem.classList.add(className$a("p")),this.markerElem_.appendChild(previewElem),this.previewElem_=previewElem,this.update_()}update_(){let c=this.value.rawValue,rgbaComps=c.getComponents("rgb"),leftColor=new Color([rgbaComps[0],rgbaComps[1],rgbaComps[2],0],"rgb"),rightColor=new Color([rgbaComps[0],rgbaComps[1],rgbaComps[2],255],"rgb"),gradientComps=["to right",colorToFunctionalRgbaString(leftColor),colorToFunctionalRgbaString(rightColor)];this.colorElem_.style.background=`linear-gradient(${gradientComps.join(",")})`,this.previewElem_.style.backgroundColor=colorToFunctionalRgbaString(c);let left=mapRange(rgbaComps[3],0,1,0,100);this.markerElem_.style.left=`${left}%`}onValueChange_(){this.update_()}}class APaletteController{constructor(doc,config){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=config.value,this.viewProps=config.viewProps,this.view=new APaletteView(doc,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new PointerHandler(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(d,opts){if(!d.point)return;let alpha=d.point.x/d.bounds.width,c=this.value.rawValue,[h,s,v]=c.getComponents("hsv");this.value.setRawValue(new Color([h,s,v,alpha],"hsv"),opts)}onPointerDown_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!1,last:!1})}onPointerMove_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!1,last:!1})}onPointerUp_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!0,last:!0})}onKeyDown_(ev){let step2=getStepForKey(getBaseStepForColor(!0),getHorizontalStepKeys(ev));if(step2===0)return;let c=this.value.rawValue,[h,s,v,a]=c.getComponents("hsv");this.value.setRawValue(new Color([h,s,v,a+step2],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(ev){getStepForKey(getBaseStepForColor(!0),getHorizontalStepKeys(ev))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}let className$9=ClassName("coltxt");function createModeSelectElement(doc){let selectElem=doc.createElement("select"),items=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}];return selectElem.appendChild(items.reduce((frag,item)=>{let optElem=doc.createElement("option");return optElem.textContent=item.text,optElem.value=item.value,frag.appendChild(optElem),frag},doc.createDocumentFragment())),selectElem}class ColorTextView{constructor(doc,config){this.element=doc.createElement("div"),this.element.classList.add(className$9());let modeElem=doc.createElement("div");modeElem.classList.add(className$9("m")),this.modeElem_=createModeSelectElement(doc),this.modeElem_.classList.add(className$9("ms")),modeElem.appendChild(this.modeSelectElement);let modeMarkerElem=doc.createElement("div");modeMarkerElem.classList.add(className$9("mm")),modeMarkerElem.appendChild(createSvgIconElement(doc,"dropdown")),modeElem.appendChild(modeMarkerElem),this.element.appendChild(modeElem);let textsElem=doc.createElement("div");textsElem.classList.add(className$9("w")),this.element.appendChild(textsElem),this.textsElem_=textsElem,this.textViews_=config.textViews,this.applyTextViews_(),bindValue(config.colorMode,mode=>{this.modeElem_.value=mode})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(textViews){this.textViews_=textViews,this.applyTextViews_()}applyTextViews_(){removeChildElements(this.textsElem_);let doc=this.element.ownerDocument;this.textViews_.forEach(v=>{let compElem=doc.createElement("div");compElem.classList.add(className$9("c")),compElem.appendChild(v.element),this.textsElem_.appendChild(compElem)})}}let FORMATTER=createNumberFormatter(0),MODE_TO_CONSTRAINT_MAP={rgb:()=>new RangeConstraint({min:0,max:255}),hsl:index=>index===0?new RangeConstraint({min:0,max:360}):new RangeConstraint({min:0,max:100}),hsv:index=>index===0?new RangeConstraint({min:0,max:360}):new RangeConstraint({min:0,max:100})};function createComponentController(doc,config,index){return new NumberTextController(doc,{arrayPosition:index===0?"fst":index===3-1?"lst":"mid",baseStep:getBaseStepForColor(!1),parser:config.parser,props:ValueMap.fromObject({draggingScale:1,formatter:FORMATTER}),value:createValue(0,{constraint:MODE_TO_CONSTRAINT_MAP[config.colorMode](index)}),viewProps:config.viewProps})}class ColorTextController{constructor(doc,config){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.parser_=config.parser,this.value=config.value,this.viewProps=config.viewProps,this.colorMode=createValue(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(doc),this.view=new ColorTextView(doc,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(doc){let cc={colorMode:this.colorMode.rawValue,parser:this.parser_,viewProps:this.viewProps},ccs=[createComponentController(doc,cc,0),createComponentController(doc,cc,1),createComponentController(doc,cc,2)];return ccs.forEach((cs,index)=>{connectValues({primary:this.value,secondary:cs.value,forward:p=>p.rawValue.getComponents(this.colorMode.rawValue)[index],backward:(p,s)=>{let pickedMode=this.colorMode.rawValue,comps=p.rawValue.getComponents(pickedMode);return comps[index]=s.rawValue,new Color(appendAlphaComponent(removeAlphaComponent(comps),comps[3]),pickedMode)}})}),ccs}onModeSelectChange_(ev){let selectElem=ev.currentTarget;this.colorMode.rawValue=selectElem.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}let className$8=ClassName("hpl");class HPaletteView{constructor(doc,config){this.onValueChange_=this.onValueChange_.bind(this),this.value=config.value,this.value.emitter.on("change",this.onValueChange_),this.element=doc.createElement("div"),this.element.classList.add(className$8()),config.viewProps.bindTabIndex(this.element);let colorElem=doc.createElement("div");colorElem.classList.add(className$8("c")),this.element.appendChild(colorElem);let markerElem=doc.createElement("div");markerElem.classList.add(className$8("m")),this.element.appendChild(markerElem),this.markerElem_=markerElem,this.update_()}update_(){let c=this.value.rawValue,[h]=c.getComponents("hsv");this.markerElem_.style.backgroundColor=colorToFunctionalRgbString(new Color([h,100,100],"hsv"));let left=mapRange(h,0,360,0,100);this.markerElem_.style.left=`${left}%`}onValueChange_(){this.update_()}}class HPaletteController{constructor(doc,config){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=config.value,this.viewProps=config.viewProps,this.view=new HPaletteView(doc,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new PointerHandler(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(d,opts){if(!d.point)return;let hue=mapRange(d.point.x,0,d.bounds.width,0,360),c=this.value.rawValue,[,s,v,a]=c.getComponents("hsv");this.value.setRawValue(new Color([hue,s,v,a],"hsv"),opts)}onPointerDown_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!1,last:!1})}onPointerMove_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!1,last:!1})}onPointerUp_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!0,last:!0})}onKeyDown_(ev){let step2=getStepForKey(getBaseStepForColor(!1),getHorizontalStepKeys(ev));if(step2===0)return;let c=this.value.rawValue,[h,s,v,a]=c.getComponents("hsv");this.value.setRawValue(new Color([h+step2,s,v,a],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(ev){getStepForKey(getBaseStepForColor(!1),getHorizontalStepKeys(ev))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}let className$7=ClassName("svp"),CANVAS_RESOL=64;class SvPaletteView{constructor(doc,config){this.onValueChange_=this.onValueChange_.bind(this),this.value=config.value,this.value.emitter.on("change",this.onValueChange_),this.element=doc.createElement("div"),this.element.classList.add(className$7()),config.viewProps.bindTabIndex(this.element);let canvasElem=doc.createElement("canvas");canvasElem.height=CANVAS_RESOL,canvasElem.width=CANVAS_RESOL,canvasElem.classList.add(className$7("c")),this.element.appendChild(canvasElem),this.canvasElement=canvasElem;let markerElem=doc.createElement("div");markerElem.classList.add(className$7("m")),this.element.appendChild(markerElem),this.markerElem_=markerElem,this.update_()}update_(){let ctx=getCanvasContext(this.canvasElement);if(!ctx)return;let hsvComps=this.value.rawValue.getComponents("hsv"),width=this.canvasElement.width,height=this.canvasElement.height,imgData=ctx.getImageData(0,0,width,height),data=imgData.data;for(let iy=0;iy<height;iy++)for(let ix=0;ix<width;ix++){let s=mapRange(ix,0,width,0,100),v=mapRange(iy,0,height,100,0),rgbComps=hsvToRgb(hsvComps[0],s,v),i=(iy*width+ix)*4;data[i]=rgbComps[0],data[i+1]=rgbComps[1],data[i+2]=rgbComps[2],data[i+3]=255}ctx.putImageData(imgData,0,0);let left=mapRange(hsvComps[1],0,100,0,100);this.markerElem_.style.left=`${left}%`;let top=mapRange(hsvComps[2],0,100,100,0);this.markerElem_.style.top=`${top}%`}onValueChange_(){this.update_()}}class SvPaletteController{constructor(doc,config){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=config.value,this.viewProps=config.viewProps,this.view=new SvPaletteView(doc,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new PointerHandler(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(d,opts){if(!d.point)return;let saturation=mapRange(d.point.x,0,d.bounds.width,0,100),value=mapRange(d.point.y,0,d.bounds.height,100,0),[h,,,a]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new Color([h,saturation,value,a],"hsv"),opts)}onPointerDown_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!1,last:!1})}onPointerMove_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!1,last:!1})}onPointerUp_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!0,last:!0})}onKeyDown_(ev){isArrowKey(ev.key)&&ev.preventDefault();let[h,s,v,a]=this.value.rawValue.getComponents("hsv"),baseStep=getBaseStepForColor(!1),ds=getStepForKey(baseStep,getHorizontalStepKeys(ev)),dv=getStepForKey(baseStep,getVerticalStepKeys(ev));ds===0&&dv===0||this.value.setRawValue(new Color([h,s+ds,v+dv,a],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(ev){let baseStep=getBaseStepForColor(!1),ds=getStepForKey(baseStep,getHorizontalStepKeys(ev)),dv=getStepForKey(baseStep,getVerticalStepKeys(ev));ds===0&&dv===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class ColorPickerController{constructor(doc,config){this.value=config.value,this.viewProps=config.viewProps,this.hPaletteC_=new HPaletteController(doc,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new SvPaletteController(doc,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=config.supportsAlpha?{palette:new APaletteController(doc,{value:this.value,viewProps:this.viewProps}),text:new NumberTextController(doc,{parser:parseNumber,baseStep:.1,props:ValueMap.fromObject({draggingScale:.01,formatter:createNumberFormatter(2)}),value:createValue(0,{constraint:new RangeConstraint({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&connectValues({primary:this.value,secondary:this.alphaIcs_.text.value,forward:p=>p.rawValue.getComponents()[3],backward:(p,s)=>{let comps=p.rawValue.getComponents();return comps[3]=s.rawValue,new Color(comps,p.rawValue.mode)}}),this.textC_=new ColorTextController(doc,{parser:parseNumber,value:this.value,viewProps:this.viewProps}),this.view=new ColorPickerView(doc,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:config.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view})}get textController(){return this.textC_}}let className$6=ClassName("colsw");class ColorSwatchView{constructor(doc,config){this.onValueChange_=this.onValueChange_.bind(this),config.value.emitter.on("change",this.onValueChange_),this.value=config.value,this.element=doc.createElement("div"),this.element.classList.add(className$6()),config.viewProps.bindClassModifiers(this.element);let swatchElem=doc.createElement("div");swatchElem.classList.add(className$6("sw")),this.element.appendChild(swatchElem),this.swatchElem_=swatchElem;let buttonElem=doc.createElement("button");buttonElem.classList.add(className$6("b")),config.viewProps.bindDisabled(buttonElem),this.element.appendChild(buttonElem),this.buttonElement=buttonElem,this.update_()}update_(){let value=this.value.rawValue;this.swatchElem_.style.backgroundColor=colorToHexRgbaString(value)}onValueChange_(){this.update_()}}class ColorSwatchController{constructor(doc,config){this.value=config.value,this.viewProps=config.viewProps,this.view=new ColorSwatchView(doc,{value:this.value,viewProps:this.viewProps})}}class ColorController{constructor(doc,config){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=config.value,this.viewProps=config.viewProps,this.foldable_=Foldable.create(config.expanded),this.swatchC_=new ColorSwatchController(doc,{value:this.value,viewProps:this.viewProps});let buttonElem=this.swatchC_.view.buttonElement;buttonElem.addEventListener("blur",this.onButtonBlur_),buttonElem.addEventListener("click",this.onButtonClick_),this.textC_=new TextController(doc,{parser:config.parser,props:ValueMap.fromObject({formatter:config.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new ColorView(doc,{foldable:this.foldable_,pickerLayout:config.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=config.pickerLayout==="popup"?new PopupController(doc,{viewProps:this.viewProps}):null;let pickerC=new ColorPickerController(doc,{supportsAlpha:config.supportsAlpha,value:this.value,viewProps:this.viewProps});pickerC.view.allFocusableElements.forEach(elem=>{elem.addEventListener("blur",this.onPopupChildBlur_),elem.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=pickerC,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(pickerC.view.element),connectValues({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:p=>p.rawValue,backward:(_,s)=>s.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),bindFoldable(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;let elem=this.view.element,nextTarget=forceCast(e.relatedTarget);(!nextTarget||!elem.contains(nextTarget))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(ev){if(!this.popC_)return;let elem=this.popC_.view.element,nextTarget=findNextTarget(ev);nextTarget&&elem.contains(nextTarget)||nextTarget&&nextTarget===this.swatchC_.view.buttonElement&&!supportsTouch(elem.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(ev){this.popC_?ev.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&ev.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function colorFromObject(value){return Color.isColorObject(value)?Color.fromObject(value):Color.black()}function colorToRgbNumber(value){return removeAlphaComponent(value.getComponents("rgb")).reduce((result,comp)=>result<<8|Math.floor(comp)&255,0)}function colorToRgbaNumber(value){return value.getComponents("rgb").reduce((result,comp,index)=>{let hex=Math.floor(index===3?comp*255:comp)&255;return result<<8|hex},0)>>>0}function numberToRgbColor(num){return new Color([num>>16&255,num>>8&255,num&255],"rgb")}function numberToRgbaColor(num){return new Color([num>>24&255,num>>16&255,num>>8&255,mapRange(num&255,0,255,0,1)],"rgb")}function colorFromRgbNumber(value){return typeof value!="number"?Color.black():numberToRgbColor(value)}function colorFromRgbaNumber(value){return typeof value!="number"?Color.black():numberToRgbaColor(value)}function createColorStringWriter(notation){let stringify=getColorStringifier(notation);return(target,value)=>{writePrimitive(target,stringify(value))}}function createColorNumberWriter(supportsAlpha){let colorToNumber=supportsAlpha?colorToRgbaNumber:colorToRgbNumber;return(target,value)=>{writePrimitive(target,colorToNumber(value))}}function writeRgbaColorObject(target,value){let obj=value.toRgbaObject();target.writeProperty("r",obj.r),target.writeProperty("g",obj.g),target.writeProperty("b",obj.b),target.writeProperty("a",obj.a)}function writeRgbColorObject(target,value){let obj=value.toRgbaObject();target.writeProperty("r",obj.r),target.writeProperty("g",obj.g),target.writeProperty("b",obj.b)}function createColorObjectWriter(supportsAlpha){return supportsAlpha?writeRgbaColorObject:writeRgbColorObject}function shouldSupportAlpha$1(inputParams){return"alpha"in inputParams&&inputParams.alpha===!0}function createFormatter$1(supportsAlpha){return supportsAlpha?v=>colorToHexRgbaString(v,"0x"):v=>colorToHexRgbString(v,"0x")}let NumberColorInputPlugin={id:"input-color-number",type:"input",accept:(value,params)=>{if(typeof value!="number"||!("view"in params)||params.view!=="color")return null;let result=parseColorInputParams(params);return result?{initialValue:value,params:result}:null},binding:{reader:args=>shouldSupportAlpha$1(args.params)?colorFromRgbaNumber:colorFromRgbNumber,equals:Color.equals,writer:args=>createColorNumberWriter(shouldSupportAlpha$1(args.params))},controller:args=>{let supportsAlpha=shouldSupportAlpha$1(args.params),expanded="expanded"in args.params?args.params.expanded:void 0,picker="picker"in args.params?args.params.picker:void 0;return new ColorController(args.document,{expanded:expanded!=null?expanded:!1,formatter:createFormatter$1(supportsAlpha),parser:CompositeColorParser,pickerLayout:picker!=null?picker:"popup",supportsAlpha,value:args.value,viewProps:args.viewProps})}};function shouldSupportAlpha(initialValue){return Color.isRgbaColorObject(initialValue)}let ObjectColorInputPlugin={id:"input-color-object",type:"input",accept:(value,params)=>{if(!Color.isColorObject(value))return null;let result=parseColorInputParams(params);return result?{initialValue:value,params:result}:null},binding:{reader:_args=>colorFromObject,equals:Color.equals,writer:args=>createColorObjectWriter(shouldSupportAlpha(args.initialValue))},controller:args=>{let supportsAlpha=Color.isRgbaColorObject(args.initialValue),expanded="expanded"in args.params?args.params.expanded:void 0,picker="picker"in args.params?args.params.picker:void 0,formatter=supportsAlpha?colorToHexRgbaString:colorToHexRgbString;return new ColorController(args.document,{expanded:expanded!=null?expanded:!1,formatter,parser:CompositeColorParser,pickerLayout:picker!=null?picker:"popup",supportsAlpha,value:args.value,viewProps:args.viewProps})}},StringColorInputPlugin={id:"input-color-string",type:"input",accept:(value,params)=>{if(typeof value!="string"||"view"in params&&params.view==="text"||!getColorNotation(value))return null;let result=parseColorInputParams(params);return result?{initialValue:value,params:result}:null},binding:{reader:_args=>colorFromString,equals:Color.equals,writer:args=>{let notation=getColorNotation(args.initialValue);if(!notation)throw TpError.shouldNeverHappen();return createColorStringWriter(notation)}},controller:args=>{let notation=getColorNotation(args.initialValue);if(!notation)throw TpError.shouldNeverHappen();let stringifier=getColorStringifier(notation),expanded="expanded"in args.params?args.params.expanded:void 0,picker="picker"in args.params?args.params.picker:void 0;return new ColorController(args.document,{expanded:expanded!=null?expanded:!1,formatter:stringifier,parser:CompositeColorParser,pickerLayout:picker!=null?picker:"popup",supportsAlpha:hasAlphaComponent(notation),value:args.value,viewProps:args.viewProps})}};class PointNdConstraint{constructor(config){this.components=config.components,this.asm_=config.assembly}constrain(value){let comps=this.asm_.toComponents(value).map((comp,index)=>{var _a,_b;return(_b=(_a=this.components[index])===null||_a===void 0?void 0:_a.constrain(comp))!==null&&_b!==void 0?_b:comp});return this.asm_.fromComponents(comps)}}let className$5=ClassName("pndtxt");class PointNdTextView{constructor(doc,config){this.textViews=config.textViews,this.element=doc.createElement("div"),this.element.classList.add(className$5()),this.textViews.forEach(v=>{let axisElem=doc.createElement("div");axisElem.classList.add(className$5("a")),axisElem.appendChild(v.element),this.element.appendChild(axisElem)})}}function createAxisController(doc,config,index){return new NumberTextController(doc,{arrayPosition:index===0?"fst":index===config.axes.length-1?"lst":"mid",baseStep:config.axes[index].baseStep,parser:config.parser,props:config.axes[index].textProps,value:createValue(0,{constraint:config.axes[index].constraint}),viewProps:config.viewProps})}class PointNdTextController{constructor(doc,config){this.value=config.value,this.viewProps=config.viewProps,this.acs_=config.axes.map((_,index)=>createAxisController(doc,config,index)),this.acs_.forEach((c,index)=>{connectValues({primary:this.value,secondary:c.value,forward:p=>config.assembly.toComponents(p.rawValue)[index],backward:(p,s)=>{let comps=config.assembly.toComponents(p.rawValue);return comps[index]=s.rawValue,config.assembly.fromComponents(comps)}})}),this.view=new PointNdTextView(doc,{textViews:this.acs_.map(ac=>ac.view)})}}function createStepConstraint(params){return"step"in params&&!isEmpty(params.step)?new StepConstraint(params.step):null}function createRangeConstraint(params){return"max"in params&&!isEmpty(params.max)||"min"in params&&!isEmpty(params.min)?new RangeConstraint({max:params.max,min:params.min}):null}function createConstraint$4(params){let constraints=[],sc=createStepConstraint(params);sc&&constraints.push(sc);let rc=createRangeConstraint(params);rc&&constraints.push(rc);let lc=createListConstraint(params.options);return lc&&constraints.push(lc),new CompositeConstraint(constraints)}function findRange(constraint){let c=constraint?findConstraint(constraint,RangeConstraint):null;return c?[c.minValue,c.maxValue]:[void 0,void 0]}function estimateSuitableRange(constraint){let[min,max]=findRange(constraint);return[min!=null?min:0,max!=null?max:100]}let NumberInputPlugin={id:"input-number",type:"input",accept:(value,params)=>{if(typeof value!="number")return null;let p=ParamsParsers,result=parseParams(params,{format:p.optional.function,max:p.optional.number,min:p.optional.number,options:p.optional.custom(parseListOptions),step:p.optional.number});return result?{initialValue:value,params:result}:null},binding:{reader:_args=>numberFromUnknown,constraint:args=>createConstraint$4(args.params),writer:_args=>writePrimitive},controller:args=>{var _a,_b;let value=args.value,c=args.constraint;if(c&&findConstraint(c,ListConstraint))return new ListController(args.document,{props:ValueMap.fromObject({options:(_a=findListItems(c))!==null&&_a!==void 0?_a:[]}),value,viewProps:args.viewProps});let formatter=(_b="format"in args.params?args.params.format:void 0)!==null&&_b!==void 0?_b:createNumberFormatter(getSuitableDecimalDigits(c,value.rawValue));if(c&&findConstraint(c,RangeConstraint)){let[min,max]=estimateSuitableRange(c);return new SliderTextController(args.document,{baseStep:getBaseStep(c),parser:parseNumber,sliderProps:ValueMap.fromObject({maxValue:max,minValue:min}),textProps:ValueMap.fromObject({draggingScale:getSuitableDraggingScale(c,value.rawValue),formatter}),value,viewProps:args.viewProps})}return new NumberTextController(args.document,{baseStep:getBaseStep(c),parser:parseNumber,props:ValueMap.fromObject({draggingScale:getSuitableDraggingScale(c,value.rawValue),formatter}),value,viewProps:args.viewProps})}};class Point2d{constructor(x=0,y=0){this.x=x,this.y=y}getComponents(){return[this.x,this.y]}static isObject(obj){if(isEmpty(obj))return!1;let x=obj.x,y=obj.y;return!(typeof x!="number"||typeof y!="number")}static equals(v1,v2){return v1.x===v2.x&&v1.y===v2.y}toObject(){return{x:this.x,y:this.y}}}let Point2dAssembly={toComponents:p=>p.getComponents(),fromComponents:comps=>new Point2d(...comps)},className$4=ClassName("p2d");class Point2dView{constructor(doc,config){this.element=doc.createElement("div"),this.element.classList.add(className$4()),config.viewProps.bindClassModifiers(this.element),bindValue(config.expanded,valueToClassName(this.element,className$4(void 0,"expanded")));let headElem=doc.createElement("div");headElem.classList.add(className$4("h")),this.element.appendChild(headElem);let buttonElem=doc.createElement("button");buttonElem.classList.add(className$4("b")),buttonElem.appendChild(createSvgIconElement(doc,"p2dpad")),config.viewProps.bindDisabled(buttonElem),headElem.appendChild(buttonElem),this.buttonElement=buttonElem;let textElem=doc.createElement("div");if(textElem.classList.add(className$4("t")),headElem.appendChild(textElem),this.textElement=textElem,config.pickerLayout==="inline"){let pickerElem=doc.createElement("div");pickerElem.classList.add(className$4("p")),this.element.appendChild(pickerElem),this.pickerElement=pickerElem}else this.pickerElement=null}}let className$3=ClassName("p2dp");class Point2dPickerView{constructor(doc,config){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=config.invertsY,this.maxValue_=config.maxValue,this.element=doc.createElement("div"),this.element.classList.add(className$3()),config.layout==="popup"&&this.element.classList.add(className$3(void 0,"p"));let padElem=doc.createElement("div");padElem.classList.add(className$3("p")),config.viewProps.bindTabIndex(padElem),this.element.appendChild(padElem),this.padElement=padElem;let svgElem=doc.createElementNS(SVG_NS,"svg");svgElem.classList.add(className$3("g")),this.padElement.appendChild(svgElem),this.svgElem_=svgElem;let xAxisElem=doc.createElementNS(SVG_NS,"line");xAxisElem.classList.add(className$3("ax")),xAxisElem.setAttributeNS(null,"x1","0"),xAxisElem.setAttributeNS(null,"y1","50%"),xAxisElem.setAttributeNS(null,"x2","100%"),xAxisElem.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(xAxisElem);let yAxisElem=doc.createElementNS(SVG_NS,"line");yAxisElem.classList.add(className$3("ax")),yAxisElem.setAttributeNS(null,"x1","50%"),yAxisElem.setAttributeNS(null,"y1","0"),yAxisElem.setAttributeNS(null,"x2","50%"),yAxisElem.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(yAxisElem);let lineElem=doc.createElementNS(SVG_NS,"line");lineElem.classList.add(className$3("l")),lineElem.setAttributeNS(null,"x1","50%"),lineElem.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(lineElem),this.lineElem_=lineElem;let markerElem=doc.createElement("div");markerElem.classList.add(className$3("m")),this.padElement.appendChild(markerElem),this.markerElem_=markerElem,config.value.emitter.on("change",this.onValueChange_),this.value=config.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){let[x,y]=this.value.rawValue.getComponents(),max=this.maxValue_,px=mapRange(x,-max,+max,0,100),py=mapRange(y,-max,+max,0,100),ipy=this.invertsY_?100-py:py;this.lineElem_.setAttributeNS(null,"x2",`${px}%`),this.lineElem_.setAttributeNS(null,"y2",`${ipy}%`),this.markerElem_.style.left=`${px}%`,this.markerElem_.style.top=`${ipy}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function computeOffset(ev,baseSteps,invertsY){return[getStepForKey(baseSteps[0],getHorizontalStepKeys(ev)),getStepForKey(baseSteps[1],getVerticalStepKeys(ev))*(invertsY?1:-1)]}class Point2dPickerController{constructor(doc,config){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=config.value,this.viewProps=config.viewProps,this.baseSteps_=config.baseSteps,this.maxValue_=config.maxValue,this.invertsY_=config.invertsY,this.view=new Point2dPickerView(doc,{invertsY:this.invertsY_,layout:config.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new PointerHandler(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(d,opts){if(!d.point)return;let max=this.maxValue_,px=mapRange(d.point.x,0,d.bounds.width,-max,+max),py=mapRange(this.invertsY_?d.bounds.height-d.point.y:d.point.y,0,d.bounds.height,-max,+max);this.value.setRawValue(new Point2d(px,py),opts)}onPointerDown_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!1,last:!1})}onPointerMove_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!1,last:!1})}onPointerUp_(ev){this.handlePointerEvent_(ev.data,{forceEmit:!0,last:!0})}onPadKeyDown_(ev){isArrowKey(ev.key)&&ev.preventDefault();let[dx,dy]=computeOffset(ev,this.baseSteps_,this.invertsY_);dx===0&&dy===0||this.value.setRawValue(new Point2d(this.value.rawValue.x+dx,this.value.rawValue.y+dy),{forceEmit:!1,last:!1})}onPadKeyUp_(ev){let[dx,dy]=computeOffset(ev,this.baseSteps_,this.invertsY_);dx===0&&dy===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Point2dController{constructor(doc,config){var _a,_b;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=config.value,this.viewProps=config.viewProps,this.foldable_=Foldable.create(config.expanded),this.popC_=config.pickerLayout==="popup"?new PopupController(doc,{viewProps:this.viewProps}):null;let padC=new Point2dPickerController(doc,{baseSteps:[config.axes[0].baseStep,config.axes[1].baseStep],invertsY:config.invertsY,layout:config.pickerLayout,maxValue:config.maxValue,value:this.value,viewProps:this.viewProps});padC.view.allFocusableElements.forEach(elem=>{elem.addEventListener("blur",this.onPopupChildBlur_),elem.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=padC,this.textC_=new PointNdTextController(doc,{assembly:Point2dAssembly,axes:config.axes,parser:config.parser,value:this.value,viewProps:this.viewProps}),this.view=new Point2dView(doc,{expanded:this.foldable_.value("expanded"),pickerLayout:config.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(_a=this.view.buttonElement)===null||_a===void 0||_a.addEventListener("blur",this.onPadButtonBlur_),(_b=this.view.buttonElement)===null||_b===void 0||_b.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),connectValues({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:p=>p.rawValue,backward:(_,s)=>s.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),bindFoldable(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(e){if(!this.popC_)return;let elem=this.view.element,nextTarget=forceCast(e.relatedTarget);(!nextTarget||!elem.contains(nextTarget))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(ev){if(!this.popC_)return;let elem=this.popC_.view.element,nextTarget=findNextTarget(ev);nextTarget&&elem.contains(nextTarget)||nextTarget&&nextTarget===this.view.buttonElement&&!supportsTouch(elem.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(ev){this.popC_?ev.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&ev.key==="Escape"&&this.view.buttonElement.focus()}}function point2dFromUnknown(value){return Point2d.isObject(value)?new Point2d(value.x,value.y):new Point2d}function writePoint2d(target,value){target.writeProperty("x",value.x),target.writeProperty("y",value.y)}function createDimensionConstraint$2(params){if(!params)return;let constraints=[];return isEmpty(params.step)||constraints.push(new StepConstraint(params.step)),(!isEmpty(params.max)||!isEmpty(params.min))&&constraints.push(new RangeConstraint({max:params.max,min:params.min})),new CompositeConstraint(constraints)}function createConstraint$3(params){return new PointNdConstraint({assembly:Point2dAssembly,components:[createDimensionConstraint$2("x"in params?params.x:void 0),createDimensionConstraint$2("y"in params?params.y:void 0)]})}function getSuitableMaxDimensionValue(constraint,rawValue){let rc=constraint&&findConstraint(constraint,RangeConstraint);if(rc)return Math.max(Math.abs(rc.minValue||0),Math.abs(rc.maxValue||0));let step2=getBaseStep(constraint);return Math.max(Math.abs(step2)*10,Math.abs(rawValue)*10)}function getSuitableMaxValue(initialValue,constraint){let xc=constraint instanceof PointNdConstraint?constraint.components[0]:void 0,yc=constraint instanceof PointNdConstraint?constraint.components[1]:void 0,xr=getSuitableMaxDimensionValue(xc,initialValue.x),yr=getSuitableMaxDimensionValue(yc,initialValue.y);return Math.max(xr,yr)}function createAxis$2(initialValue,constraint){return{baseStep:getBaseStep(constraint),constraint,textProps:ValueMap.fromObject({draggingScale:getSuitableDraggingScale(constraint,initialValue),formatter:createNumberFormatter(getSuitableDecimalDigits(constraint,initialValue))})}}function shouldInvertY(params){if(!("y"in params))return!1;let yParams=params.y;return yParams&&"inverted"in yParams?!!yParams.inverted:!1}let Point2dInputPlugin={id:"input-point2d",type:"input",accept:(value,params)=>{if(!Point2d.isObject(value))return null;let p=ParamsParsers,result=parseParams(params,{expanded:p.optional.boolean,picker:p.optional.custom(parsePickerLayout),x:p.optional.custom(parsePointDimensionParams),y:p.optional.object({inverted:p.optional.boolean,max:p.optional.number,min:p.optional.number,step:p.optional.number})});return result?{initialValue:value,params:result}:null},binding:{reader:_args=>point2dFromUnknown,constraint:args=>createConstraint$3(args.params),equals:Point2d.equals,writer:_args=>writePoint2d},controller:args=>{let doc=args.document,value=args.value,c=args.constraint;if(!(c instanceof PointNdConstraint))throw TpError.shouldNeverHappen();let expanded="expanded"in args.params?args.params.expanded:void 0,picker="picker"in args.params?args.params.picker:void 0;return new Point2dController(doc,{axes:[createAxis$2(value.rawValue.x,c.components[0]),createAxis$2(value.rawValue.y,c.components[1])],expanded:expanded!=null?expanded:!1,invertsY:shouldInvertY(args.params),maxValue:getSuitableMaxValue(value.rawValue,c),parser:parseNumber,pickerLayout:picker!=null?picker:"popup",value,viewProps:args.viewProps})}};class Point3d{constructor(x=0,y=0,z=0){this.x=x,this.y=y,this.z=z}getComponents(){return[this.x,this.y,this.z]}static isObject(obj){if(isEmpty(obj))return!1;let x=obj.x,y=obj.y,z=obj.z;return!(typeof x!="number"||typeof y!="number"||typeof z!="number")}static equals(v1,v2){return v1.x===v2.x&&v1.y===v2.y&&v1.z===v2.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}let Point3dAssembly={toComponents:p=>p.getComponents(),fromComponents:comps=>new Point3d(...comps)};function point3dFromUnknown(value){return Point3d.isObject(value)?new Point3d(value.x,value.y,value.z):new Point3d}function writePoint3d(target,value){target.writeProperty("x",value.x),target.writeProperty("y",value.y),target.writeProperty("z",value.z)}function createDimensionConstraint$1(params){if(!params)return;let constraints=[];return isEmpty(params.step)||constraints.push(new StepConstraint(params.step)),(!isEmpty(params.max)||!isEmpty(params.min))&&constraints.push(new RangeConstraint({max:params.max,min:params.min})),new CompositeConstraint(constraints)}function createConstraint$2(params){return new PointNdConstraint({assembly:Point3dAssembly,components:[createDimensionConstraint$1("x"in params?params.x:void 0),createDimensionConstraint$1("y"in params?params.y:void 0),createDimensionConstraint$1("z"in params?params.z:void 0)]})}function createAxis$1(initialValue,constraint){return{baseStep:getBaseStep(constraint),constraint,textProps:ValueMap.fromObject({draggingScale:getSuitableDraggingScale(constraint,initialValue),formatter:createNumberFormatter(getSuitableDecimalDigits(constraint,initialValue))})}}let Point3dInputPlugin={id:"input-point3d",type:"input",accept:(value,params)=>{if(!Point3d.isObject(value))return null;let p=ParamsParsers,result=parseParams(params,{x:p.optional.custom(parsePointDimensionParams),y:p.optional.custom(parsePointDimensionParams),z:p.optional.custom(parsePointDimensionParams)});return result?{initialValue:value,params:result}:null},binding:{reader:_args=>point3dFromUnknown,constraint:args=>createConstraint$2(args.params),equals:Point3d.equals,writer:_args=>writePoint3d},controller:args=>{let value=args.value,c=args.constraint;if(!(c instanceof PointNdConstraint))throw TpError.shouldNeverHappen();return new PointNdTextController(args.document,{assembly:Point3dAssembly,axes:[createAxis$1(value.rawValue.x,c.components[0]),createAxis$1(value.rawValue.y,c.components[1]),createAxis$1(value.rawValue.z,c.components[2])],parser:parseNumber,value,viewProps:args.viewProps})}};class Point4d{constructor(x=0,y=0,z=0,w=0){this.x=x,this.y=y,this.z=z,this.w=w}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(obj){if(isEmpty(obj))return!1;let x=obj.x,y=obj.y,z=obj.z,w=obj.w;return!(typeof x!="number"||typeof y!="number"||typeof z!="number"||typeof w!="number")}static equals(v1,v2){return v1.x===v2.x&&v1.y===v2.y&&v1.z===v2.z&&v1.w===v2.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}let Point4dAssembly={toComponents:p=>p.getComponents(),fromComponents:comps=>new Point4d(...comps)};function point4dFromUnknown(value){return Point4d.isObject(value)?new Point4d(value.x,value.y,value.z,value.w):new Point4d}function writePoint4d(target,value){target.writeProperty("x",value.x),target.writeProperty("y",value.y),target.writeProperty("z",value.z),target.writeProperty("w",value.w)}function createDimensionConstraint(params){if(!params)return;let constraints=[];return isEmpty(params.step)||constraints.push(new StepConstraint(params.step)),(!isEmpty(params.max)||!isEmpty(params.min))&&constraints.push(new RangeConstraint({max:params.max,min:params.min})),new CompositeConstraint(constraints)}function createConstraint$1(params){return new PointNdConstraint({assembly:Point4dAssembly,components:[createDimensionConstraint("x"in params?params.x:void 0),createDimensionConstraint("y"in params?params.y:void 0),createDimensionConstraint("z"in params?params.z:void 0),createDimensionConstraint("w"in params?params.w:void 0)]})}function createAxis(initialValue,constraint){return{baseStep:getBaseStep(constraint),constraint,textProps:ValueMap.fromObject({draggingScale:getSuitableDraggingScale(constraint,initialValue),formatter:createNumberFormatter(getSuitableDecimalDigits(constraint,initialValue))})}}let Point4dInputPlugin={id:"input-point4d",type:"input",accept:(value,params)=>{if(!Point4d.isObject(value))return null;let p=ParamsParsers,result=parseParams(params,{x:p.optional.custom(parsePointDimensionParams),y:p.optional.custom(parsePointDimensionParams),z:p.optional.custom(parsePointDimensionParams),w:p.optional.custom(parsePointDimensionParams)});return result?{initialValue:value,params:result}:null},binding:{reader:_args=>point4dFromUnknown,constraint:args=>createConstraint$1(args.params),equals:Point4d.equals,writer:_args=>writePoint4d},controller:args=>{let value=args.value,c=args.constraint;if(!(c instanceof PointNdConstraint))throw TpError.shouldNeverHappen();return new PointNdTextController(args.document,{assembly:Point4dAssembly,axes:value.rawValue.getComponents().map((comp,index)=>createAxis(comp,c.components[index])),parser:parseNumber,value,viewProps:args.viewProps})}};function createConstraint(params){let constraints=[],lc=createListConstraint(params.options);return lc&&constraints.push(lc),new CompositeConstraint(constraints)}let StringInputPlugin={id:"input-string",type:"input",accept:(value,params)=>{if(typeof value!="string")return null;let result=parseParams(params,{options:ParamsParsers.optional.custom(parseListOptions)});return result?{initialValue:value,params:result}:null},binding:{reader:_args=>stringFromUnknown,constraint:args=>createConstraint(args.params),writer:_args=>writePrimitive},controller:args=>{var _a;let doc=args.document,value=args.value,c=args.constraint;return c&&findConstraint(c,ListConstraint)?new ListController(doc,{props:ValueMap.fromObject({options:(_a=findListItems(c))!==null&&_a!==void 0?_a:[]}),value,viewProps:args.viewProps}):new TextController(doc,{parser:v=>v,props:ValueMap.fromObject({formatter:formatString}),value,viewProps:args.viewProps})}},Constants={monitor:{defaultInterval:200,defaultLineCount:3}},className$2=ClassName("mll");class MultiLogView{constructor(doc,config){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=config.formatter,this.element=doc.createElement("div"),this.element.classList.add(className$2()),config.viewProps.bindClassModifiers(this.element);let textareaElem=doc.createElement("textarea");textareaElem.classList.add(className$2("i")),textareaElem.style.height=`calc(var(--bld-us) * ${config.lineCount})`,textareaElem.readOnly=!0,config.viewProps.bindDisabled(textareaElem),this.element.appendChild(textareaElem),this.textareaElem_=textareaElem,config.value.emitter.on("change",this.onValueUpdate_),this.value=config.value,this.update_()}update_(){let elem=this.textareaElem_,shouldScroll=elem.scrollTop===elem.scrollHeight-elem.clientHeight,lines=[];this.value.rawValue.forEach(value=>{value!==void 0&&lines.push(this.formatter_(value))}),elem.textContent=lines.join(`
`),shouldScroll&&(elem.scrollTop=elem.scrollHeight)}onValueUpdate_(){this.update_()}}class MultiLogController{constructor(doc,config){this.value=config.value,this.viewProps=config.viewProps,this.view=new MultiLogView(doc,{formatter:config.formatter,lineCount:config.lineCount,value:this.value,viewProps:this.viewProps})}}let className$1=ClassName("sgl");class SingleLogView{constructor(doc,config){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=config.formatter,this.element=doc.createElement("div"),this.element.classList.add(className$1()),config.viewProps.bindClassModifiers(this.element);let inputElem=doc.createElement("input");inputElem.classList.add(className$1("i")),inputElem.readOnly=!0,inputElem.type="text",config.viewProps.bindDisabled(inputElem),this.element.appendChild(inputElem),this.inputElement=inputElem,config.value.emitter.on("change",this.onValueUpdate_),this.value=config.value,this.update_()}update_(){let values=this.value.rawValue,lastValue=values[values.length-1];this.inputElement.value=lastValue!==void 0?this.formatter_(lastValue):""}onValueUpdate_(){this.update_()}}class SingleLogController{constructor(doc,config){this.value=config.value,this.viewProps=config.viewProps,this.view=new SingleLogView(doc,{formatter:config.formatter,value:this.value,viewProps:this.viewProps})}}let BooleanMonitorPlugin={id:"monitor-bool",type:"monitor",accept:(value,params)=>{if(typeof value!="boolean")return null;let result=parseParams(params,{lineCount:ParamsParsers.optional.number});return result?{initialValue:value,params:result}:null},binding:{reader:_args=>boolFromUnknown},controller:args=>{var _a;return args.value.rawValue.length===1?new SingleLogController(args.document,{formatter:BooleanFormatter,value:args.value,viewProps:args.viewProps}):new MultiLogController(args.document,{formatter:BooleanFormatter,lineCount:(_a=args.params.lineCount)!==null&&_a!==void 0?_a:Constants.monitor.defaultLineCount,value:args.value,viewProps:args.viewProps})}};class GraphCursor{constructor(){this.emitter=new Emitter,this.index_=-1}get index(){return this.index_}set index(index){this.index_!==index&&(this.index_=index,this.emitter.emit("change",{index,sender:this}))}}let className=ClassName("grl");class GraphLogView{constructor(doc,config){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=doc.createElement("div"),this.element.classList.add(className()),config.viewProps.bindClassModifiers(this.element),this.formatter_=config.formatter,this.minValue_=config.minValue,this.maxValue_=config.maxValue,this.cursor_=config.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);let svgElem=doc.createElementNS(SVG_NS,"svg");svgElem.classList.add(className("g")),svgElem.style.height=`calc(var(--bld-us) * ${config.lineCount})`,this.element.appendChild(svgElem),this.svgElem_=svgElem;let lineElem=doc.createElementNS(SVG_NS,"polyline");this.svgElem_.appendChild(lineElem),this.lineElem_=lineElem;let tooltipElem=doc.createElement("div");tooltipElem.classList.add(className("t"),ClassName("tt")()),this.element.appendChild(tooltipElem),this.tooltipElem_=tooltipElem,config.value.emitter.on("change",this.onValueUpdate_),this.value=config.value,this.update_()}get graphElement(){return this.svgElem_}update_(){let bounds=this.svgElem_.getBoundingClientRect(),maxIndex=this.value.rawValue.length-1,min=this.minValue_,max=this.maxValue_,points=[];this.value.rawValue.forEach((v,index)=>{if(v===void 0)return;let x=mapRange(index,0,maxIndex,0,bounds.width),y=mapRange(v,min,max,bounds.height,0);points.push([x,y].join(","))}),this.lineElem_.setAttributeNS(null,"points",points.join(" "));let tooltipElem=this.tooltipElem_,value=this.value.rawValue[this.cursor_.index];if(value===void 0){tooltipElem.classList.remove(className("t","a"));return}let tx=mapRange(this.cursor_.index,0,maxIndex,0,bounds.width),ty=mapRange(value,min,max,bounds.height,0);tooltipElem.style.left=`${tx}px`,tooltipElem.style.top=`${ty}px`,tooltipElem.textContent=`${this.formatter_(value)}`,tooltipElem.classList.contains(className("t","a"))||(tooltipElem.classList.add(className("t","a"),className("t","in")),forceReflow(tooltipElem),tooltipElem.classList.remove(className("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class GraphLogController{constructor(doc,config){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.value=config.value,this.viewProps=config.viewProps,this.cursor_=new GraphCursor,this.view=new GraphLogView(doc,{cursor:this.cursor_,formatter:config.formatter,lineCount:config.lineCount,maxValue:config.maxValue,minValue:config.minValue,value:this.value,viewProps:this.viewProps}),!supportsTouch(doc))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{let ph=new PointerHandler(this.view.element);ph.emitter.on("down",this.onGraphPointerDown_),ph.emitter.on("move",this.onGraphPointerMove_),ph.emitter.on("up",this.onGraphPointerUp_)}}onGraphMouseLeave_(){this.cursor_.index=-1}onGraphMouseMove_(ev){let bounds=this.view.element.getBoundingClientRect();this.cursor_.index=Math.floor(mapRange(ev.offsetX,0,bounds.width,0,this.value.rawValue.length))}onGraphPointerDown_(ev){this.onGraphPointerMove_(ev)}onGraphPointerMove_(ev){if(!ev.data.point){this.cursor_.index=-1;return}this.cursor_.index=Math.floor(mapRange(ev.data.point.x,0,ev.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.index=-1}}function createFormatter(params){return"format"in params&&!isEmpty(params.format)?params.format:createNumberFormatter(2)}function createTextMonitor(args){var _a;return args.value.rawValue.length===1?new SingleLogController(args.document,{formatter:createFormatter(args.params),value:args.value,viewProps:args.viewProps}):new MultiLogController(args.document,{formatter:createFormatter(args.params),lineCount:(_a=args.params.lineCount)!==null&&_a!==void 0?_a:Constants.monitor.defaultLineCount,value:args.value,viewProps:args.viewProps})}function createGraphMonitor(args){var _a,_b,_c;return new GraphLogController(args.document,{formatter:createFormatter(args.params),lineCount:(_a=args.params.lineCount)!==null&&_a!==void 0?_a:Constants.monitor.defaultLineCount,maxValue:(_b="max"in args.params?args.params.max:null)!==null&&_b!==void 0?_b:100,minValue:(_c="min"in args.params?args.params.min:null)!==null&&_c!==void 0?_c:0,value:args.value,viewProps:args.viewProps})}function shouldShowGraph(params){return"view"in params&&params.view==="graph"}let NumberMonitorPlugin={id:"monitor-number",type:"monitor",accept:(value,params)=>{if(typeof value!="number")return null;let p=ParamsParsers,result=parseParams(params,{format:p.optional.function,lineCount:p.optional.number,max:p.optional.number,min:p.optional.number,view:p.optional.string});return result?{initialValue:value,params:result}:null},binding:{defaultBufferSize:params=>shouldShowGraph(params)?64:1,reader:_args=>numberFromUnknown},controller:args=>shouldShowGraph(args.params)?createGraphMonitor(args):createTextMonitor(args)},StringMonitorPlugin={id:"monitor-string",type:"monitor",accept:(value,params)=>{if(typeof value!="string")return null;let p=ParamsParsers,result=parseParams(params,{lineCount:p.optional.number,multiline:p.optional.boolean});return result?{initialValue:value,params:result}:null},binding:{reader:_args=>stringFromUnknown},controller:args=>{var _a;let value=args.value;return value.rawValue.length>1||"multiline"in args.params&&args.params.multiline?new MultiLogController(args.document,{formatter:formatString,lineCount:(_a=args.params.lineCount)!==null&&_a!==void 0?_a:Constants.monitor.defaultLineCount,value,viewProps:args.viewProps}):new SingleLogController(args.document,{formatter:formatString,value,viewProps:args.viewProps})}};class InputBinding{constructor(config){this.onValueChange_=this.onValueChange_.bind(this),this.reader=config.reader,this.writer=config.writer,this.emitter=new Emitter,this.value=config.value,this.value.emitter.on("change",this.onValueChange_),this.target=config.target,this.read()}read(){let targetValue=this.target.read();targetValue!==void 0&&(this.value.rawValue=this.reader(targetValue))}write_(rawValue){this.writer(this.target,rawValue)}onValueChange_(ev){this.write_(ev.rawValue),this.emitter.emit("change",{options:ev.options,rawValue:ev.rawValue,sender:this})}}function createInputBindingController(plugin,args){let result=plugin.accept(args.target.read(),args.params);if(isEmpty(result))return null;let p=ParamsParsers,valueArgs={target:args.target,initialValue:result.initialValue,params:result.params},reader=plugin.binding.reader(valueArgs),constraint=plugin.binding.constraint?plugin.binding.constraint(valueArgs):void 0,value=createValue(reader(result.initialValue),{constraint,equals:plugin.binding.equals}),binding=new InputBinding({reader,target:args.target,value,writer:plugin.binding.writer(valueArgs)}),disabled=p.optional.boolean(args.params.disabled).value,hidden=p.optional.boolean(args.params.hidden).value,controller=plugin.controller({constraint,document:args.document,initialValue:result.initialValue,params:result.params,value:binding.value,viewProps:ViewProps.create({disabled,hidden})}),label=p.optional.string(args.params.label).value;return new InputBindingController(args.document,{binding,blade:createBlade(),props:ValueMap.fromObject({label:label||args.target.key}),valueController:controller})}class MonitorBinding{constructor(config){this.onTick_=this.onTick_.bind(this),this.reader_=config.reader,this.target=config.target,this.emitter=new Emitter,this.value=config.value,this.ticker=config.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){let targetValue=this.target.read();if(targetValue===void 0)return;let buffer=this.value.rawValue,newValue=this.reader_(targetValue);this.value.rawValue=createPushedBuffer(buffer,newValue),this.emitter.emit("update",{rawValue:newValue,sender:this})}onTick_(_){this.read()}}function createTicker(document2,interval){return interval===0?new ManualTicker:new IntervalTicker(document2,interval!=null?interval:Constants.monitor.defaultInterval)}function createMonitorBindingController(plugin,args){var _a,_b,_c;let P=ParamsParsers,result=plugin.accept(args.target.read(),args.params);if(isEmpty(result))return null;let bindingArgs={target:args.target,initialValue:result.initialValue,params:result.params},reader=plugin.binding.reader(bindingArgs),bufferSize=(_b=(_a=P.optional.number(args.params.bufferSize).value)!==null&&_a!==void 0?_a:plugin.binding.defaultBufferSize&&plugin.binding.defaultBufferSize(result.params))!==null&&_b!==void 0?_b:1,interval=P.optional.number(args.params.interval).value,binding=new MonitorBinding({reader,target:args.target,ticker:createTicker(args.document,interval),value:initializeBuffer(bufferSize)}),disabled=P.optional.boolean(args.params.disabled).value,hidden=P.optional.boolean(args.params.hidden).value,controller=plugin.controller({document:args.document,params:result.params,value:binding.value,viewProps:ViewProps.create({disabled,hidden})}),label=(_c=P.optional.string(args.params.label).value)!==null&&_c!==void 0?_c:args.target.key;return new MonitorBindingController(args.document,{binding,blade:createBlade(),props:ValueMap.fromObject({label}),valueController:controller})}class PluginPool{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(r){r.type==="blade"?this.pluginsMap_.blades.unshift(r):r.type==="input"?this.pluginsMap_.inputs.unshift(r):r.type==="monitor"&&this.pluginsMap_.monitors.unshift(r)}createInput(document2,target,params){let initialValue=target.read();if(isEmpty(initialValue))throw new TpError({context:{key:target.key},type:"nomatchingcontroller"});let bc=this.pluginsMap_.inputs.reduce((result,plugin)=>result||createInputBindingController(plugin,{document:document2,target,params}),null);if(bc)return bc;throw new TpError({context:{key:target.key},type:"nomatchingcontroller"})}createMonitor(document2,target,params){let bc=this.pluginsMap_.monitors.reduce((result,plugin)=>result||createMonitorBindingController(plugin,{document:document2,params,target}),null);if(bc)return bc;throw new TpError({context:{key:target.key},type:"nomatchingcontroller"})}createBlade(document2,params){let bc=this.pluginsMap_.blades.reduce((result,plugin)=>result||createBladeController(plugin,{document:document2,params}),null);if(!bc)throw new TpError({type:"nomatchingview",context:{params}});return bc}createBladeApi(bc){if(bc instanceof InputBindingController)return new InputBindingApi(bc);if(bc instanceof MonitorBindingController)return new MonitorBindingApi(bc);if(bc instanceof RackController)return new RackApi(bc,this);let api=this.pluginsMap_.blades.reduce((result,plugin)=>result||plugin.api({controller:bc,pool:this}),null);if(!api)throw TpError.shouldNeverHappen();return api}}function createDefaultPluginPool(){let pool=new PluginPool;return[Point2dInputPlugin,Point3dInputPlugin,Point4dInputPlugin,StringInputPlugin,NumberInputPlugin,StringColorInputPlugin,ObjectColorInputPlugin,NumberColorInputPlugin,BooleanInputPlugin,BooleanMonitorPlugin,StringMonitorPlugin,NumberMonitorPlugin,ButtonBladePlugin,FolderBladePlugin,SeparatorBladePlugin,TabBladePlugin].forEach(p=>{pool.register(p)}),pool}class ListApi extends BladeApi{constructor(controller){super(controller);this.emitter_=new Emitter,this.controller_.valueController.value.emitter.on("change",ev=>{this.emitter_.emit("change",{event:new TpChangeEvent(this,ev.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(label){this.controller_.props.set("label",label)}get options(){return this.controller_.valueController.props.get("options")}set options(options){this.controller_.valueController.props.set("options",options)}get value(){return this.controller_.valueController.value.rawValue}set value(value){this.controller_.valueController.value.rawValue=value}on(eventName,handler){let bh=handler.bind(this);return this.emitter_.on(eventName,ev=>{bh(ev.event)}),this}}class SliderApi extends BladeApi{constructor(controller){super(controller);this.emitter_=new Emitter,this.controller_.valueController.value.emitter.on("change",ev=>{this.emitter_.emit("change",{event:new TpChangeEvent(this,ev.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(label){this.controller_.props.set("label",label)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(maxValue){this.controller_.valueController.sliderController.props.set("maxValue",maxValue)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(minValue){this.controller_.valueController.sliderController.props.set("minValue",minValue)}get value(){return this.controller_.valueController.value.rawValue}set value(value){this.controller_.valueController.value.rawValue=value}on(eventName,handler){let bh=handler.bind(this);return this.emitter_.on(eventName,ev=>{bh(ev.event)}),this}}class TextApi extends BladeApi{constructor(controller){super(controller);this.emitter_=new Emitter,this.controller_.valueController.value.emitter.on("change",ev=>{this.emitter_.emit("change",{event:new TpChangeEvent(this,ev.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(label){this.controller_.props.set("label",label)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(formatter){this.controller_.valueController.props.set("formatter",formatter)}get value(){return this.controller_.valueController.value.rawValue}set value(value){this.controller_.valueController.value.rawValue=value}on(eventName,handler){let bh=handler.bind(this);return this.emitter_.on(eventName,ev=>{bh(ev.event)}),this}}let ListBladePlugin=function(){return{id:"list",type:"blade",accept(params){let p=ParamsParsers,result=parseParams(params,{options:p.required.custom(parseListOptions),value:p.required.raw,view:p.required.constant("list"),label:p.optional.string});return result?{params:result}:null},controller(args){let ic=new ListController(args.document,{props:ValueMap.fromObject({options:normalizeListOptions(args.params.options)}),value:createValue(args.params.value),viewProps:args.viewProps});return new LabeledValueController(args.document,{blade:args.blade,props:ValueMap.fromObject({label:args.params.label}),valueController:ic})},api(args){return!(args.controller instanceof LabeledValueController)||!(args.controller.valueController instanceof ListController)?null:new ListApi(args.controller)}}}();function exportPresetJson(targets){return targets.reduce((result,target)=>Object.assign(result,{[target.presetKey]:target.read()}),{})}function importPresetJson(targets,preset){targets.forEach(target=>{let value=preset[target.presetKey];value!==void 0&&target.write(value)})}class RootApi extends FolderApi{constructor(controller,pool){super(controller,pool)}get element(){return this.controller_.view.element}importPreset(preset){let targets=this.controller_.rackController.rack.find(InputBindingController).map(ibc=>ibc.binding.target);importPresetJson(targets,preset),this.refresh()}exportPreset(){let targets=this.controller_.rackController.rack.find(InputBindingController).map(ibc=>ibc.binding.target);return exportPresetJson(targets)}refresh(){this.controller_.rackController.rack.find(InputBindingController).forEach(ibc=>{ibc.binding.read()}),this.controller_.rackController.rack.find(MonitorBindingController).forEach(mbc=>{mbc.binding.read()})}}class RootController extends FolderController{constructor(doc,config){super(doc,{expanded:config.expanded,blade:config.blade,props:config.props,root:!0,viewProps:config.viewProps})}}let SliderBladePlugin={id:"slider",type:"blade",accept(params){let p=ParamsParsers,result=parseParams(params,{max:p.required.number,min:p.required.number,view:p.required.constant("slider"),format:p.optional.function,label:p.optional.string,value:p.optional.number});return result?{params:result}:null},controller(args){var _a,_b;let v=(_a=args.params.value)!==null&&_a!==void 0?_a:0,vc=new SliderTextController(args.document,{baseStep:1,parser:parseNumber,sliderProps:ValueMap.fromObject({maxValue:args.params.max,minValue:args.params.min}),textProps:ValueMap.fromObject({draggingScale:getSuitableDraggingScale(void 0,v),formatter:(_b=args.params.format)!==null&&_b!==void 0?_b:numberToString}),value:createValue(v),viewProps:args.viewProps});return new LabeledValueController(args.document,{blade:args.blade,props:ValueMap.fromObject({label:args.params.label}),valueController:vc})},api(args){return!(args.controller instanceof LabeledValueController)||!(args.controller.valueController instanceof SliderTextController)?null:new SliderApi(args.controller)}},TextBladePlugin=function(){return{id:"text",type:"blade",accept(params){let p=ParamsParsers,result=parseParams(params,{parse:p.required.function,value:p.required.raw,view:p.required.constant("text"),format:p.optional.function,label:p.optional.string});return result?{params:result}:null},controller(args){var _a;let ic=new TextController(args.document,{parser:args.params.parse,props:ValueMap.fromObject({formatter:(_a=args.params.format)!==null&&_a!==void 0?_a:v=>String(v)}),value:createValue(args.params.value),viewProps:args.viewProps});return new LabeledValueController(args.document,{blade:args.blade,props:ValueMap.fromObject({label:args.params.label}),valueController:ic})},api(args){return!(args.controller instanceof LabeledValueController)||!(args.controller.valueController instanceof TextController)?null:new TextApi(args.controller)}}}();function createDefaultWrapperElement(doc){let elem=doc.createElement("div");return elem.classList.add(ClassName("dfw")()),doc.body&&doc.body.appendChild(elem),elem}function embedStyle(doc,id,css){if(doc.querySelector(`style[data-tp-style=${id}]`))return;let styleElem=doc.createElement("style");styleElem.dataset.tpStyle=id,styleElem.textContent=css,doc.head.appendChild(styleElem)}class Pane3 extends RootApi{constructor(opt_config){var _a;let config=opt_config||{},doc=(_a=config.document)!==null&&_a!==void 0?_a:getWindowDocument(),pool=createDefaultPluginPool(),rootController=new RootController(doc,{expanded:config.expanded,blade:createBlade(),props:ValueMap.fromObject({title:config.title}),viewProps:ViewProps.create()});super(rootController,pool);this.pool_=pool,this.containerElem_=config.container||createDefaultWrapperElement(doc),this.containerElem_.appendChild(this.element),this.doc_=doc,this.usesDefaultWrapper_=!config.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw TpError.alreadyDisposed();return this.doc_}dispose(){let containerElem=this.containerElem_;if(!containerElem)throw TpError.alreadyDisposed();if(this.usesDefaultWrapper_){let parentElem=containerElem.parentElement;parentElem&&parentElem.removeChild(containerElem)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(bundle){("plugin"in bundle?[bundle.plugin]:"plugins"in bundle?bundle.plugins:[]).forEach(p=>{this.pool_.register(p),this.embedPluginStyle_(p)})}embedPluginStyle_(plugin){plugin.css&&embedStyle(this.document,`plugin-${plugin.id}`,plugin.css)}setUpDefaultPlugins_(){embedStyle(this.document,"default",".tp-lstv_s,.tp-btnv_b,.tp-p2dv_b,.tp-colswv_sw,.tp-p2dpv_p,.tp-txtv_i,.tp-grlv_g,.tp-sglv_i,.tp-mllv_i,.tp-fldv_b,.tp-rotv_b,.tp-ckbv_i,.tp-coltxtv_ms,.tp-tbiv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-lstv_s,.tp-btnv_b,.tp-p2dv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-lstv_s:hover,.tp-btnv_b:hover,.tp-p2dv_b:hover{background-color:var(--btn-bg-h)}.tp-lstv_s:focus,.tp-btnv_b:focus,.tp-p2dv_b:focus{background-color:var(--btn-bg-f)}.tp-lstv_s:active,.tp-btnv_b:active,.tp-p2dv_b:active{background-color:var(--btn-bg-a)}.tp-lstv_s:disabled,.tp-btnv_b:disabled,.tp-p2dv_b:disabled{opacity:0.5}.tp-colswv_sw,.tp-p2dpv_p,.tp-txtv_i{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-colswv_sw:hover,.tp-p2dpv_p:hover,.tp-txtv_i:hover{background-color:var(--in-bg-h)}.tp-colswv_sw:focus,.tp-p2dpv_p:focus,.tp-txtv_i:focus{background-color:var(--in-bg-f)}.tp-colswv_sw:active,.tp-p2dpv_p:active,.tp-txtv_i:active{background-color:var(--in-bg-a)}.tp-colswv_sw:disabled,.tp-p2dpv_p:disabled,.tp-txtv_i:disabled{opacity:0.5}.tp-grlv_g,.tp-sglv_i,.tp-mllv_i{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);width:100%}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono,Source Code Pro,Menlo,Courier,monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, #2f3137);--bs-sh: var(--tp-base-shadow-color, rgba(0,0,0,0.2));--btn-bg: var(--tp-button-background-color, #adafb8);--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, #2f3137);--cnt-bg: var(--tp-container-background-color, rgba(187,188,196,0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187,188,196,0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187,188,196,0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187,188,196,0.15));--cnt-fg: var(--tp-container-foreground-color, #bbbcc4);--in-bg: var(--tp-input-background-color, rgba(187,188,196,0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187,188,196,0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187,188,196,0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187,188,196,0.15));--in-fg: var(--tp-input-foreground-color, #bbbcc4);--lbl-fg: var(--tp-label-foreground-color, rgba(187,188,196,0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0,0,0,0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187,188,196,0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(0,0,0,0.2))}.tp-fldv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-rotv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1 * var(--cnt-v-p))}.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-fldv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-rotv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-fldv_c>.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv{margin-left:4px}.tp-fldv_c>.tp-fldv>.tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-fldv_c .tp-fldv>.tp-fldv_c,.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-fldv_c>.tp-tabv>.tp-tabv_i,.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_i{border-top-left-radius:var(--elm-br)}.tp-fldv_c .tp-tabv>.tp-tabv_c,.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-fldv_b,.tp-rotv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(2px * 2 + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-fldv_b:hover,.tp-rotv_b:hover{background-color:var(--cnt-bg-h)}.tp-fldv_b:focus,.tp-rotv_b:focus{background-color:var(--cnt-bg-f)}.tp-fldv_b:active,.tp-rotv_b:active{background-color:var(--cnt-bg-a)}.tp-fldv_b:disabled,.tp-rotv_b:disabled{opacity:0.5}.tp-fldv_m,.tp-rotv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:'';display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px) / 2 - 2px);margin:auto;opacity:0.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m,.tp-rotv.tp-rotv-expanded .tp-rotv_m{transform:none}.tp-fldv_c,.tp-rotv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c,.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c{display:none}.tp-fldv.tp-fldv-expanded>.tp-fldv_c,.tp-rotv.tp-rotv-expanded .tp-rotv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-coltxtv_m,.tp-lstv{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-coltxtv_mm,.tp-lstv_m{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-coltxtv_mm svg,.tp-lstv_m svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-coltxtv_mm svg path,.tp-lstv_m svg path{fill:currentColor}.tp-coltxtv_w,.tp-pndtxtv{display:flex}.tp-coltxtv_c,.tp-pndtxtv_a{width:100%}.tp-coltxtv_c+.tp-coltxtv_c,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-pndtxtv_a{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:0.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1 * var(--cnt-h-p));right:calc(-1 * var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a:before{background-color:var(--grv-fg);content:'';height:2px;left:calc(-1 * var(--cnt-h-p));position:absolute;right:calc(-1 * var(--cnt-h-p));top:0}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us) * 4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,0.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0,0,0,0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,0.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,0.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,0.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,0.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br)}.tp-colswv.tp-v-disabled{opacity:0.5}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,0.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:'';display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_c{border-left:var(--cnt-bg) solid 4px}.tp-fldv_b:hover+.tp-fldv_c{border-left-color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_c{border-left-color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_c{border-left-color:var(--cnt-bg-a)}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us) * 3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left 0.05s, top 0.05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:0.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:0.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:0.5}.tp-mllv_i{display:block;height:calc(var(--bld-us) * 3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:0.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1 * var(--cnt-h-p));right:calc(-1 * var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:0.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:0.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sldv.tp-v-disabled{opacity:0.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:'';display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:'';display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:'';display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv.tp-v-disabled{opacity:0.5}.tp-tabv_i{align-items:flex-end;display:flex;overflow:hidden}.tp-tabv.tp-tabv-nop .tp-tabv_i{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_i::before{background-color:var(--cnt-bg);bottom:0;content:'';height:2px;left:0;position:absolute;right:0}.tp-tabv_c{border-left:var(--cnt-bg) solid 4px;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p)}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv::before{background-color:var(--cnt-bg);bottom:0;content:'';height:2px;left:-2px;position:absolute;width:2px}.tp-tbiv_b{background-color:var(--cnt-bg);display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);width:100%}.tp-tbiv_b:hover{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active{background-color:var(--cnt-bg-a)}.tp-tbiv_b:disabled{opacity:0.5}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:0.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:0.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:'';height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:0.1;position:absolute;top:0;transition:border-radius 0.1s, height 0.1s, transform 0.1s, width 0.1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) transparent transparent transparent;border-style:solid;border-width:2px;box-sizing:border-box;content:'';font-size:0.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(2px * 2 + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c,.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1 * var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1 * var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_i{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}"),this.pool_.getAll().forEach(plugin=>{this.embedPluginStyle_(plugin)}),this.registerPlugin({plugins:[SliderBladePlugin,ListBladePlugin,TabBladePlugin,TextBladePlugin]})}}let VERSION=new Semver("3.0.7");exports2.BladeApi=BladeApi,exports2.ButtonApi=ButtonApi,exports2.FolderApi=FolderApi,exports2.InputBindingApi=InputBindingApi,exports2.ListApi=ListApi,exports2.MonitorBindingApi=MonitorBindingApi,exports2.Pane=Pane3,exports2.SeparatorApi=SeparatorApi,exports2.SliderApi=SliderApi,exports2.TabApi=TabApi,exports2.TabPageApi=TabPageApi,exports2.TextApi=TextApi,exports2.TpChangeEvent=TpChangeEvent,exports2.VERSION=VERSION,Object.defineProperty(exports2,"__esModule",{value:!0})})}});var import_react18=__toESM(require_react(),1);var import_react=__toESM(require_react(),1);function Angles(){return import_react.default.useEffect(()=>{setup()},[]),import_react.default.createElement(import_react.default.Fragment,null,import_react.default.createElement("div",{id:"ui"}),import_react.default.createElement("h1",null,"Angles"))}function setup(){let ui=new ThreeUi("ui");ui.camera.position.set(0,1,4);let material=new LineBasicMaterial({color:65280}),axes1=new AxesHelper;axes1.position.x=-1.1,axes1.add(angle(41*toRad,null,material,!0)),ui.scene.add(axes1);let axes2=new AxesHelper;axes2.position.x=1.1;let angle2=angle(270*toRad,null,material,!0);angle2.rotation.x=Math.PI/2,axes2.add(angle2),ui.scene.add(axes2)}var import_react2=__toESM(require_react(),1);function Asterisms2(){let[asterisms,setAsterisms]=import_react2.default.useState(null),[stars,setStars]=import_react2.default.useState(null);import_react2.default.useEffect(()=>{setStars(setup2(setAsterisms))},[]);let location2=useLocation();return import_react2.default.useEffect(()=>{if(asterisms){let asterismName=(location2.hash||"#Orion").substr(1).replaceAll(/%20/g," "),[origName,name,hipId]=findCenterStar(stars,asterisms,asterismName),star=stars.catalog.starsByHip[hipId],labelPos=stars.labelCenterPosByName[name];if(!labelPos)return;asterisms.show(asterismName,()=>!0),window.target=labelPos}},[location2]),import_react2.default.createElement(import_react2.default.Fragment,null,import_react2.default.createElement("div",{id:"ui"}),import_react2.default.createElement("h1",null,"Asterisms"),"Asterisms include constellations.",import_react2.default.createElement("div",{id:"faveCtr"},import_react2.default.createElement("table",{id:"faves",cellPadding:"5em"},import_react2.default.createElement("tbody",null,import_react2.default.createElement("tr",null,import_react2.default.createElement("th",null,"Asterism"),import_react2.default.createElement("th",null,"Midpoint Star"),import_react2.default.createElement("th",null,"Midpoint Star HIP"))))))}function setup2(setAsterisms){let cb=(scene,ui2)=>{window.target&&(ui2.camera.target=window.target,ui2.camera.lookAt(window.target))},ui=new ThreeUi("ui",cb),k=new Keys;k.map(",",()=>{ui.multFov(.9)},"Narrow field-of-vision"),k.map(".",()=>{ui.multFov(1.1)},"Broaden field-of-vision"),k.map("/",()=>{ui.resetFov()},"Reset field-of-vision to "+INITIAL_FOV+"\xBA");let props={radius:{scalar:694248950}},stars=new Stars(props,()=>{new Asterisms(stars,asterisms=>{stars.add(asterisms),setupFavesTable(stars,asterisms),setAsterisms(asterisms)})},!0);return ui.scene.add(stars),ui.camera.position.z=100,stars}function findCenterStar(stars,asterisms,asterismName){let asterism=asterisms.catalog.byName[asterismName];for(let pathNdx in asterism.paths){let path=asterism.paths[pathNdx];for(let i=Math.floor(path.length/2);i>=0;i--){let starName=path[i],[origName,name,hipId]=stars.catalog.reifyName(starName),names=stars.catalog.namesByHip[hipId];if(names&&names.length>2)return name=names[0],[origName,name,hipId]}}return[null,null,null]}function setupFavesTable(stars,asterisms){let favesTable=elt("faves");for(let asterismName in asterisms.catalog.byName){let[origName,name,hipId]=findCenterStar(stars,asterisms,asterismName);name==null||hipId==null||(favesTable.innerHTML+=`<tr>
        <td><a href="#${asterismName}">${asterismName}</a></td>
        <td>${name}</td>
        <td>${hipId}</td>
      </tr>`)}}var import_react3=__toESM(require_react(),1);var Atmosphere=class{constructor(SunY,SunIntensity,GroundElevation,AtmosphereHeight,RayleighRed,RayleighGreen,RayleighBlue,RayleighScaleHeight,MieScatteringCoeff,MieScaleHeight,MiePolarity){this.EyeHeight=2,this.SunY=SunY,this.SunIntensity=SunIntensity,this.GroundElevation=GroundElevation,this.AtmosphereHeight=AtmosphereHeight,this.RayleighRed=RayleighRed,this.RayleighGreen=RayleighGreen,this.RayleighBlue=RayleighBlue,this.MieScatteringCoeff=MieScatteringCoeff,this.RayleighScaleHeight=RayleighScaleHeight,this.MieScaleHeight=MieScaleHeight,this.MiePolarity=MiePolarity,this.Presets=""}};var import_tweakpane=__toESM(require_tweakpane(),1),PRESETS={Earth:{SunY:2,SunIntensity:22,GroundElevation:6371e3,AtmosphereHeight:6e4,RayleighRed:58e-7,RayleighGreen:135e-7,RayleighBlue:331e-7,RayleighScaleHeight:8e3,MieScatteringCoeff:21e-6,MieScaleHeight:1200,MiePolarity:.8},Mars:{SunY:2,SunIntensity:11,GroundElevation:6371e3,AtmosphereHeight:6e4,RayleighRed:15e-6,RayleighGreen:135e-7,RayleighBlue:58e-7,RayleighScaleHeight:11100,MieScatteringCoeff:42e-6,MieScaleHeight:1200,MiePolarity:.8}},AtmosphereControls=class extends import_tweakpane.Pane{constructor(container,atmos){super({container,expanded:!0,title:"Controls"});this.addInput(atmos,"SunY",{label:"Sun Y",min:-1,max:5}),this.addInput(atmos,"SunIntensity",{label:"Sun Intensity",min:0,max:atmos.SunIntensity*10}),this.addInput(atmos,"GroundElevation",{label:"Ground elevation (meters)",min:1,max:atmos.GroundElevation}),this.addInput(atmos,"AtmosphereHeight",{label:"Atmos. height (m)",min:1,max:atmos.AtmosphereHeight*2});let rls=this.addFolder({title:"Rayleigh Scattering"});rls.addInput(atmos,"RayleighRed",{label:"Red",min:1e-6,max:1e-4}),rls.addInput(atmos,"RayleighGreen",{label:"Green",min:1e-6,max:1e-4}),rls.addInput(atmos,"RayleighBlue",{label:"Blue",min:1e-6,max:1e-4}),rls.addInput(atmos,"RayleighScaleHeight",{label:"Scale height (m)",min:1,max:atmos.AtmosphereHeight});let mie=this.addFolder({title:"Mie Scattering"});mie.addInput(atmos,"MieScatteringCoeff",{label:"Scattering",min:1e-6,max:1e-4}),mie.addInput(atmos,"MieScaleHeight",{label:"Scale height (m)",min:1,max:atmos.AtmosphereHeight}),mie.addInput(atmos,"MiePolarity",{label:"Polarity",min:-.999,max:.999}),this.addInput(atmos,"Presets",{options:{Earth:"Earth",Mars:"Mars"}}).on("change",e=>{let preset=null;switch(e.value){case"Mars":preset=PRESETS.Mars;break;case"Earth":default:preset=PRESETS.Earth}this.importPreset(preset)})}};var AtmosphereObject3D=class extends Mesh{constructor(atmos){super(makeGeometry(),makeMaterial(atmos));this.atmosphere=atmos}onBeforeRender(){let u=this.material.uniforms,atmos=this.atmosphere;u.uEyePos.value.y=atmos.EyeHeight,u.uSunPos.value.y=atmos.SunY,u.uSunIntensity.value=atmos.SunIntensity,u.uGroundElevation.value=atmos.GroundElevation,u.uAtmosphereHeight.value=atmos.AtmosphereHeight,u.uRayleighScatteringCoeff.value.set(atmos.RayleighRed,atmos.RayleighGreen,atmos.RayleighBlue),u.uRayleighScaleHeight.value=atmos.RayleighScaleHeight,u.uMieScatteringCoeff.value=atmos.MieScatteringCoeff,u.uMieScaleHeight.value=atmos.MieScaleHeight,u.uMiePolarity.value=atmos.MiePolarity}};function makeGeometry(){let geometry=new BufferGeometry;return geometry.setAttribute("position",new Float32BufferAttribute([-1,-1,-1,1,-1,-1,1,1,-1,-1,-1,-1,1,1,-1,-1,1,-1],3)),geometry}function makeMaterial(atmos){let kLengthUnitInMeters=1e3,viewDistanceMeters=9e3,viewZenithAngleRadians=1.47,viewAzimuthAngleRadians=-.1,kFovY=Math.PI/4,kTanFovY=Math.tan(kFovY/2),aspectRatio=1,viewFromClip=new Float32Array(16),modelFromView=new Float32Array(16);viewFromClip.set([kTanFovY*aspectRatio,0,0,0,0,kTanFovY,0,0,0,0,0,-1,0,0,1,1]);let cosZ=Math.cos(viewZenithAngleRadians),sinZ=Math.sin(viewZenithAngleRadians),cosA=Math.cos(viewAzimuthAngleRadians),sinA=Math.sin(viewAzimuthAngleRadians),viewDistance=viewDistanceMeters/kLengthUnitInMeters;modelFromView.set([-sinA,-cosZ*cosA,sinZ*cosA,sinZ*cosA*viewDistance,cosA,-cosZ*sinA,sinZ*sinA,sinZ*sinA*viewDistance,0,sinZ,cosZ,cosZ*viewDistance,0,0,0,1]);let sunPos=-10;return new ShaderMaterial({uniforms:{model_from_view:{value:modelFromView},view_from_clip:{value:viewFromClip},uEyePos:{value:new Vector3(0,atmos.EyeHeight,0)},uSunPos:{value:new Vector3(0,atmos.SunY,-1)},earth_center:{value:new Vector3(0,0,atmos.EyeHeight)},sun_direction:{value:new Vector3(0,atmos.SunY,0)},sun_size:{value:new Vector2(1,1)},camera:{value:new Vector3(0,atmos.SunY,-1)},uSunIntensity:{value:atmos.SunIntensity},uGroundElevation:{value:atmos.GroundElevation},uAtmosphereHeight:{value:atmos.AtmosphereHeight},uRayleighScatteringCoeff:{value:new Vector3(atmos.RayleighRed,atmos.RayleighGreen,atmos.RayleighBlue)},uRayleighScaleHeight:{value:atmos.RayleighScaleHeight},uMieScatteringCoeff:{value:atmos.MieScatteringCoeff},uMieScaleHeight:{value:atmos.MieScaleHeight},uMiePolarity:{value:atmos.MiePolarity}},vertexShader:VERTEX_SHADER,fragmentShader:FRAGMENT_SHADER,blending:AdditiveBlending})}var VERTEX_SHADER=`varying vec3 vPosition;

uniform mat4 model_from_view;
uniform mat4 view_from_clip;
layout(location = 0) in vec4 vertex;
//out vec3 view_ray;
void main() {
  //view_ray = (model_from_view * vec4((view_from_clip * vertex).xyz, 0.0)).xyz;
  vec4 mvPosition = modelViewMatrix * vec4(position, 0.0);
  vPosition = position;
  gl_Position = projectionMatrix * mvPosition;
  //gl_Position = vec4(position, 1.0);
}
`,FRAGMENT_SHADER=`precision highp float;

varying vec3 vPosition;

uniform vec3 uSunPos;
uniform vec3 uEyePos;
uniform float uSunIntensity;
uniform float uGroundElevation;
uniform float uAtmosphereHeight;
uniform vec3 uRayleighScatteringCoeff;
uniform float uMieScatteringCoeff;
uniform float uRayleighScaleHeight;
uniform float uMieScaleHeight;
uniform float uMiePolarity;

uniform vec3 camera;
uniform vec3 earth_center;
uniform vec3 sun_direction;
uniform vec2 sun_size;

in vec3 view_ray;

#define PI 3.141592
#define iSteps 16
#define jSteps 8


vec2 rsi(vec3 r0, vec3 rd, float sr) {
    // ray-sphere intersection that assumes
    // the sphere is centered at the origin.
    // No intersection when result.x > result.y
    float a = dot(rd, rd);
    float b = 2.0 * dot(rd, r0);
    float c = dot(r0, r0) - (sr * sr);
    float d = (b*b) - 4.0*a*c;
    if (d < 0.0) return vec2(1e5,-1e5);
    return vec2(
        (-b - sqrt(d))/(2.0*a),
        (-b + sqrt(d))/(2.0*a)
    );
}


vec3 atmosphere(vec3 pVrt, vec3 pEye,
                vec3 pSun, float iSun,
                float rPlanet, float rAtmos,
                vec3 kRlh, float shRlh,
                float kMie, float shMie, float polarity) {
    // Normalize the sun and view directions.
    pVrt = normalize(pVrt);
    pSun = normalize(pSun);

    // Calculate the step size of the primary ray.
    vec2 p = rsi(pEye, pVrt, rAtmos);
    if (p.x > p.y) return vec3(0,0,0);
    p.y = min(p.y, rsi(pEye, pVrt, rPlanet).x);
    float iStepSize = (p.y - p.x) / float(iSteps);

    // Initialize the primary ray time.
    float iTime = 0.0;

    // Initialize accumulators for Rayleigh and Mie scattering.
    vec3 totalRlh = vec3(0,0,0);
    vec3 totalMie = vec3(0,0,0);

    // Initialize optical depth accumulators for the primary ray.
    float iOdRlh = 0.0;
    float iOdMie = 0.0;

    // Calculate the Rayleigh and Mie phases.
    // These look like some variant on:
    //   16.2.2 The Phase Function
    //   https://developer.nvidia.com/gpugems/gpugems2/part-ii-shading-lighting-and-shadows/chapter-16-accurate-atmospheric-scattering
    float mu = dot(pVrt, pSun);
    float mumu = mu * mu;
    float pol2 = polarity * polarity;
    // https://www.scratchapixel.com/lessons/procedural-generation-virtual-worlds/simulating-sky/simulating-colors-of-the-sky
    // Solid angle 0.1:
    float pRlh = 3.0 / (16.0 * PI) * (1.0 + mumu);
    // TODO: add sr term to (8.0 * PI * sr), maybe steradian (solid angle) of sun?
    // https://github.com/ebruneton/precomputed_atmospheric_scattering/blob/master/atmosphere/definitions.glsl#L209
    // TODO: test addition of abs inside base of pow (seen in Unity port)
    // TODO: Terrell and scratchpixel put (2.0 + pol2) in demoninator, Bruneton in numerator.
    // https://github.com/ebruneton/precomputed_atmospheric_scattering/blob/master/atmosphere/functions.glsl#L746
    float InverseSolidAngle = 3.0 / (8.0 * PI) * ((1.0 - pol2) * (1.0 + mumu));
    float pMie = InverseSolidAngle * (2.0 + pol2)
      / pow(1.0 + pol2 - 2.0 * polarity * mu, 1.5);

    // Sample the primary ray.
    for (int i = 0; i < iSteps; i++) {

        // Calculate the primary ray sample position.
        vec3 iPos = pEye + pVrt * (iTime + iStepSize * 0.5);

        // Calculate the height of the sample.
        float iHeight = length(iPos) - rPlanet;

        // Calculate the optical depth of the Rayleigh and Mie scattering for this step.
        float odStepRlh = exp(-iHeight / shRlh) * iStepSize;
        float odStepMie = exp(-iHeight / shMie) * iStepSize;

        // Accumulate optical depth.
        iOdRlh += odStepRlh;
        iOdMie += odStepMie;

        // Calculate the step size of the secondary ray.
        float jStepSize = rsi(iPos, pSun, rAtmos).y / float(jSteps);

        // Initialize the secondary ray time.
        float jTime = 0.0;

        // Initialize optical depth accumulators for the secondary ray.
        float jOdRlh = 0.0;
        float jOdMie = 0.0;

        // Sample the secondary ray.
        for (int j = 0; j < jSteps; j++) {

            // Calculate the secondary ray sample position.
            vec3 jPos = iPos + pSun * (jTime + jStepSize * 0.5);

            // Calculate the height of the sample.
            float jHeight = length(jPos) - rPlanet;

            // Accumulate the optical depth.
            jOdRlh += exp(-jHeight / shRlh) * jStepSize;
            jOdMie += exp(-jHeight / shMie) * jStepSize;

            // Increment the secondary ray time.
            jTime += jStepSize;
        }

        // Calculate attenuation.
        vec3 attn = exp(-(kMie * (iOdMie + jOdMie) + kRlh * (iOdRlh + jOdRlh)));

        // Accumulate scattering.
        totalRlh += odStepRlh * attn;
        totalMie += odStepMie * attn;

        // Increment the primary ray time.
        iTime += iStepSize;

    }

    // Calculate and return the final color.
    return iSun * (pRlh * kRlh * totalRlh + pMie * kMie * totalMie);
}

const float kLengthUnitInMeters = 1.;
const vec3 kSphereCenter = vec3(0.0, 0.0, 0) / kLengthUnitInMeters;

void main() {
  vec3 color = atmosphere(
      vPosition, uEyePos,
      uSunPos, uSunIntensity,
      uGroundElevation, uGroundElevation + uAtmosphereHeight,
      uRayleighScatteringCoeff, uRayleighScaleHeight,
      uMieScatteringCoeff, uMieScaleHeight, uMiePolarity);
  // Apply exposure.
  color = 1.0 - exp(-1.0 * color);
  gl_FragColor = vec4(color, 1);
}
`;function Atmosphere2(){return import_react3.default.useEffect(()=>{setup3()}),import_react3.default.createElement(import_react3.default.Fragment,null,import_react3.default.createElement("div",{id:"ui"}),import_react3.default.createElement("h1",null,"Atmosphere"),import_react3.default.createElement("p",null,import_react3.default.createElement("em",null,"Work in progress.")),import_react3.default.createElement("p",null,"Using ",import_react3.default.createElement("a",{target:"_new",href:"https://github.com/wwwtyro/glsl-atmosphere"},"Rye Terrell's atmosphere shaders")," with some physical constants and equation corrections adopted from ",import_react3.default.createElement("a",{href:"bruneton-atmos/index.html"},"my attempt to integrate Eric Bruneton's shaders"),". See ",import_react3.default.createElement("a",{href:"https://github.com/celestiary/web/blob/master/howto/atmosphere.html"},"source")," for extended notes on physical parameters."),import_react3.default.createElement("p",null,"Try zooming out (mouse scroll or pad push) to see the change in eye height.  Currently working on parameterizing the sun position and camera look direction."),import_react3.default.createElement("div",{id:"control",style:{width:400,height:400}}))}function setup3(){let atmos=new Atmosphere(2,22,6371e3,6e4,58e-7,135e-7,331e-7,8e3,21e-6,1200,.8),atmosControls=new AtmosphereControls(elt("control"),atmos),ui=new ThreeUi("ui");ui.camera.position.z=10;let light=new PointLight,dist=1e7;light.position.set(dist,0,dist),ui.scene.add(light),ui.scene.add(new AxesHelper(1.1)),ui.scene.add(new AtmosphereObject3D(atmos));let animation=()=>{let cameraPosition=ui.camera.position.clone();cameraPosition.applyMatrix4(ui.camera.matrixWorld),atmos.EyeHeight=atmos.GroundElevation+cameraPosition.z};ui.setAnimation(animation)}var import_react4=__toESM(require_react(),1);function Cube(){return import_react4.default.useEffect(()=>{setup4()},[]),import_react4.default.createElement(import_react4.default.Fragment,null,import_react4.default.createElement("div",{id:"ui"}),import_react4.default.createElement("h1",null,"A Simple Cube"),"To start with, a simple scene is defined with an object and controls.  Try rotating the cube with your mouse.  A scroll up or down gesture or mouse-wheel will zoom.  Double-button drag will pan.")}function setup4(){let ui=new ThreeUi("ui");ui.camera.position.set(1,2,3);let light=new PointLight;light.position.set(3,4,5),ui.scene.add(light),ui.scene.add(new AxesHelper),ui.scene.add(cube())}var import_react5=__toESM(require_react(),1);var import_tweakpane2=__toESM(require_tweakpane(),1);var GalaxyBufferGeometry=class extends BufferGeometry{constructor(numStars){super();let coords=new Float32Array(numStars*3),colors=new Float32Array(numStars*3),velocities=new Float32Array(numStars*3),masses=new Float32Array(numStars);this.setAttribute("position",new Float32BufferAttribute(coords,3)),this.setAttribute("mass",new Float32BufferAttribute(masses,1)),this.setAttribute("velocity",new Float32BufferAttribute(velocities,3)),this.setAttribute("color",new Float32BufferAttribute(colors,3)),this.computeBoundingSphere()}};var G=1e-10,minDistance=.1,DEBUG=!1;function step(pos,vel,acc,mass,dt=1){DEBUG&&(DEBUG.innerHTML="step:<br/>");let halfDt=dt*.5,halfDt2=dt*dt*.5,vxBefore=new Array(mass.length),vxAfter=new Array(mass.length);for(let i=0;i<pos.length;i+=3){let xi=i,yi=i+1,zi=i+2;pos[xi]+=vel[xi]*dt+acc[xi]*halfDt2,pos[yi]+=vel[yi]*dt+acc[yi]*halfDt2,pos[zi]+=vel[zi]*dt+acc[zi]*halfDt2;let n=Math.floor(xi/3);vxBefore[n]=vel[xi]}updateAccelerations(pos,vel,acc,mass);for(let i=0;i<pos.length;i+=3){let xi=i,yi=i+1,zi=i+2;vel[xi]+=acc[xi]*halfDt,vel[yi]+=acc[yi]*halfDt,vel[zi]+=acc[zi]*halfDt;let n=Math.floor(xi/3);vxAfter[n]=vel[xi],DEBUG&&(DEBUG.innerHTML+=`body #${n}<br/>__vxBefore: ${vxBefore[n]}<br/>__vxAfter: ${vxAfter[n]}<br/>__delta: ${vxAfter[n]-vxBefore[n]}<br/>`)}}function updateAccelerations(pos,vel,acc,mass){let fX,fY,fZ;for(let i=0;i<pos.length;i+=3){let xi=i,yi=i+1,zi=i+2,x1=pos[xi],y1=pos[yi],z1=pos[zi],m1=mass[i/3],GM1=G*m1;fX=0,fY=0,fZ=0;for(let j=0;j<i;j+=3){let xj=j,yj=j+1,zj=j+2,x2=pos[xj],y2=pos[yj],z2=pos[zj],m2=mass[j/3],dX=x2-x1,dY=y2-y1,dZ=z2-z1,d=Math.max(Math.sqrt(dX*dX+dY*dY+dZ*dZ),minDistance);dX=dX/d,dY=dY/d,dZ=dZ/d;let F=GM1*m2/(d*d),fx=F*dX,fy=F*dY,fz=F*dZ;fX+=fx,fY+=fy,fZ+=fz,acc[xj]-=fx,acc[yj]-=fy,acc[zj]-=fz}acc[xi]+=fX,acc[yi]+=fY,acc[zi]+=fZ;let vX=vel[xi];DEBUG&&(DEBUG.innerHTML+=`body #${Math.floor(i/3)}<br/>__vX:${vel[xi]}<br/>__fX:${fX/G}<br/>`)}}var Tau=2*Math.PI,Galaxy=class extends Points{constructor({numStars=2,radius=10}={}){super(new GalaxyBufferGeometry(numStars),new ShaderMaterial({uniforms:{texSampler:{value:pathTexture("star_glow",".png")}},vertexShader,fragmentShader,blending:AdditiveBlending,depthTest:!0,depthWrite:!1,transparent:!0}));this.numStars=numStars,this.radius=radius,this.pos=this.geometry.attributes.position.array,this.vel=this.geometry.attributes.velocity.array,this.mass=this.geometry.attributes.mass.array,this.colors=this.geometry.attributes.color.array,this.acc=new Float32Array(this.vel.length),this.first=!0,numStars==2?this.initSimple():(this.initSpirals(),this.initOrbits())}animate(dt=1,debug=!1){step(this.pos,this.vel,this.acc,this.mass),this.geometry.attributes.position.needsUpdate=!0}initSimple(){let SPEED=G*1e7;console.log("SPEED: ",SPEED),this.mass[0]=100,this.colors[0]=this.colors[1]=this.colors[2]=1,this.vel[2]=SPEED,this.pos[3]=1,this.mass[1]=100,this.colors[3]=1,this.vel[5]=-SPEED;let axes=new AxesHelper;axes.position.set(1,0,0),this.add(axes)}initSpirals(){this.mass[0]=1e3;let numSpokes=5,armDensityRatio=.7,colorTemp=.5;for(let i=0;i<this.numStars;i++){let off=3*i,xi=off,yi=off+1,zi=off+2,theta=Math.random()*Tau,r=Math.random()*this.radius;this.pos[xi]=r*Math.cos(theta),this.pos[yi]=this.radius/100*(Math.random()-.5),this.pos[zi]=r*Math.sin(theta),this.colors[xi]=1-colorTemp+colorTemp*Math.random(),this.colors[yi]=1-colorTemp+colorTemp*Math.random(),this.colors[zi]=1-colorTemp+colorTemp*Math.random(),this.mass[i]=10*(1-armDensityRatio+armDensityRatio*Math.cos(theta*numSpokes))}}initOrbits(){let M0=this.mass[0];for(let i=1;i<this.numStars;i++){let off=3*i,xi=off,yi=off+1,zi=off+2,M1=this.mass[i],x=this.pos[xi],z=this.pos[zi],R=Math.sqrt(x*x+z*z),R2=R*R,fR=0;this.vel[xi]=-z*fR,this.vel[zi]=x*fR}}},vertexShader=`
  attribute float mass;
  attribute vec3 color;
  varying vec3 vColor;
  void main() {
    vColor = color;
    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
    gl_PointSize = mass * 80. / -mvPosition.z;
    gl_Position = projectionMatrix * mvPosition;
  }
`,fragmentShader=`
// https://gamedev.stackexchange.com/questions/138384/how-do-i-avoid-using-the-wrong-texture2d-function-in-glsl
#if __VERSION__ < 130
#define TEXTURE2D texture2D
#else
#define TEXTURE2D texture
#endif
  uniform sampler2D texSampler;
  varying vec3 vColor;
  void main() {
    gl_FragColor = vec4(vColor, 1.) * TEXTURE2D(texSampler, gl_PointCoord);
  }
`;function Galaxy2(){let[keys,setKeys]=import_react5.default.useState(null);return import_react5.default.useEffect(()=>{setup5({setKeys})},[]),import_react5.default.createElement(import_react5.default.Fragment,null,import_react5.default.createElement("div",{id:"ui"}),import_react5.default.createElement("div",{id:"info"}),import_react5.default.createElement("h1",null,"Galaxy"),"Gravity particle system.  Work in progress.",import_react5.default.createElement("div",{style:{width:"50%",margin:"1em auto",align:"center"}},import_react5.default.createElement("button",{id:"step"},"Step"),import_react5.default.createElement("button",{id:"play"},"Play")),keys&&import_react5.default.createElement(HelpButton,{keys}))}function setup5({setKeys}){let uiContainer=elt("ui"),ui=new ThreeUi(uiContainer);ui.camera.position.z=10,ui.camera.position.y=3;let galaxy=new Galaxy({numStars:500});ui.scene.add(galaxy),ui.scene.add(new AxesHelper);let labels;{let labelSheet=new SpriteSheet(galaxy.numStars,galaxy.numStars+"","13px arial",[0,.1]);for(let i=0;i<labelSheet.maxLabels;i++)labelSheet.add(0,0,0,i+"");labels=labelSheet.compile(galaxy.geometry.getAttribute("position")),labels.visible=!1,ui.scene.add(labels)}let pane=new import_tweakpane2.Pane({container:uiContainer,expanded:!0,title:"Performance"}),perf={time:0,fps:0};pane.addMonitor(perf,"time",{label:"render (ms)",min:0,max:100}),pane.addMonitor(perf,"fps",{label:"fps",min:0,max:100}),pane.addMonitor(perf,"fps",{label:"",view:"graph",min:0,max:1e3});let debug=!1,anim=()=>{perf.time=new Date().getTime(),galaxy.animate(debug),perf.time=new Date().getTime()-perf.time,perf.fps=1e3/perf.time},playButton=elt("play");function togglePlay(){ui.animationCb?(ui.animationCb=null,playButton.innerText="Play",debug=!0):(ui.animationCb=anim,playButton.innerText="Pause",debug=!1)}elt("step").onclick=anim,playButton.onclick=togglePlay;let keys=new Keys;keys.map(" ",()=>{togglePlay()},"Toggle play/pause"),labels&&keys.map("l",()=>{labels.visible=!labels.visible},"Toggle label display"),setKeys(keys)}var import_react6=__toESM(require_react(),1);function Grid(){return import_react6.default.useEffect(()=>{setup6()},[]),import_react6.default.createElement(import_react6.default.Fragment,null,import_react6.default.createElement("div",{id:"ui"}),import_react6.default.createElement("h1",null,"A Grid"),"Try zooming out and rotating.")}function setup6(){let ui=new ThreeUi("ui");ui.camera.position.z=10;let g=grid();g.material.color.setRGB(0,0,1),g.material.transparent=!0,ui.scene.add(g)}var import_react7=__toESM(require_react(),1);function Labels(){return import_react7.default.useEffect(()=>{setup7()},[]),import_react7.default.createElement(import_react7.default.Fragment,null,import_react7.default.createElement("div",{id:"ui"}),import_react7.default.createElement("h1",null,"Sprite Sheet Labels"),import_react7.default.createElement("p",null,"To allow for more labels in the scene, a single sprite sheet is used, with a GL shader configured with custom offsets into the sheet for each object."))}function setup7(){let ui=new ThreeUi("ui"),c=cube();c.position.z=-3,ui.scene.add(c);let light=new PointLight;light.position.set(10,10,10),ui.scene.add(light);let prefix="item-",num=1e4;ui.camera.position.set(0,0,10);let labels=new SpriteSheet(num,prefix+num,"medium arial"),size=Math.ceil(Math.sqrt(num)),xOff=size/-2+.5,yOff=size/-2+.5;out:for(let i=0;i<size;i++)for(let j=0;j<size;j++){let id=i*size+j;if(id>=num)break out;labels.add(xOff+i,yOff+j,0,prefix+id)}ui.scene.add(labels.compile())}var import_react8=__toESM(require_react(),1);function Loader2(){let location2=useLocation();return import_react8.default.useEffect(()=>{setup8(location2.hash.substr(1)||"sun/earth/moon")},[location2]),import_react8.default.createElement(import_react8.default.Fragment,null,import_react8.default.createElement("h1",null,"Loader"),import_react8.default.createElement("p",null,"The loader fetches a json object at a path, e.g. 'sun/earth/moon'. Each path part is passed to an onLoad callback, and an onDone callback is called after the final object is loaded."),import_react8.default.createElement("p",null,"Here is the loaded Moon object, displayed with the collapsor.js utility:"),import_react8.default.createElement("div",{id:"done-id"}))}function setup8(path){let onLoadCb=(name,obj)=>{},onDoneCb=(name,obj)=>{let doneElt=elt("done-id");doneElt.innerHTML=JSON.stringify(obj).replace(/{/g,"<ul><li>").replace(/}/g,"</li></ul>").replace(/\[/g,"<ol><li>").replace(/\]/g,"</li></ol>").replace(/,/g,"</li><li>").replace(/<li><\/li>/g,""),window.collapse=collapse,makeCollapsable(doneElt)};new Loader().loadPath(path,onLoadCb,onDoneCb)}var import_react9=__toESM(require_react(),1);function Measure2(){return import_react9.default.useEffect(()=>{setup9()},[]),import_react9.default.createElement("div",{style:{maxWidth:"800px"}},import_react9.default.createElement("h1",null,"Measure"),import_react9.default.createElement("p",null,"Working with astronomical data will quickly break ur brain if you don't have an easy way to work with units and mangitudes. I wrote the ",import_react9.default.createElement("a",{href:"https://github.com/pablo-mayrgundter/measure.js"},"measure.js")," library to help with this."),import_react9.default.createElement("table",{cellPadding:"5em",cellSpacing:"5"},import_react9.default.createElement("tbody",null,import_react9.default.createElement("tr",null,import_react9.default.createElement("th",null,"Data string"),import_react9.default.createElement("th",null,"Parsed Measure toString"),import_react9.default.createElement("th",null,"toKilo")),import_react9.default.createElement("tr",null,import_react9.default.createElement("td",{id:"mass1"},"1.9891E33 g")),import_react9.default.createElement("tr",null,import_react9.default.createElement("td",{id:"mass2"},"1.9891E33 kg")),import_react9.default.createElement("tr",null,import_react9.default.createElement("td",{id:"radius"},"6.9424895E8 m")))))}function setup9(){let parse=elt2=>{let origText=elt2.innerHTML,measure=Measure.parse(elt2.innerHTML),asKilo=measure.convertTo(Measure.Magnitude.KILO),p=elt2.parentNode;p.appendChild(newElt("td",measure)),p.appendChild(newElt("td",asKilo))};parse(elt("mass1")),parse(elt("mass2")),parse(elt("radius"))}var import_react10=__toESM(require_react(),1);var Label=class extends Object3D{constructor(labelText,opts){super();this.opts={font:opts&&opts.font?opts.font:SpriteSheet.defaultFont,fillStyle:opts&&opts.fillStyle?opts.fillStyle:"white"};let ss=new SpriteSheet(1,labelText,this.opts.font,[0,0]);ss.add(0,0,0,labelText,this.opts.fillStyle),this.add(ss.compile())}};function planetHelper(path,cb){let nO=name=>{let o=new Object3D;return o.name=name,o},sceneGroups={newObject:nO,newGroup:nO,orbitShapes:[]},planetNames=["Mercury","Venus","Earth","Mars","Jupiter","Saturn","Uranus","Neptune","Pluto"],favesTable=document.getElementById("faves");favesTable.innerHTML="<tr><th>Planet</th></tr>",planetNames.map(planetName=>{favesTable.innerHTML+=`<tr>
            <td><a href="#${planetName.toLowerCase()}">${planetName}</a></td>
          </tr>`});let onLoadCb=(name,props)=>{},onDoneCb=(name,props)=>{reifyMeasures(props),cb(new Planet(sceneGroups,props))};new Loader().loadPath(path,onLoadCb,onDoneCb)}var Orbit=class extends Object3D{constructor(props){super();this.props=props,this.propsReified={siderealOrbitPeriod:props.siderealOrbitPeriod.scalar,ecc:props.eccentricity,inc:props.inclination*toRad,loan:props.longitudeOfAscendingNode*toRad,lop:props.longitudeOfPericenter*toRad,meanLon:props.meanLongitude*toRad,radius:props.semiMajorAxis.scalar},this.init(this.propsReified)}init(orbit){let referencePlane=addFrame(this,"referencePlane");referencePlane.rotation.x=-Math.PI/2;let eclipticPlane=addFrame(referencePlane,"eclipticPlane");eclipticPlane.rotation.z=orbit.loan;let orbitalPlane=addFrame(eclipticPlane,"orbitalPlane");orbitalPlane.rotation.x=orbit.inc;let periPlane=addFrame(orbitalPlane,"periPlane");periPlane.rotation.z=orbit.lop,this.orbiterCenter=periPlane}addOrbiter(obj){this.orbiterCenter.add(obj)}};function addFrame(parent,name){let frame=named(new Object3D,name);return parent.add(frame),frame}function Orbit2(){return import_react10.default.useEffect(()=>{setup10()},[]),import_react10.default.createElement(import_react10.default.Fragment,null,import_react10.default.createElement("div",{id:"ui"}),import_react10.default.createElement("h1",null,"Orbit"),import_react10.default.createElement("p",null,"An example orbit.",import_react10.default.createElement("a",{href:"https://en.wikipedia.org/wiki/Orbital_elements"},"https://en.wikipedia.org/wiki/Orbital_elements"),import_react10.default.createElement("img",{src:"/images/Orbit1.png",style:{width:"400px"},alt:"By Lasunncty at the English Wikipedia, CC BY-SA 3.0, https://commons.wikimedia.org/w/index.php?curid=8971052"})),import_react10.default.createElement("table",{style:{width:"20%",verticalAlign:"top"}},import_react10.default.createElement("tbody",null,import_react10.default.createElement("tr",null,import_react10.default.createElement("td",null,import_react10.default.createElement("table",{id:"faves"})),import_react10.default.createElement("td",{style:{width:"80%"}},import_react10.default.createElement("form",{name:"elts"},import_react10.default.createElement("table",{id:"propsTable"})))))),import_react10.default.createElement("em",{style:{fontSize:"small"}},"(",import_react10.default.createElement("a",{href:"#test"},"emulate image above")," and refresh)"))}function setup10(){let ui=new ThreeUi("ui");ui.camera.position.set(1,1,3),ui.scene.add(new AmbientLight);function setupProps(orbitProps){let tau=Math.PI*2,tauInDeg=360,elementMaxes={siderealOrbitPeriod:78184256184e-1,eccentricity:1,inclination:tauInDeg,longitudeOfAscendingNode:tauInDeg,longitudeOfPericenter:tauInDeg,meanLongitude:tauInDeg,semiMajorAxis:586966e7};document.onSlider=(sliderElt,propName,maxValue)=>{let value=sliderElt.value/100*elementMaxes[propName];orbitProps[propName]=document.forms.elts[propName].value=value,show(orbitProps)},document.onInput=(inputElt,propName,ma)=>{orbitProps[propName]=inputElt.value,document.forms.elts[propName+"-slider"].value=inputElt.value/elementMaxes[propName]*100,show(orbitProps)},propsTable.innerHTML="";for(let propName in elementMaxes){let maxValue=elementMaxes[propName],propsTable2=document.getElementById("propsTable"),value=orbitProps[propName],sliderValue=value/maxValue*100;propsTable2.innerHTML+=`<tr>
           <td>${propName}:
           <td><input type="range" min="0" max="100" name="${propName}-slider" value="${sliderValue}"
                  oninput="document.onSlider(this, '${propName}')"/>
           <td><input name="${propName}" value="${value}" oninput="document.onInput(this, '${propName}')"/>
         </tr>`}}let curOrbit,curPlanet;function show(orbitProps){let orbit=new Orbit(orbitProps);visitFilterProperty(orbit,"name","referencePlane",o=>{let opts={text:"\u03A9 Longitude of ascending node",color:"green",padding:[-.5,-.5]};o.add(arrow(new Vector3(1.1,0,0),new Vector3,16711680,"\u2648\uFE0EReference direction")),o.add(angle(orbit.propsReified.loan,null,opts,opts))}),visitFilterProperty(orbit,"name","orbitalPlane",o=>{let opts={text:"\u03C9 Argument of periapsis",color:"blue",padding:[-.5,-.5]},lop=orbit.propsReified.lop,radiusOfPeriapsis=line(1,0,0,{color:"blue"});radiusOfPeriapsis.rotation.z=lop,o.add(radiusOfPeriapsis),o.add(angle(lop,null,opts,opts));let an=new Label("\u260A Ascending node",{fillStyle:"green"});an.position.set(1,0,0),an.rotation.z=orbit.propsReified.loan,o.add(an)}),curOrbit&&ui.scene.remove(curOrbit),curOrbit=orbit,ui.scene.add(curOrbit),curPlanet&&curOrbit.addOrbiter(curPlanet)}if(location.hash=="#test"){let testOrbit={siderealOrbitPeriod:0,eccentricity:1,inclination:30,longitudeOfAscendingNode:300,longitudeOfPericenter:110,meanLongitude:0,semiMajorAxis:{scalar:1}};setupProps(testOrbit),show(testOrbit),document.orbit=testOrbit}else planetHelper("earth",p=>{setupProps(p.props.orbit),show(p.props.orbit),curPlanet=p,curPlanet.orbit=curOrbit,curPlanet.scale.setScalar(.1),curOrbit.addOrbiter(curPlanet)});let anim=()=>{let simTimeSecs=Date.now()*1e3;if(curPlanet!=null){if(curPlanet.siderealRotationPeriod){let angle2=1.5*Math.PI+simTimeSecs/86400*twoPi;curPlanet.setRotationFromAxisAngle(this.Y_AXIS,angle2)}if(curPlanet.orbit){let orbit=curPlanet.orbit.props,aRadius=1,bRadius=aRadius*Math.sqrt(1-Math.pow(orbit.eccentricity,2)),angle2=1*simTimeSecs/orbit.siderealOrbitPeriod.scalar*twoPi,x=aRadius*Math.cos(angle2),y=bRadius*Math.sin(angle2),z=0;curPlanet.position.set(x,y,z)}}};ui.animationCb=anim}var import_react11=__toESM(require_react(),1);function Picking(){return import_react11.default.useEffect(()=>{setup11()},[]),import_react11.default.createElement(import_react11.default.Fragment,null,import_react11.default.createElement("div",{id:"ui"}),import_react11.default.createElement("h1",null,"Picking"),"Click on the sphere to change its colors.")}function setup11(){let ui=new ThreeUi("ui"),light=new PointLight;light.position.set(10,10,10),ui.scene.add(light),ui.scene.add(new AmbientLight(8947848));let a=sphere(),b=sphere(),c=sphere();a.position.set(5,3,2),b.position.set(2,5,3),c.position.set(2,3,5),ui.scene.add(a),ui.scene.add(b),ui.scene.add(c),ui.camera.platform.position.z=10,ui.camera.position.z=1,ui.scene.updateMatrixWorld();let sPos=new Vector3;sPos.setFromMatrixPosition(a.matrixWorld),ui.camera.lookAt(sPos),ui.controls.update(),ui.controls.target=sPos;let raycaster=new Raycaster,colorAlts=[16711680,65280],colorNdx=0;document.body.addEventListener("dblclick",event=>{let mouse={};mouse.x=event.clientX/window.innerWidth*2-1,mouse.y=event.clientY/window.innerHeight*-2+1,raycaster.setFromCamera(mouse,ui.camera);let intersects=raycaster.intersectObjects(ui.scene.children,!0);console.log("click intersects: ",intersects);for(let i=0;i<intersects.length;i++)intersects[i].object.material.color.set(colorAlts[colorNdx]),colorNdx=(colorNdx+1)%2})}var import_react12=__toESM(require_react(),1);function Planet2(){let[ui,setUi]=import_react12.default.useState(null),[planet,setPlanet]=import_react12.default.useState(null);import_react12.default.useEffect(()=>{setUi(setup12())},[]);let location2=useLocation();return import_react12.default.useEffect(()=>{if(ui){let path=(location2.hash||"#earth").substr(1);showPlanet(ui,path,planet,setPlanet)}},[ui,location2]),import_react12.default.createElement(import_react12.default.Fragment,null,import_react12.default.createElement("div",{id:"ui"}),import_react12.default.createElement("h1",null,"Planet"),import_react12.default.createElement("p",null,"Use LOD to lazy-load texture.  Open your browser network trace and watch it as you zoom in."),import_react12.default.createElement("table",{id:"faves"},import_react12.default.createElement("tbody",null,import_react12.default.createElement("tr",null,import_react12.default.createElement("th",null,"Name")))))}function setup12(){let ui=new ThreeUi("ui");ui.camera.position.z=10;let light=new PointLight,dist=1e3;return light.position.set(-dist,0,dist),ui.camera.add(light),ui}function showPlanet(ui,path,curPlanet,setPlanet){planetHelper(path,p=>{curPlanet&&ui.scene.remove(curPlanet),ui.scene.add(p),setPlanet(p),ui.animationCb=()=>{p.rotation.y+=.001}})}var import_react13=__toESM(require_react(),1);function SaturnEarth(){return import_react13.default.useEffect(()=>{setup13()},[]),import_react13.default.createElement(import_react13.default.Fragment,null,import_react13.default.createElement("div",{id:"ui"}),import_react13.default.createElement("h1",null,"A Saturn-Earth Orbital System"),import_react13.default.createElement("p",null,"If the Earth orbited Saturn at the same distance that the Moon orbits Earth, i.e. Earth as a moon of Saturn, how fast would Earth orbit Saturn?"),import_react13.default.createElement("p",null,"This question was inspired by a friend commenting on the FB photo ",import_react13.default.createElement("a",{href:"https://www.facebook.com/fxsoyris/posts/4859941050713774"},"shared")," by Fran\xE7ois Xavier Soyris, Jan 19 2021."),import_react13.default.createElement("img",{src:"/guide/saturn-earth-fb-photo.jpg",width:"400"}))}function setup13(){let ui=new ThreeUi("ui");ui.camera.position.set(0,0,50),ui.camera.position.setLength(29.12),ui.camera.position.setY(.63351),document.cam=ui.camera,ui.scene.add(new AmbientLight(1118481)),ui.scene.add(new AxesHelper);let stars=new Stars({radius:{scalar:694248950}},()=>{document.stars=stars,ui.scene.add(stars)},!1,()=>{let saturnSemiMajorAxis=143353e7*LENGTH_SCALE,starPositions=stars.children[1].geometry.attributes.position;starPositions.array[0]=-saturnSemiMajorAxis,starPositions.array[2]=-saturnSemiMajorAxis;let sunlight=new PointLight;sunlight.position.set(-saturnSemiMajorAxis,0,-saturnSemiMajorAxis),ui.scene.add(sunlight)}),saturn,earth,moon,nO=name=>{let o=new Object3D;return o.name=name,o},sceneGroups={newObject:nO,newGroup:nO,orbitShapes:[]},scaledSemiMajorAxis,sceneLoadCb=(name,planet)=>{if(name=="moon"){scaledSemiMajorAxis=planet.props.orbit.semiMajorAxis.scalar*LENGTH_SCALE;return}if(name=="earth"){let earthX=.5*scaledSemiMajorAxis+10,earthRadius=planet.props.radius.scalar*LENGTH_SCALE;planet.position.x=earthX,ui.camera.position.set(earthX*2,earthRadius*2,0)}else planet.position.x=-.5*scaledSemiMajorAxis,planet.rotation.y=.75*Math.PI;ui.scene.add(planet)},onLoadCb=(name,props)=>{},onDoneCb=(name,props)=>{reifyMeasures(props),sceneLoadCb(name,new Planet(sceneGroups,props))},loader=new Loader;loader.loadPath("moon",onLoadCb,onDoneCb),loader.loadPath("saturn",onLoadCb,onDoneCb),loader.loadPath("earth",onLoadCb,onDoneCb),ui.animationCb=()=>{}}var import_react14=__toESM(require_react(),1);var import_react15=__toESM(require_react(),1);function Star2(){let[ui,setUi]=import_react15.default.useState(null),[star,setStar]=import_react15.default.useState(null),[catalog,setCatalog]=import_react15.default.useState(null),time=new Time;import_react15.default.useEffect(()=>{setUi(setup14(setCatalog))},[]);let location2=useLocation();return import_react15.default.useEffect(()=>{if(ui){let path=(location2.hash||"#Sol").substr(1);showStar(ui,path,star,setStar,catalog,time)}},[catalog,location2]),import_react15.default.createElement(import_react15.default.Fragment,null,import_react15.default.createElement("div",{id:"ui"}),import_react15.default.createElement("h1",null,"Star"),"See ",import_react15.default.createElement("a",{href:"https://www.seedofandromeda.com/blogs/51-procedural-star-rendering"},"Seed of Andromeda")," for a nice overall approach.",import_react15.default.createElement("p",null,"Borrowed heavily from code ",import_react15.default.createElement("a",{href:"https://bpodgursky.com/2017/02/01/procedural-star-rendering-with-three-js-and-webgl-shaders/"},"here"),"."),import_react15.default.createElement("p",null,"Added differential color range based on distance.  This makes the star appear white from far away and reveal surface structure as false-color on closer approach."),import_react15.default.createElement("table",{id:"faves"},import_react15.default.createElement("tbody",null,import_react15.default.createElement("tr",null,import_react15.default.createElement("th",null,"Star"),import_react15.default.createElement("th",null,"Spectral Type"),import_react15.default.createElement("th",null,"Hip ID")))))}function addStarToScene(ui,catalog,hipId,curStar,setStar){curStar&&ui.scene.remove(curStar);let starProps=catalog.starsByHip[hipId];starProps.x=starProps.y=starProps.z=0,starProps.radius={scalar:1/LENGTH_SCALE};let star=new Star(starProps,{},ui);return ui.scene.add(star),setStar(star),star}function setupFavesTable2(catalog){let favesTable=elt("faves");for(let hipId in FAVES){let name=FAVES[hipId],star=catalog.starsByHip[hipId],spectralType=StarsCatalog.StarSpectra[star.spectralType][3];favesTable.innerHTML+=`<tr>
        <td><a href="#${name}">${name}</a></td>
        <td>${spectralType}</td>
        <td>${hipId}</td>
      </tr>`}}function setup14(setCatalog){let ui=new ThreeUi("ui");ui.camera.position.z=3;let catalog=new StarsCatalog;return catalog.load(()=>{setupFavesTable2(catalog),setCatalog(catalog)}),ui}function showStar(ui,path,curStar,setStar,catalog,time){path=path.replaceAll(/%20/g," ");let hipId=catalog.hipByName[path];if(hipId===void 0){console.error(`Cannot find star(${path}) in `,catalog);return}let star=addStarToScene(ui,catalog,parseInt(hipId),curStar,setStar);ui.animationCb=()=>{time.updateTime();try{star.preAnimCb(time)}catch(e){throw console.error(e),new Error(`preanim star: ${star}`)}}}var import_react16=__toESM(require_react(),1);function Stars3(){return import_react16.default.useEffect(()=>{setup15()},[]),import_react16.default.createElement(import_react16.default.Fragment,null,import_react16.default.createElement("div",{id:"ui"}),import_react16.default.createElement("h1",null,"Stars"))}function setup15(){let ui=new ThreeUi("ui");ui.camera.position.z=1e3;let stars=new Stars({radius:{scalar:getSunProps(.1).radiusMeters}},()=>{let tree=createTree();tree.init(stars.geom.coords);let marker2=marker();ui.scene.add(marker2);let markCb=e=>{queryPoints(ui,e,tree,stars,pick=>{marker2.position.copy(pick)})};document.body.addEventListener("dblclick",markCb)},!0);ui.scene.add(stars)}var import_react17=__toESM(require_react(),1);function Welcome(){return import_react17.default.createElement(import_react17.default.Fragment,null,import_react17.default.createElement("h1",null,"Welcome"),import_react17.default.createElement("p",null,"This is the developer guide for Celestiary."),import_react17.default.createElement("p",null,"Celestiary is written using the ",import_react17.default.createElement("a",{href:"https://threejs.org/"},"three.js")," library for most of the graphics.  Three.js is a productivity layer on top of the ",import_react17.default.createElement("a",{href:"https://en.wikipedia.org/wiki/WebGL"},"WebGL")," capability available in all modern browsers."),import_react17.default.createElement("p",null,"The topic guide to the left steps through how each of the main functions of Celestiary are built."),import_react17.default.createElement("p",null,"Background reading:"),import_react17.default.createElement("ul",null,import_react17.default.createElement("li",null,import_react17.default.createElement("a",{href:"https://webglfundamentals.org/"},"WebGL Fundamentals")," - deeper dive into WebGL",import_react17.default.createElement("ul",null,import_react17.default.createElement("li",null,import_react17.default.createElement("a",{href:"http://acko.net/files/gltalks/pixelfactory/online.html#0"},"The Pixel Factory")),import_react17.default.createElement("li",null,import_react17.default.createElement("a",{href:"https://webglfundamentals.org/webgl/lessons/webgl-shaders-and-glsl.html"},"WebGL Shaders and GLSL")),import_react17.default.createElement("li",null,import_react17.default.createElement("a",{href:"https://thebookofshaders.com/"},"The Book of Shaders"))))),import_react17.default.createElement("p",null,"Back to the ",import_react17.default.createElement(Link,{to:"/"},"app"),"."))}function Guide(){let location2=useLocation();return import_react18.default.useEffect(()=>{setTitleFromLocation(location2,"Guide")},[location2]),import_react18.default.createElement(import_react18.default.Fragment,null,import_react18.default.createElement("table",{id:"nav"},import_react18.default.createElement("tbody",null,import_react18.default.createElement("tr",null,import_react18.default.createElement("td",{style:{width:"15%",overflowY:scroll,verticalAlign:"top",padding:"0 1em"}},import_react18.default.createElement("h1",null,"Guide"),import_react18.default.createElement("p",null,import_react18.default.createElement(Link,{to:"/"},"\u2190 Back")),import_react18.default.createElement("ol",null,import_react18.default.createElement("li",null,import_react18.default.createElement(Link,{to:""},"Welcome")),import_react18.default.createElement("li",null,"Data",import_react18.default.createElement("ol",null,import_react18.default.createElement("li",null,import_react18.default.createElement(Link,{to:"loader"},"Loader")),import_react18.default.createElement("li",null,import_react18.default.createElement(Link,{to:"measure"},"Measure")))),import_react18.default.createElement("li",null,"Scene Objects",import_react18.default.createElement("ol",null,import_react18.default.createElement("li",null,"Basic Shapes",import_react18.default.createElement("ul",null,import_react18.default.createElement("li",null,import_react18.default.createElement(Link,{to:"cube"},"Cube")),import_react18.default.createElement("li",null,import_react18.default.createElement(Link,{to:"sphere"},"Sphere")))))),import_react18.default.createElement("li",null,"Decorators",import_react18.default.createElement("ul",null,import_react18.default.createElement("li",null,import_react18.default.createElement(Link,{to:"grid"},"Grid")),import_react18.default.createElement("li",null,import_react18.default.createElement(Link,{to:"labels"},"Labels")),import_react18.default.createElement("li",null,import_react18.default.createElement(Link,{to:"angles"},"Angles")))),import_react18.default.createElement("li",null,"Interaction",import_react18.default.createElement("ul",null,import_react18.default.createElement("li",null,import_react18.default.createElement(Link,{to:"picking"},"Picking")))),import_react18.default.createElement("li",null,"Celestial Bodies",import_react18.default.createElement("ul",null,import_react18.default.createElement("li",null,import_react18.default.createElement(Link,{to:"stars"},"Stars")),import_react18.default.createElement("li",null,import_react18.default.createElement(Link,{to:"star"},"Star")),import_react18.default.createElement("li",null,import_react18.default.createElement(Link,{to:"asterisms"},"Asterisms")),import_react18.default.createElement("li",null,import_react18.default.createElement(Link,{to:"planet"},"Planet")))),import_react18.default.createElement("li",null,import_react18.default.createElement(Link,{to:"atmosphere"},"Atmosphere")),import_react18.default.createElement("li",null,"Celestial Mechanics",import_react18.default.createElement("ul",null,import_react18.default.createElement("li",null,import_react18.default.createElement(Link,{to:"orbit"},"Orbit")),import_react18.default.createElement("li",null,import_react18.default.createElement(Link,{to:"galaxy"},"Gravity (galaxy)")))),import_react18.default.createElement("li",null,"Fun",import_react18.default.createElement("ul",null,import_react18.default.createElement("li",null,import_react18.default.createElement(Link,{to:"saturn-earth"},"Earth, Saturn's moon")))))),import_react18.default.createElement("td",null,import_react18.default.createElement(Outlet,null),import_react18.default.createElement(Routes,null,import_react18.default.createElement(Route,{index:!0,element:import_react18.default.createElement(Welcome,null)}),import_react18.default.createElement(Route,{path:"angles",element:import_react18.default.createElement(Angles,null)}),import_react18.default.createElement(Route,{path:"atmosphere",element:import_react18.default.createElement(Atmosphere2,null)}),import_react18.default.createElement(Route,{path:"cube",element:import_react18.default.createElement(Cube,null)}),import_react18.default.createElement(Route,{path:"galaxy",element:import_react18.default.createElement(Galaxy2,null)}),import_react18.default.createElement(Route,{path:"grid",element:import_react18.default.createElement(Grid,null)}),import_react18.default.createElement(Route,{path:"labels",element:import_react18.default.createElement(Labels,null)}),import_react18.default.createElement(Route,{path:"loader",element:import_react18.default.createElement(Loader2,null)}),import_react18.default.createElement(Route,{path:"measure",element:import_react18.default.createElement(Measure2,null)}),import_react18.default.createElement(Route,{path:"orbit",element:import_react18.default.createElement(Orbit2,null)}),import_react18.default.createElement(Route,{path:"picking",element:import_react18.default.createElement(Picking,null)}),import_react18.default.createElement(Route,{path:"saturn-earth",element:import_react18.default.createElement(SaturnEarth,null)}),import_react18.default.createElement(Route,{path:"stars",element:import_react18.default.createElement(Stars3,null)}),import_react18.default.createElement(Route,{path:"star",element:import_react18.default.createElement(Star2,null)}),import_react18.default.createElement(Route,{path:"asterisms",element:import_react18.default.createElement(Asterisms2,null)}),import_react18.default.createElement(Route,{path:"planet",element:import_react18.default.createElement(Planet2,null)})))))))}export{Guide as default};
/*! Tweakpane 3.0.7 (c) 2016 cocopon, licensed under the MIT license. */
//# sourceMappingURL=Guide-TBH2VAIJ.js.map
